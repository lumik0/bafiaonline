(()=>{var it=Object.create;var $e=Object.defineProperty;var nt=Object.getOwnPropertyDescriptor;var rt=Object.getOwnPropertyNames;var ot=Object.getPrototypeOf,at=Object.prototype.hasOwnProperty;var lt=(d,e)=>()=>(e||d((e={exports:{}}).exports,e),e.exports);var ct=(d,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of rt(e))!at.call(d,n)&&n!==t&&$e(d,n,{get:()=>e[n],enumerable:!(i=nt(e,n))||i.enumerable});return d};var mt=(d,e,t)=>(t=d!=null?it(ot(d)):{},ct(e||!d||!d.__esModule?$e(t,"default",{value:d,enumerable:!0}):t,d));var We=lt((Ss,we)=>{(function(){"use strict";var d="input is invalid type",e="finalize already called",t=typeof window=="object",i=t?window:{};i.JS_MD5_NO_WINDOW&&(t=!1);var n=!t&&typeof self=="object",o=!1;o?i=global:n&&(i=self);var c=!i.JS_MD5_NO_COMMON_JS&&typeof we=="object"&&we.exports,a=typeof define=="function"&&define.amd,E=!i.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",m="0123456789abcdef".split(""),u=[128,32768,8388608,-2147483648],f=[0,8,16,24],y=["hex","array","digest","buffer","arrayBuffer","base64"],_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),I=[],b;if(E){var S=new ArrayBuffer(68);b=new Uint8Array(S),I=new Uint32Array(S)}var R=Array.isArray;(i.JS_MD5_NO_NODE_JS||!R)&&(R=function(l){return Object.prototype.toString.call(l)==="[object Array]"});var A=ArrayBuffer.isView;E&&(i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!A)&&(A=function(l){return typeof l=="object"&&l.buffer&&l.buffer.constructor===ArrayBuffer});var O=function(l){var p=typeof l;if(p==="string")return[l,!0];if(p!=="object"||l===null)throw new Error(d);if(E&&l.constructor===ArrayBuffer)return[new Uint8Array(l),!1];if(!R(l)&&!A(l))throw new Error(d);return[l,!1]},U=function(l){return function(p){return new x(!0).update(p)[l]()}},H=function(){var l=U("hex");o&&(l=nodeWrap(l)),l.create=function(){return new x},l.update=function(h){return l.create().update(h)};for(var p=0;p<y.length;++p){var g=y[p];l[g]=U(g)}return l},v=function(l){return function(p,g){return new F(p,!0).update(g)[l]()}},w=function(){var l=v("hex");l.create=function(h){return new F(h)},l.update=function(h,D){return l.create(h).update(D)};for(var p=0;p<y.length;++p){var g=y[p];l[g]=v(g)}return l};function x(l){if(l)I[0]=I[16]=I[1]=I[2]=I[3]=I[4]=I[5]=I[6]=I[7]=I[8]=I[9]=I[10]=I[11]=I[12]=I[13]=I[14]=I[15]=0,this.blocks=I,this.buffer8=b;else if(E){var p=new ArrayBuffer(68);this.buffer8=new Uint8Array(p),this.blocks=new Uint32Array(p)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}x.prototype.update=function(l){if(this.finalized)throw new Error(e);var p=O(l);l=p[0];for(var g=p[1],h,D=0,C,T=l.length,L=this.blocks,X=this.buffer8;D<T;){if(this.hashed&&(this.hashed=!1,L[0]=L[16],L[16]=L[1]=L[2]=L[3]=L[4]=L[5]=L[6]=L[7]=L[8]=L[9]=L[10]=L[11]=L[12]=L[13]=L[14]=L[15]=0),g)if(E)for(C=this.start;D<T&&C<64;++D)h=l.charCodeAt(D),h<128?X[C++]=h:h<2048?(X[C++]=192|h>>>6,X[C++]=128|h&63):h<55296||h>=57344?(X[C++]=224|h>>>12,X[C++]=128|h>>>6&63,X[C++]=128|h&63):(h=65536+((h&1023)<<10|l.charCodeAt(++D)&1023),X[C++]=240|h>>>18,X[C++]=128|h>>>12&63,X[C++]=128|h>>>6&63,X[C++]=128|h&63);else for(C=this.start;D<T&&C<64;++D)h=l.charCodeAt(D),h<128?L[C>>>2]|=h<<f[C++&3]:h<2048?(L[C>>>2]|=(192|h>>>6)<<f[C++&3],L[C>>>2]|=(128|h&63)<<f[C++&3]):h<55296||h>=57344?(L[C>>>2]|=(224|h>>>12)<<f[C++&3],L[C>>>2]|=(128|h>>>6&63)<<f[C++&3],L[C>>>2]|=(128|h&63)<<f[C++&3]):(h=65536+((h&1023)<<10|l.charCodeAt(++D)&1023),L[C>>>2]|=(240|h>>>18)<<f[C++&3],L[C>>>2]|=(128|h>>>12&63)<<f[C++&3],L[C>>>2]|=(128|h>>>6&63)<<f[C++&3],L[C>>>2]|=(128|h&63)<<f[C++&3]);else if(E)for(C=this.start;D<T&&C<64;++D)X[C++]=l[D];else for(C=this.start;D<T&&C<64;++D)L[C>>>2]|=l[D]<<f[C++&3];this.lastByteIndex=C,this.bytes+=C-this.start,C>=64?(this.start=C-64,this.hash(),this.hashed=!0):this.start=C}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},x.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var l=this.blocks,p=this.lastByteIndex;l[p>>>2]|=u[p&3],p>=56&&(this.hashed||this.hash(),l[0]=l[16],l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0),l[14]=this.bytes<<3,l[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},x.prototype.hash=function(){var l,p,g,h,D,C,T=this.blocks;this.first?(l=T[0]-680876937,l=(l<<7|l>>>25)-271733879<<0,h=(-1732584194^l&2004318071)+T[1]-117830708,h=(h<<12|h>>>20)+l<<0,g=(-271733879^h&(l^-271733879))+T[2]-1126478375,g=(g<<17|g>>>15)+h<<0,p=(l^g&(h^l))+T[3]-1316259209,p=(p<<22|p>>>10)+g<<0):(l=this.h0,p=this.h1,g=this.h2,h=this.h3,l+=(h^p&(g^h))+T[0]-680876936,l=(l<<7|l>>>25)+p<<0,h+=(g^l&(p^g))+T[1]-389564586,h=(h<<12|h>>>20)+l<<0,g+=(p^h&(l^p))+T[2]+606105819,g=(g<<17|g>>>15)+h<<0,p+=(l^g&(h^l))+T[3]-1044525330,p=(p<<22|p>>>10)+g<<0),l+=(h^p&(g^h))+T[4]-176418897,l=(l<<7|l>>>25)+p<<0,h+=(g^l&(p^g))+T[5]+1200080426,h=(h<<12|h>>>20)+l<<0,g+=(p^h&(l^p))+T[6]-1473231341,g=(g<<17|g>>>15)+h<<0,p+=(l^g&(h^l))+T[7]-45705983,p=(p<<22|p>>>10)+g<<0,l+=(h^p&(g^h))+T[8]+1770035416,l=(l<<7|l>>>25)+p<<0,h+=(g^l&(p^g))+T[9]-1958414417,h=(h<<12|h>>>20)+l<<0,g+=(p^h&(l^p))+T[10]-42063,g=(g<<17|g>>>15)+h<<0,p+=(l^g&(h^l))+T[11]-1990404162,p=(p<<22|p>>>10)+g<<0,l+=(h^p&(g^h))+T[12]+1804603682,l=(l<<7|l>>>25)+p<<0,h+=(g^l&(p^g))+T[13]-40341101,h=(h<<12|h>>>20)+l<<0,g+=(p^h&(l^p))+T[14]-1502002290,g=(g<<17|g>>>15)+h<<0,p+=(l^g&(h^l))+T[15]+1236535329,p=(p<<22|p>>>10)+g<<0,l+=(g^h&(p^g))+T[1]-165796510,l=(l<<5|l>>>27)+p<<0,h+=(p^g&(l^p))+T[6]-1069501632,h=(h<<9|h>>>23)+l<<0,g+=(l^p&(h^l))+T[11]+643717713,g=(g<<14|g>>>18)+h<<0,p+=(h^l&(g^h))+T[0]-373897302,p=(p<<20|p>>>12)+g<<0,l+=(g^h&(p^g))+T[5]-701558691,l=(l<<5|l>>>27)+p<<0,h+=(p^g&(l^p))+T[10]+38016083,h=(h<<9|h>>>23)+l<<0,g+=(l^p&(h^l))+T[15]-660478335,g=(g<<14|g>>>18)+h<<0,p+=(h^l&(g^h))+T[4]-405537848,p=(p<<20|p>>>12)+g<<0,l+=(g^h&(p^g))+T[9]+568446438,l=(l<<5|l>>>27)+p<<0,h+=(p^g&(l^p))+T[14]-1019803690,h=(h<<9|h>>>23)+l<<0,g+=(l^p&(h^l))+T[3]-187363961,g=(g<<14|g>>>18)+h<<0,p+=(h^l&(g^h))+T[8]+1163531501,p=(p<<20|p>>>12)+g<<0,l+=(g^h&(p^g))+T[13]-1444681467,l=(l<<5|l>>>27)+p<<0,h+=(p^g&(l^p))+T[2]-51403784,h=(h<<9|h>>>23)+l<<0,g+=(l^p&(h^l))+T[7]+1735328473,g=(g<<14|g>>>18)+h<<0,p+=(h^l&(g^h))+T[12]-1926607734,p=(p<<20|p>>>12)+g<<0,D=p^g,l+=(D^h)+T[5]-378558,l=(l<<4|l>>>28)+p<<0,h+=(D^l)+T[8]-2022574463,h=(h<<11|h>>>21)+l<<0,C=h^l,g+=(C^p)+T[11]+1839030562,g=(g<<16|g>>>16)+h<<0,p+=(C^g)+T[14]-35309556,p=(p<<23|p>>>9)+g<<0,D=p^g,l+=(D^h)+T[1]-1530992060,l=(l<<4|l>>>28)+p<<0,h+=(D^l)+T[4]+1272893353,h=(h<<11|h>>>21)+l<<0,C=h^l,g+=(C^p)+T[7]-155497632,g=(g<<16|g>>>16)+h<<0,p+=(C^g)+T[10]-1094730640,p=(p<<23|p>>>9)+g<<0,D=p^g,l+=(D^h)+T[13]+681279174,l=(l<<4|l>>>28)+p<<0,h+=(D^l)+T[0]-358537222,h=(h<<11|h>>>21)+l<<0,C=h^l,g+=(C^p)+T[3]-722521979,g=(g<<16|g>>>16)+h<<0,p+=(C^g)+T[6]+76029189,p=(p<<23|p>>>9)+g<<0,D=p^g,l+=(D^h)+T[9]-640364487,l=(l<<4|l>>>28)+p<<0,h+=(D^l)+T[12]-421815835,h=(h<<11|h>>>21)+l<<0,C=h^l,g+=(C^p)+T[15]+530742520,g=(g<<16|g>>>16)+h<<0,p+=(C^g)+T[2]-995338651,p=(p<<23|p>>>9)+g<<0,l+=(g^(p|~h))+T[0]-198630844,l=(l<<6|l>>>26)+p<<0,h+=(p^(l|~g))+T[7]+1126891415,h=(h<<10|h>>>22)+l<<0,g+=(l^(h|~p))+T[14]-1416354905,g=(g<<15|g>>>17)+h<<0,p+=(h^(g|~l))+T[5]-57434055,p=(p<<21|p>>>11)+g<<0,l+=(g^(p|~h))+T[12]+1700485571,l=(l<<6|l>>>26)+p<<0,h+=(p^(l|~g))+T[3]-1894986606,h=(h<<10|h>>>22)+l<<0,g+=(l^(h|~p))+T[10]-1051523,g=(g<<15|g>>>17)+h<<0,p+=(h^(g|~l))+T[1]-2054922799,p=(p<<21|p>>>11)+g<<0,l+=(g^(p|~h))+T[8]+1873313359,l=(l<<6|l>>>26)+p<<0,h+=(p^(l|~g))+T[15]-30611744,h=(h<<10|h>>>22)+l<<0,g+=(l^(h|~p))+T[6]-1560198380,g=(g<<15|g>>>17)+h<<0,p+=(h^(g|~l))+T[13]+1309151649,p=(p<<21|p>>>11)+g<<0,l+=(g^(p|~h))+T[4]-145523070,l=(l<<6|l>>>26)+p<<0,h+=(p^(l|~g))+T[11]-1120210379,h=(h<<10|h>>>22)+l<<0,g+=(l^(h|~p))+T[2]+718787259,g=(g<<15|g>>>17)+h<<0,p+=(h^(g|~l))+T[9]-343485551,p=(p<<21|p>>>11)+g<<0,this.first?(this.h0=l+1732584193<<0,this.h1=p-271733879<<0,this.h2=g-1732584194<<0,this.h3=h+271733878<<0,this.first=!1):(this.h0=this.h0+l<<0,this.h1=this.h1+p<<0,this.h2=this.h2+g<<0,this.h3=this.h3+h<<0)},x.prototype.hex=function(){this.finalize();var l=this.h0,p=this.h1,g=this.h2,h=this.h3;return m[l>>>4&15]+m[l&15]+m[l>>>12&15]+m[l>>>8&15]+m[l>>>20&15]+m[l>>>16&15]+m[l>>>28&15]+m[l>>>24&15]+m[p>>>4&15]+m[p&15]+m[p>>>12&15]+m[p>>>8&15]+m[p>>>20&15]+m[p>>>16&15]+m[p>>>28&15]+m[p>>>24&15]+m[g>>>4&15]+m[g&15]+m[g>>>12&15]+m[g>>>8&15]+m[g>>>20&15]+m[g>>>16&15]+m[g>>>28&15]+m[g>>>24&15]+m[h>>>4&15]+m[h&15]+m[h>>>12&15]+m[h>>>8&15]+m[h>>>20&15]+m[h>>>16&15]+m[h>>>28&15]+m[h>>>24&15]},x.prototype.toString=x.prototype.hex,x.prototype.digest=function(){this.finalize();var l=this.h0,p=this.h1,g=this.h2,h=this.h3;return[l&255,l>>>8&255,l>>>16&255,l>>>24&255,p&255,p>>>8&255,p>>>16&255,p>>>24&255,g&255,g>>>8&255,g>>>16&255,g>>>24&255,h&255,h>>>8&255,h>>>16&255,h>>>24&255]},x.prototype.array=x.prototype.digest,x.prototype.arrayBuffer=function(){this.finalize();var l=new ArrayBuffer(16),p=new Uint32Array(l);return p[0]=this.h0,p[1]=this.h1,p[2]=this.h2,p[3]=this.h3,l},x.prototype.buffer=x.prototype.arrayBuffer,x.prototype.base64=function(){for(var l,p,g,h="",D=this.array(),C=0;C<15;)l=D[C++],p=D[C++],g=D[C++],h+=_[l>>>2]+_[(l<<4|p>>>4)&63]+_[(p<<2|g>>>6)&63]+_[g&63];return l=D[C],h+=_[l>>>2]+_[l<<4&63]+"==",h};function F(l,p){var g,h=O(l);if(l=h[0],h[1]){var D=[],C=l.length,T=0,L;for(g=0;g<C;++g)L=l.charCodeAt(g),L<128?D[T++]=L:L<2048?(D[T++]=192|L>>>6,D[T++]=128|L&63):L<55296||L>=57344?(D[T++]=224|L>>>12,D[T++]=128|L>>>6&63,D[T++]=128|L&63):(L=65536+((L&1023)<<10|l.charCodeAt(++g)&1023),D[T++]=240|L>>>18,D[T++]=128|L>>>12&63,D[T++]=128|L>>>6&63,D[T++]=128|L&63);l=D}l.length>64&&(l=new x(!0).update(l).array());var X=[],He=[];for(g=0;g<64;++g){var Ge=l[g]||0;X[g]=92^Ge,He[g]=54^Ge}x.call(this,p),this.update(He),this.oKeyPad=X,this.inner=!0,this.sharedMemory=p}F.prototype=new x,F.prototype.finalize=function(){if(x.prototype.finalize.call(this),this.inner){this.inner=!1;var l=this.array();x.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(l),x.prototype.finalize.call(this)}};var Y=H();Y.md5=Y,Y.md5.hmac=w(),c?we.exports=Y:(i.md5=Y,a&&define(function(){return Y}))})()});var Le=class{constructor(e,t,i,n=2){this.event=e;this.callback=t;this.owner=i;this.priorityName=n}keyName;key(e){return this.keyName=e,this}getKey(){return this.keyName}priority(e){return this.priorityName=e,this}getPriority(){return this.priorityName}remove(){this.owner._removeHandle(this)}},q=class{customListeners={};on(e,t,i=2){let n=new Le(e,t,this,i),o=this.customListeners[e];o||(o=[],this.customListeners[e]=o);let c=o.findIndex(a=>a.getPriority()>i);return c===-1?o.push(n):o.splice(c,0,n),n}once(e,t,i=2){let n=((...o)=>{t(...o),this.off(e,n)});return this.on(e,n,i)}off(e,t){let i=this.customListeners[e];if(!i)return!1;let n=i.length;return this.customListeners[e]=i.filter(o=>o.callback!==t),i.length<n}async call(e,t=void 0){let i=this.customListeners[e];if(!i)return t;for(let n of i){let o=n.callback(t);o instanceof Promise&&await o}return t}emit(e,...t){let i=this.customListeners[e];if(!i)return!1;for(let n of i)n.callback(...t);return i.length>0}async emitR(e,...t){let i=this.customListeners[e];if(!i)return[];let n=[];for(let o of i){let c=o.callback(...t);n.push(c instanceof Promise?await c:c)}return n}async wait(e,t=1e7){return new Promise((i,n)=>{let o=setTimeout(()=>{this.off(e,c)},t),c=(...a)=>{clearTimeout(o),this.off("message",c),i(a)};this.on(e,c)})}removeByKey(e){let t=!1;for(let i in this.customListeners){let n=this.customListeners[i];if(!n)continue;let o=n.length;this.customListeners[i]=n.filter(c=>c.getKey()!==e),this.customListeners[i].length<o&&(t=!0)}return t}_removeHandle(e){let t=this.customListeners[e.event];t&&(this.customListeners[e.event]=t.filter(i=>i!==e))}removeAllEvents(){this.customListeners={}}};var pe=window;function Q(){let d=pe.getComputedStyle(document.body),e=d.transform,t=pe.parseFloat(d.zoom||"1");if(e&&e!="none"){let i=e.match(/matrix\(([\d.]+),/);if(i)return pe.parseFloat(i[1])}return pe.isNaN(t)?1:t}function $(d=0){return new Promise(e=>setTimeout(e,d))}function Ke(d){let e="";for(let t in d){let i=t.replace(/[A-Z]{1}/g,n=>"-"+n.toLowerCase());if(i=="this"&&(i="&"),typeof d[t]=="object")if(pe.Array.isArray(d[t]))for(let n of d[t])e+=`${i}:${n};`;else e+=`${i}{${Ke(d[t])}}`;else e+=`${i}:${d[t]};`}return e}function Ye(d){let e="";for(let t in d){let i=d[t];e+=t+"{"+Ke(i)+"}"}return e}function P(d){return String(d).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/gi,"/")}var G=class extends q{constructor(t="Screen"){super();this.name=t;this.element=document.createElement("div"),this.element.tabIndex=1,this.element.style.width="100%",this.element.style.height="100%",$(50).then(()=>{r.on("resize",i=>this.emit("resize",i)).key(`screen_${t}`),r.on("keydown",i=>this.emit("keydown",i)).key(`screen_${t}`),r.on("keyup",i=>this.emit("keyup",i)).key(`screen_${t}`),r.on("click",i=>this.emit("click",i)).key(`screen_${t}`),r.server.on("message",i=>this.emit("message",i)).key(`screen_${t}`),this.element.focus()}),this.on("preBack",()=>{r.boxs.length>0?r.boxs[0].close():this.emit("back")}),this.on("keydown",i=>{i.key=="Escape"&&this.emit("preBack")})}element;reconnect(){}tick(t){this.emit("tick",t)}destroy(){this.removeAllEvents(),r.removeByKey(`screen_${this.name}`),r.server.removeByKey(`screen_${this.name}`),r.element.removeChild(this.element),this.element.remove()}};var Me=class{constructor(e){this.value=e}matched=!1;case(e,t){return!this.matched&&this.value===e&&(t(),this.matched=!0),this}else(e){return typeof e=="function"?e():e}};function me(d){return new Me(d)}function re(d,e,t,i){let n=d[e];Object.defineProperty(d,e,{get:()=>i?i():n,set:o=>{t?.(o),n=o},enumerable:!0})}var Ce=class{constructor(e="Macintosh HD"){this.dbName=e}db;objectStore="Storage";logDebug=!1;log(...e){this.logDebug&&console.log(...e)}init(){return new Promise((e,t)=>{let i=indexedDB.open(this.dbName,1);i.onupgradeneeded=()=>{i.result.createObjectStore(this.objectStore)},i.onsuccess=()=>{this.db=i.result,e()},i.onerror=()=>t(i.error)})}transaction(){return this.db.transaction([this.objectStore],"readwrite").objectStore(this.objectStore)}getPath(e){return e=String(e),e.startsWith("/")||(e="/"+e),e}async createFile(e){e=this.getPath(e),await this.writeFile(e,"")}async writeFile(e,t){e=this.getPath(e);let i=this.transaction();return new Promise((n,o)=>{let a={type:"file",content:t instanceof Blob?t:new Blob([t instanceof Uint8Array?t:String(t)])},E=i.put(a,e);E.onsuccess=()=>{this.log(`Writed file [${e}] = ${t instanceof Uint8Array?`${t.length} length of uint8array`:t instanceof Blob?`${t.size} length of blob`:typeof t=="object"?"":`${t.length} length of string`}`),n()},E.onerror=()=>{this.log(`Can't write file [${e}]`),o(E.error)}})}async readFile(e){e=this.getPath(e);let t=await this.readFileBytes(e);return new TextDecoder().decode(t)}async readFileBytes(e){e=this.getPath(e);let t=this.transaction();return new Promise((i,n)=>{let o=t.get(e);o.onsuccess=()=>{let c=o.result;c&&c.type=="file"?c.content instanceof Blob?c.content.arrayBuffer().then(a=>i(new Uint8Array(a))):n(new Error("Unsupported file content type")):n("File not found or not a file "+e)},o.onerror=()=>n(o.error)})}async readFileB64(e){e=this.getPath(e);let t=this.transaction();return new Promise((i,n)=>{let o=t.get(e);o.onsuccess=()=>{let c=o.result;c?.type==="file"?c.content.arrayBuffer().then(a=>{let E=new Uint8Array(a),m="";E.forEach(u=>m+=String.fromCharCode(u)),i(`data:${c.content.type||"application/octet-stream"};base64,${btoa(m)}`)}):n("File not found or not a file")},o.onerror=()=>n(o.error)})}async createDir(e){if(e=this.getPath(e),await this.existsDir(e))return;let t=this.transaction();return new Promise((i,n)=>{let o={type:"dir"},c=t.put(o,e);c.onsuccess=()=>{this.log(`Created directory ${e}`),i()},c.onerror=()=>{this.log("Can't create directory"),n(c.error)}})}async existsDir(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result!==void 0&&n.result.type=="dir"),n.onerror=()=>i(!1)})}async existsFile(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result!==void 0&&n.result.type=="file"),n.onerror=()=>i(!1)})}async exists(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result!==void 0),n.onerror=()=>i(!1)})}async isFile(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result?.type==="file"),n.onerror=()=>i(!1)})}async isDirectory(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result?.type==="dir"),n.onerror=()=>i(!1)})}async deleteFile(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.delete(e);n.onsuccess=()=>{this.log(`Deleted file ${e}`),i(!0)},n.onerror=()=>{this.log(`Can't delete file ${e}`),i(!1)}})}async deleteDirectory(e,t=!1){e=this.getPath(e);let i=this.transaction(),n=e.endsWith("/")?e:e+"/",o=[];return new Promise(c=>{let a=i.openCursor();a.onsuccess=()=>{let E=a.result;if(!E){let u=this.transaction();if(u.delete(e),t)for(let f of o)u.delete(f);this.log(`Deleted directory ${e} - ${t}`),c(!0);return}let m=E.key;t&&m.startsWith(n)&&o.push(m),E.continue()},a.onerror=()=>{this.log(`Can't delete directory ${e} - ${t}`),c(!1)}})}async listDir(e){e=this.getPath(e);let t=this.db.transaction("files","readonly").objectStore("files"),i=new Set,n=e.endsWith("/")?e:e+"/";return new Promise((o,c)=>{let a=t.openCursor();a.onsuccess=()=>{let E=a.result;if(!E)return o([...i]);let m=E.key;if(m.startsWith(n)){let u=m.slice(n.length).split("/")[0];i.add(u)}E.continue()},a.onerror=()=>c(a.error)})}async rename(e,t){e=this.getPath(e),t=this.getPath(t);let i=await this.readFileBytes(e);return await this.writeFile(t,i),this.log(`Rename ${e} - ${t}`),this.deleteFile(e)}async copyFile(e,t){e=this.getPath(e),t=this.getPath(t);let i=await this.readFileBytes(e);return await this.writeFile(t,i),this.log(`Copy ${e} - ${t}`),!0}async move(e,t){return e=this.getPath(e),t=this.getPath(t),await this.copyFile(e,t)?(this.log(`Move ${e} - ${t}`),this.deleteFile(e)):(this.log(`Can't move ${e} - ${t}`),!1)}async loadImage(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=new Blob([t]),n=URL.createObjectURL(i);return new Promise((o,c)=>{let a=new Image;a.onload=()=>{URL.revokeObjectURL(n),o(a)},a.onerror=()=>{URL.revokeObjectURL(n),c("Image load failed")},a.src=n})}cacheImagesAsDataURL={};async loadImageAsDataURL(e){e=this.getPath(e);let t=await this.getSHA1(e);if(this.cacheImagesAsDataURL[e]&&this.cacheImagesAsDataURL[e].sha1==t)return this.cacheImagesAsDataURL[e].result;let i=await this.readFileBytes(e),n=btoa(String.fromCharCode(...new Uint8Array(i))),c=`data:${k.getMimeType(e)};base64,${n}`;return this.cacheImagesAsDataURL[e]={sha1:t,result:c},c}async erase(){let e=this.transaction();return new Promise((t,i)=>{let n=e.openCursor();n.onsuccess=o=>{let c=o.target.result,a=this.db.transaction(Array.from(c.objectStoreNames),"readwrite"),E=Array.from(c.objectStoreNames);for(let m of E){let f=a.objectStore(m).clear();f.onsuccess=()=>{},f.onerror=y=>{new Error(`Error deleting store "${m}":`,y.target.error),t(!1)}}a.oncomplete=()=>{c.close(),t(!0)}},n.onerror=o=>{new Error("Error opening db",o.target.error),t(!1)}})}async getSHA1(e){e=this.getPath(e);let t=await this.readFileBytes(e);if(typeof crypto.subtle>"u")return Math.random().toString();let i=await crypto.subtle.digest("SHA-1",t);return Array.from(new Uint8Array(i)).map(o=>o.toString(16).padStart(2,"0")).join("")}};var xe=class{constructor(e){this.root=e}type="OPFS";logDebug=!1;log(...e){this.logDebug&&console.log(...e)}getPath(e){return e.startsWith("/")||(e="/"+e),e}async getPathParts(e){return e.replace(/^\/+/,"").split("/").filter(global.Boolean)}async getParentDirHandle(e,t=!1){e=this.getPath(e);let i=await this.getPathParts(e);i.pop();let n=this.root;for(let o of i)n=await n.getDirectoryHandle(o,{create:t});return n}async getFileHandle(e,t=!1){e=this.getPath(e);let n=(await this.getPathParts(e)).pop();return(await this.getParentDirHandle(e,t)).getFileHandle(n,{create:t})}async getDirectoryHandle(e,t=!1){e=this.getPath(e);let i=await this.getPathParts(e),n=this.root;for(let o of i)n=await n.getDirectoryHandle(o,{create:t});return n}async createFile(e){e=this.getPath(e),await this.getFileHandle(e,!0),this.log(`Created file [${e}]`)}async writeFile(e,t){e=this.getPath(e);let n=await(await this.getFileHandle(e,!0)).createWritable();t instanceof global.Uint8Array?await n.write(new global.Blob([t])):await n.write(t),await n.close(),this.log(`Writed file [${e}] = ${t instanceof global.Uint8Array?`${t.length} length of uint8array`:t instanceof global.Blob?"":`${t.length} length of string`}`)}async readFile(e){e=this.getPath(e);try{return await(await(await this.getFileHandle(e)).getFile()).text()}catch{throw error(`Can't read file [${e}]`)}}async readFileBytes(e){e=this.getPath(e);try{let n=await(await(await this.getFileHandle(e)).getFile()).arrayBuffer();return new global.Uint8Array(n)}catch{throw error(`Can't read file [${e}]`)}}async readFileB64(e){e=this.getPath(e);try{let t="",n=await(await this.getFileHandle(e)).getFile(),o=await n.arrayBuffer();return new global.Uint8Array(o).forEach(a=>t+=global.String.fromCharCode(a)),`data:${n.type||"application/octet-stream"};base64,${global.btoa(t)}`}catch{throw error(`Can't read file [${e}]`)}}async loadImage(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=new global.Blob([t]),n=global.URL.createObjectURL(i);return new Promise((o,c)=>{let a=new global.Image;a.onload=()=>{global.URL.revokeObjectURL(n),o(a)},a.onerror=E=>{global.URL.revokeObjectURL(n),c(`Failed to load image: ${E}`)},a.src=n})}async loadImageAsDataURL(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=global.btoa(global.String.fromCharCode(...new global.Uint8Array(t)));return`data:${k.getMimeType(e)};base64,${i}`}async createDir(e){e=this.getPath(e),!await this.existsDir(e)&&(await this.getDirectoryHandle(e,!0),this.log(`Created directory [${e}]`))}async exists(e){e=this.getPath(e);let t=!1,i=!1;try{await this.getFileHandle(e),t=!0}catch{}try{await this.getDirectoryHandle(e),i=!0}catch{}return t||i}async existsFile(e){e=this.getPath(e);try{return await this.getFileHandle(e),!0}catch{}return!1}async existsDir(e){e=this.getPath(e);try{return await this.getDirectoryHandle(e),!0}catch{}return!1}async isFile(e){e=this.getPath(e);try{return await this.getFileHandle(e),!0}catch{return!1}}async isDirectory(e){e=this.getPath(e);try{return await this.getDirectoryHandle(e),!0}catch{return!1}}async deleteFile(e){if(e=this.getPath(e),!await this.existsFile(e))return this.log(`Can't delete file [${e}] - not exists`),!1;try{let i=(await this.getPathParts(e)).pop();return await(await this.getParentDirHandle(e)).removeEntry(i),this.log(`Deleted file [${e}]`),!0}catch(t){return this.log(`Can't delete file [${e}] - ${t}`),!1}}async deleteDirectory(e,t=!1){if(e=this.getPath(e),!await this.existsDir(e))return this.log(`Can't delete directory [${e}] - not exists`),!1;try{let n=(await this.getPathParts(e)).pop();return await(await this.getParentDirHandle(e)).removeEntry(n,{recursive:t}),this.log(`Deleted directory [${e}]`),!0}catch(i){return this.log(`Can't delete directory [${e}] - ${i}`),!1}}async listDir(e){e=this.getPath(e);try{let t=await this.getDirectoryHandle(e),i=[];for await(let[n]of t.entries())i.unshift(n);return i}catch{return[]}}async rename(e,t){e=this.getPath(e),t=this.getPath(t);try{let i=await this.readFileBytes(e);await this.writeFile(t,i);let n=await this.deleteFile(e);return n?this.log(`Renamed file ${e} - ${t}`):this.log("Failed to delete original file during rename"),n}catch{return this.log(`Can't rename file ${e} - ${t}`),!1}}async copyFile(e,t){e=this.getPath(e),t=this.getPath(t);try{let i=await this.readFileBytes(e);return await this.writeFile(t,i),this.log(`Copy ${e} - ${t}`),!0}catch{return this.log(`Can't copy ${e} - ${t}`),!1}}async move(e,t){return e=this.getPath(e),t=this.getPath(t),await this.copyFile(e,t)?(this.log(`Move ${e} - ${t}`),await this.deleteFile(e)):(this.log(`Can't move ${e} - ${t}`),!1)}async erase(){async function e(t){for await(let[i,n]of t.entries())n.kind=="file"?await t.removeEntry(i):n.kind=="directory"&&(await e(n),await t.removeEntry(i,{recursive:!0}))}return await e(this.root),!0}async getSHA1(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=await global.crypto.subtle.digest("SHA-1",t);return global.Array.from(new global.Uint8Array(i)).map(o=>o.toString(16).padStart(2,"0")).join("")}};var Oe=class{type="InMemory";logDebug=!1;data={};log(...e){this.logDebug&&console.log(...e)}getPath(e){return e.startsWith("/")||(e="/"+e),e}async createFile(e){this.data[this.getPath(e)]={content:new Uint8Array,isDir:!1},this.log(`Created file [${e}]`)}async writeFile(e,t){e=this.getPath(e);let i;if(typeof t=="string")i=new TextEncoder().encode(t);else if(t instanceof Blob){let n=await t.arrayBuffer();i=new Uint8Array(n)}else if(t instanceof Uint8Array)i=t;else if(typeof t=="object")i=new TextEncoder().encode(JSON.stringify(t));else throw error("Unsupported data type");this.data[e]={content:i,isDir:!1},this.log(`Wrote to file [${e}]`)}async readFile(e){e=this.getPath(e);let t=this.data[e];if(!t||t.isDir)throw error(`File not found: ${e}`);return new global.TextDecoder().decode(t.content)}async readFileBytes(e){e=this.getPath(e);let t=this.data[e];if(!t||t.isDir)throw error(`File not found: ${e}`);return t.content}async readFileB64(e){e=this.getPath(e);let t=await this.readFileBytes(e);return global.btoa(global.String.fromCharCode.apply(null,t))}async loadImage(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=new global.Blob([t]),n=global.URL.createObjectURL(i);return new Promise((o,c)=>{let a=new global.Image;a.onload=()=>{global.URL.revokeObjectURL(n),o(a)},a.onerror=E=>{global.URL.revokeObjectURL(n),c(`Failed to load image: ${E}`)},a.src=n})}async loadImageAsDataURL(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=global.btoa(global.String.fromCharCode(...new global.Uint8Array(t)));return`data:${k.getMimeType(e)};base64,${i}`}async createDir(e){e=this.getPath(e),!await this.existsDir(e)&&(this.data[e]={content:new Uint8Array(0),isDir:!0},this.log(`Created directory [${e}]`))}async exists(e){return e=this.getPath(e),!!this.data[e]}async existsFile(e){e=this.getPath(e);let t=this.data[e];return!!(t&&!t.isDir)}async existsDir(e){e=this.getPath(e);let t=this.data[e];return!!(t&&t.isDir)}async isFile(e){e=this.getPath(e);let t=this.data[e];return!!(t&&!t.isDir)}async isDirectory(e){e=this.getPath(e);let t=this.data[e];return!!(t&&t.isDir)}async deleteFile(e){return e=this.getPath(e),await this.existsFile(e)?(delete this.data[e],this.log(`Deleted file [${e}]`),!0):(this.log(`Can't delete file [${e}] - not exists`),!1)}async deleteDirectory(e,t=!1){if(e=this.getPath(e),!await this.existsDir(e))return this.log(`Can't delete directory [${e}] - not exists`),!1;if(!t){for(let n in this.data)if(n!=e&&n.startsWith(e+"/"))return this.log(`Directory not empty: ${e}`),!1}let i=Object.keys(this.data).filter(n=>n==e||n.startsWith(e+"/"));for(let n of i)delete this.data[n];return this.log(`Deleted directory [${e}]`),!0}async listDir(e){if(e=this.getPath(e),!await this.existsDir(e))throw error(`Directory not found: ${e}`);let t=new Set;for(let i in this.data)if(i!=e&&i.startsWith(e+"/")){let n=i.substring(e.length+1),o=n.indexOf("/"),c=o==-1?n:n.substring(0,o);t.add(c)}return Array.from(t)}async rename(e,t){if(e=this.getPath(e),t=this.getPath(t),!await this.exists(e))return this.log(`Rename failed: source [${e}] does not exist`),!1;if(await this.exists(t))return this.log(`Rename failed: target [${t}] already exists`),!1;let i=await this.isDirectory(e),n=this.data[e];if(i){let o=Object.keys(this.data).filter(c=>c.startsWith(e+"/"));for(let c of o){let a=c.substring(e.length);this.data[t+a]=this.data[c],delete this.data[c]}}else this.data[t]=n,delete this.data[e];return this.log(`Renamed [${e}] \u2192 [${t}]`),!0}async copyFile(e,t){if(e=this.getPath(e),t=this.getPath(t),!await this.existsFile(e))return this.log(`Copy failed: source file [${e}] does not exist`),!1;if(await this.exists(t))return this.log(`Copy failed: target file [${t}] already exists`),!1;let i=this.data[e].content;return this.data[t]={content:i,isDir:!1},this.log(`Copied [${e}] \u2192 [${t}]`),!0}async move(e,t){return e=this.getPath(e),t=this.getPath(t),await this.copyFile(e,t)?(this.log(`Move ${e} - ${t}`),await this.deleteFile(e)):(this.log(`Can't move ${e} - ${t}`),!1)}async erase(){return this.data={},!0}async getSHA1(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=await global.crypto.subtle.digest("SHA-1",t);return global.Array.from(new global.Uint8Array(i)).map(o=>o.toString(16).padStart(2,"0")).join("")}};var Ne=class d{logDebug=!1;backend;type="OPFS";async init(e="auto",t){e=="auto"&&(e="InMemory","Indexeddb"in window&&(e="Indexeddb"),typeof navigator.storage<"u"&&(e="OPFS")),this.type=e,await this.changeBackend(e,t,!0),console.log("Filesystem initialized")}async changeBackend(e="InMemory",t,i=!1){let n=e.toLowerCase();if(!(this.type==e&&!i)){if(n=="opfs"){if(location.protocol=="file:")throw new Error("OPFS doesn't work on protocol file://");(!t||!(t instanceof FileSystemDirectoryHandle))&&(t=await navigator.storage.getDirectory()),this.backend=new xe(t)}else if(n=="indexeddb"){let o=new Ce(typeof t=="string"?t:"BafiaOnline");await o.init(),this.backend=o}else if(n=="inmemory")this.backend=new Oe;else throw new Error("No backend");this.type=e,console.log("FS Type: "+e),this.backend.logDebug=!1}}static async get(e="InMemory",t){return await new d().init(e,t)}getMimeType(e){let t=e.toLowerCase().split(".").pop()||"";return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",webp:"image/webp",svg:"image/svg+xml",ico:"image/x-icon",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",m4a:"audio/mp4",mp4:"video/mp4",webm:"video/webm",mov:"video/quicktime",txt:"text/plain",html:"text/html",htm:"text/html",css:"text/css",js:"application/javascript",json:"application/json",xml:"application/xml",pdf:"application/pdf",zip:"application/zip",rar:"application/x-rar-compressed","7z":"application/x-7z-compressed",tar:"application/x-tar",gz:"application/gzip",bin:"application/octet-stream",exe:"application/octet-stream",dll:"application/octet-stream"}[t]||"application/octet-stream"}createFile(e){return this.backend.createFile(e)}writeFile(e,t){return this.backend.writeFile(e,t)}readFile(e){return this.backend.readFile(e)}readFileBytes(e){return this.backend.readFileBytes(e)}readFileB64(e){return this.backend.readFileB64(e)}createDir(e){return this.backend.createDir(e)}existsDir(e){return this.backend.existsDir(e)}existsFile(e){return this.backend.existsFile(e)}exists(e){return this.backend.exists(e)}isFile(e){return this.backend.isFile(e)}isDirectory(e){return this.backend.isDirectory(e)}deleteFile(e){return this.backend.deleteFile(e)}deleteDirectory(e,t){return this.backend.deleteDirectory(e,t)}listDir(e){return this.backend.listDir(e)}rename(e,t){return this.backend.rename(e,t)}copyFile(e,t){return this.backend.copyFile(e,t)}move(e,t){return this.backend.move(e,t)}loadImage(e){return this.backend.loadImage(e)}loadImageAsDataURL(e){return this.backend.loadImageAsDataURL(e)}erase(){return this.backend.erase()}getSHA1(e){return this.backend.getSHA1(e)}},k=new Ne;var dt={ACCEPTED:"a",ACCEPT_MESSAGES:"ac",ACTIVE:"ac",ACTIVITY:"ac",ADD_CLIENT_TO_CHAT:"acc",ADD_CLIENT_TO_DASHBOARD:"acd",ADD_CLIENT_TO_FRIENDSHIP_LIST:"acfl",ADD_CLIENT_TO_PRIVATE_CHAT:"acpc",ADD_CLIENT_TO_ROOMS_LIST:"acrl",ADD_FRIEND:"af",ADD:"add",ADD_PLAYER:"ap",ADMIN_BLOCK_USER:"abu",ADMIN_CONTROL_USER:"acu",ADMIN:"adm",ADMIN_KICK_USER:"aku",ADMIN_UNBLOCK_USER:"auu",AFFECTED_BY_ROLES:"abr",ALIVE:"a",APP_LANGUAGE:"alc",ASPIRIN:"a",BACKPACK:"bp",BILLING_APP_PACKAGE:"bapckg",BILLING_PRODUCT_ID:"bpid",BILLING_PURCHASE_PENDING:"bppndng",BILLING_PURCHASE_TOKEN:"bptkn",BLOCKED_USERS:"bus",BLOCK_DEVICE:"bdv",BLOCK_IP:"bi",BONUSES_ENABLED:"bns",BONUS_PRICE:"bp",BRIBE:"b",BUY_BILLING_MARKET_ITEM:"mrktgg",BUY_BILLING_MARKET_SUCCESS_ITEM:"bbmrktis",BUY_MARKET_ITEM:"bmrkti",BUY_MARKET_ITEM_SUCCESS:"bmrktis",CHAT_MESSAGE_CREATE:"cmc",CHECK_PLAYER_IS_IN_ROOM:"cpir",CIVILIAN_ALIVE:"c",CIVILIAN_ALL:"ca",CLEAN_VOTES_HISTORY:"cv",CLOUD_MESSAGING_TOKEN_IS_SAVED:"cmts",COMPLAINTS:"cmps",COMPLAINT:"cmp",CONDOM:"cm",CONFESSION:"cn",CONNECTION_CHECKER_PERIOD:"ccp",CONNECTION_INACTIVE_TIMEOUT:"cit",CREATED:"c",CREATE_PLAYER:"cp",CREATOR_BLOCKED:"crb",DATA:"data",DAYTIME:"d",DESCRIPTION:"dsc",DEVICE_ID:"d",EMAIL:"e",EMAIL_NOT_VERIFIED:"env",EMAIL_NOT_VERIFIED_MESSAGE_CREATE_TIMEOUT:"envmct",ERROR_FLOOD_DETECTED:"erfd",ERROR:"e",ERROR_OCCUR:"ero",EXPERIENCE:"ex",FILE:"f",FIRST_AID_KIT:"f",FIRST_NAME:"fn",FRIENDSHIP_FLAG:"fpf",FRIENDSHIP:"fp",FRIENDSHIP_LIST:"frl",FRIENDSHIP_LIST_LIMIT:"fll",FRIENDSHIP_LIST_LIMIT_FOR_VIP:"fllfv",FRIENDSHIP_REQUESTS:"fr",FRIENDS_IN_INVITE_LIST:"fiil",FRIEND_IN_ROOM:"fir",FRIEND_IS_INVITED:"fiinvtd",FRIEND:"ff",FRIEND_USER_OBJECT_ID:"f",GAME_DAYTIME:"gd",GAME_FINISHED:"gf",GAME_STARTED:"gsd",GAME_STATUS_IN_ROOMS_LIST:"gsrl",GAME_STATUS:"gs",GET_BLOCKED_USERS:"gbus",GET_COMPLAINTS:"gcmps",GET_FRIENDS_IN_INVITE_LIST:"gfiil",GET_PLAYERS:"gp",GET_RATING:"gr",GET_SENT_FRIEND_REQUESTS_LIST:"gsfrl",GET_USER_PROFILE:"gup",GET_MATCH_MAKING_USERS_IN_QUEUE_INTERVAL:"mmguiabk",GIVE_UP:"agu",GIFT_MARKET_ITEMS:"gmrkti",GOLD:"g",GOOGLE_SIGN_IN:"gsin",GOOGLE_TOKEN:"gt",GOOGLE_USER_ID:"gui",HIS_FRIENDSHIP_LIST_FULL:"hflf",INFO_MESSAGE:"imsg",INVITATION_SENDER_USERNAME:"isun",IP_ADDRESS:"ip",IS_BILLING_ITEM:"ibi",IS_DAY_ACTION_USED:"idau",IS_INVITED:"iinvtd",IS_NIGHT_ACTION_ALTERNATIVE:"inaa",IS_NIGHT_ACTION_USED:"inau",IS_ONLINE:"on",ITEM_PRICE_TEXT:"iprct",KICK_TIMER:"kt",KICK_USER_AUTHORITY_LESS_THAN_USER:"kualtu",KICK_USER_GAME_STARTED:"kugs",KICK_USER:"ku",KICK_USER_NOT_IN_ROOM:"kunir",KICK_USER_OBJECT_ID:"k",KICK_USER_PRICE:"kup",KICK_USER_RANK:"kur",KICK_USER_STARTED:"kus",KICK_USER_VOTE:"kuv",LAST_NAME:"ln",LEVEL:"l",LIE_DETECTOR:"l",MAFIA_ALIVE:"m",MAFIA_ALL:"ma",MAKE_COMPLAINT:"mc",MATCH_MAKING_MATCH_STATUS:"mmms",MATCH_MAKING_BASE_PLAYERS_AMOUNT:"mmbpa",MATCH_MAKING_GET_STATUS:"mmgsk",MATH_MAKING_ADD_USER:"mmauk",MARKET_ITEMS:"mrkti",MAXIMUM_PLAYERS:"mxmp",MAX_PLAYERS:"mxp",MESSAGES:"ms",MESSAGE:"m",MESSAGE_STYLE:"mstl",MESSAGE_TYPE:"t",MESSAGE_STICKER:"mstk",MIN_LEVEL:"mnl",MIN_PLAYERS:"mnp",MONEY:"mo",NEW_CLOUD_MESSAGING_TOKEN:"ncmt",NEW_MESSAGES:"nm",NEXT_LEVEL_EXPERIENCE:"nle",NOT_ENOUGH_AUTHORITY_ERROR:"neae",NO_CHANGES:"noch",NUM:"n",NUM_MAFIA:"m",NUM_PLAYERS:"p",OBJECT_ID:"o",PASSWORD:"pw",PHOTO:"ph",PLAYED_GAMES:"pg",PLAYERS_IN_ROOM:"pin",PLAYERS:"pls",PLAYERS_NUM:"pn",PLAYERS_STAT:"ps",PLAYER:"p",PLAYER_ROLE_STATISTICS:"prst",PREVIOUS_LEVEL_EXPERIENCE:"ple",PRICE_USERNAME_SET:"pus",PRIVATE_CHAT_MESSAGE_CREATE:"pmc",RANKS:"r",RATING:"rtg",RATING_MODE:"rmd",RATING_TYPE:"rt",RATING_USERS_LIST:"rul",RATING_VALUE:"rv",REASON:"r",REMOVE_COMPLAINT:"rcmp",REMOVE_FRIEND:"rf",REMOVE_INVITATION_TO_ROOM:"ritr",REMOVE:"rm",REMOVE_MESSAGES:"rmm",REMOVE_PHOTO:"rph",REMOVE_PLAYER:"rp",REMOVE_USER:"rmu",ROLES:"roles",ROLE_ACTION:"ra",ROLE:"r",ROOMS:"rs",ROOM_CREATED:"rcd",ROOM_CREATE:"rc",ROOM_ENTER:"re",ROOM_MODEL_TYPE:"rmt",ROOM_STATISTICS:"rst",ROOM_IN_LOBBY_STATE:"rils",ROOM:"rr",ROOM_MESSAGE_CREATE:"rmc",ROOM_OBJECT_ID:"ro",ROOM_PASSWORD_IS_WRONG_ERROR:"rpiw",ROOM_PASS:"psw",ROOM_STATUS:"rs",SCORE:"sc",SCREENSHOT:"sc",SEARCH_TEXT:"st",SEARCH_USER:"su",SELECTED_ROLES:"sr",SEND_FRIEND_INVITE_TO_ROOM:"sfitr",SERVER_CONFIG:"scfg",SERVER_LANGUAGE_CHANGE_TIME:"slct",SERVER_LANGUAGE:"slc",SERVER_ROOM_TITLE_MINIMAL_LEVEL:"srtml",SERVER_ROOM_PASSWORD_MINIMAL_LEVEL:"srpml",SET_ROOM_PASSWORD_MIN_AUTHORITY:"srpma",SET_PROFILE_PHOTO_MINIMAL_LEVEL:"sppml",SET_SERVER_LANGUAGE_TIME_ERROR:"sslte",SEX:"s",SHOW_PASSWORD_ROOM_INFO_BUTTON:"sprib",SIGN_IN_ERROR:"siner",SIGN_IN:"sin",SIGN_OUT_USER:"soutu",STATUS:"s",TEAM:"t",TEXT:"tx",TIMER:"t",TIME:"t",TIME_SEC_REMAINING:"tsr",TIME_UNTIL:"tu",TITLE:"tt",TOKEN:"t",TYPE_ERROR:"err",TYPE:"ty",UPDATED:"up",UPLOAD_PHOTO:"upp",UPLOAD_SCREENSHOT:"ups",USED_LAST_MESSAGE:"um",USERNAME_HAS_WRONG_SYMBOLS:"unws",USERNAME_IS_EMPTY:"unie",USERNAME_IS_EXISTS:"unex",USERNAME_IS_OUT_OF_BOUNDS:"unob",USERNAME:"u",USERNAME_SET:"uns",USERNAME_TRANSLIT:"ut",USERS:"u",USER_BLOCKED:"ublk",USER_CHANGE_SEX:"ucs",USER_DASHBOARD:"uud",USER_DATA:"ud",USER_INACTIVE_BLOCKED:"uib",USER_IN_ANOTHER_ROOM:"uiar",USER_IN_A_ROOM:"uir",USER_IS_NOT_VIP:"uinv",USER_IS_NOT_VIP_TO_INVITE_FRIENDS_IN_ROOM:"uinvtifr",USER:"uu",USER_KICKED:"ukd",USER_LEVEL_NOT_ENOUGH:"ulne",USER_NOT_IN_A_ROOM:"unir",USER_OBJECT_ID:"uo",USER_PROFILE:"uup",USER_RANK_FOR_KICK:"ur",USER_RANK:"r",USER_RECEIVER:"ur",USER_ROLE_ERROR:"ure",USER_SENDER:"us",USER_SENDER_OBJECT_ID:"uso",USER_SET_SERVER_LANGUAGE:"usls",USER_SET_USERNAME_ERROR:"ueue",USER_ENERGY:"ue",USER_SIGN_IN:"usi",USER_USING_DOUBLE_ACCOUNT:"uuda",VEST:"v",VIP_ENABLED:"venb",VIP:"v",VIP_ACCOUNT:"vip_account",VIP_UPDATED:"vupd",VOTES:"v",VOTE:"v",WHO_WON:"w",WINS_AS_KILLER:"wik",WINS_AS_MAFIA:"wim",WINS_AS_PEACEFUL:"wip",WRONG_FILE_SIZE:"wfs",WRONG_FILE_TYPE:"wft",YOUR_FRIENDSHIP_LIST_FULL:"yflf",ID:"i",MATCH_MAKING_SCORE:"mmscr",MATCH_MAKING_ADD_USER:"mmauk",MATCH_MAKING_REMOVE_USER:"mmruk",MATCH_MAKING_LIST_KEY:"mmblk",MATCH_MAKING_USER_IN_ROOM:"mmuir",MATCH_MAKING_BUCKET_RESPONSE_PLAYERS_AMOUNT:"mmbpa",VOTE_PLAYER_LIST:"vpl",PRIVATE_CHAT_LIST_MESSAGES:"pclms",PROFILE_USER_DATA:"pud",USER_ACCOUNT_COINS:"uac",SILVER_COINS:"scns",GOLD_COINS:"gcns",DECORATIONS:"dcrs",SAME_ROOM:"isr",BLOCKED_USER_INFO:"bui",DECORATION_ID:"did",DECORATION_TYPE:"dt",DECORAION_PARARAMETER:"dp",USER_CURRENET_ENERGY_AMOUNT:"ucea",USER_MAX_FREE_ENERGY_AMOUNT:"umfea",USER_ENERGY_AMOUNT_FIRST_TIMER:"ueaft",USER_ENERGY_AMOUNT_NEXT_TIMERS:"ueant",CREATOR_OBJECT_ID:"rco",VIP_REMANING_MILLISECONDS:"vrms",DASHBOARD_USER:"du",BACKPACK_SIZE:"bps",BACKPACK_VIP_SIZE:"bpsv",AVAILABLE_DECORATIONS:"bids",ACTIVATED_DECORATIONS:"aids",BACKPACK_ITEM_ID:"bio",WHO_BLOCKED_USER_ID:"wbuo",IS_USER_ID_MATCHED:"iuoim",IS_DEVICE_ID_MATHED:"idim",IS_IP_ADDRESS_MATCHED:"iipam",ACTIVATED_ITEM_OBJECT_ID:"aio",ITEM_EXPIRE_AFTER:"iea",MARKET_PRODUCT_ID:"mpid",MARKET_OFFER_COIN_TYPE:"moct",MARKET_OFFER_PRICE:"mop",MARKET_OFFER_DURATION:"mod",MARKET_COINS_AMOUNT:"mca",MARKET_COIN_TYPE:"mct",PAYMENT_URL:"puk",ITEM_PRISE_TESXT:"iprct",BILLING_PURCHASE_ACCOUNT_ID:"bpaid",MARKET_ITEM_DECORATION:"mid",MARKET_ITEM_OFFERS:"mio",PHOTO_FILENAME:"ph",MARKET_ITEM_DECORATIONS:"mids",MARKET_BILLING_ITEM:"mbi",MARKET_VIP_ITEMS:"mivs",MARKET_SILVER_COIN_ITEMS:"misc",MARKET_OFFER_ID:"moid",SELECTED_PARAMETERS_IDS:"dp",CACHE_KEY:"cchk",USER_DEFAULT_PHOTOS_IDS:"usdphi",IS_MATCH_MAKING_ENABLED:"is_match_making_enabled",IS_BACKPACK_ENABLED:"is_backpack_enabled",MATCH_MAKING_MINIMUM_LEVEL:"match_making_minimum_level",PUBLIC_CHAT_MINIMUM_LEVEL:"public_chat_minimum_level",PLAYERS_DATA:"data",VERSION_CODE:"vc",MATCH_MAKING_FINDED_USERS_NUMBER:"mmfun",PRIVATE_CHAT_LAST_MESSAGE:"pclm",USER_GET_DEFAULT_PHOTOS:"usgdph",USER_DEFAULT_PHOTOS:"usdph",DASHBOARD:"db",BACKPACK_GET:"bpg",MARKET_BILLING_TYPE:"mbt",MARKET_GET:"mrktg",MARKET:"mr",BUY_BILLING_VIP_ITEM:"bbvi",BUY_SILVER_COINS_ITEM:"bsci",BUY_DECORATION:"bd",BUY_DECORATION_REQUEST:"bdr",MATCH_MAKING_ADD_GAME:"mmag",MATCH_MAKING_USER_ADD_GAME:"mmcuag",MATCH_MAKING_USER_SELECT_ROLE:"mmusr",MATCH_MAKING_COUNT_USER_SELECTED_ROLES:"mmcusr",MATCH_MAKING_ROOM:"mmrr",MATCH_MAKING_ROLES_COUNT:"mmrc",NEED_MINIMUM_LEVEL_CHAT:"nelfpc",NEED_MINIMUM_LEVEL_MM:"nelfmm",USER_CHANGE_EMAIL:"uche",USER_RESET_PASSWORD:"usrp",USER_RESET_PASSWORD_SENDED:"usrps",USER_WITH_EMAIL_NOT_EXISTS:"uwene",USTMR:"ustmr",USRSFR:"usrsfr"},s=dt;async function Z(d){if(!d)return r.resources.unknownChat;let e=d[s.PHOTO]??d.photo,t=d[s.OBJECT_ID]??d.objectId,i=`avatars_${t}`;if(r.resources[i])return r.resources[i];let n=async()=>{let E=await ht(e);return r.resources[i]=E,E},o=E=>new Promise(m=>{let u=new Image,f=!1;u.onload=()=>{f||(f=!0,r.resources[i]=E,m(E))},u.onerror=async()=>{f||(f=!0,m(null))},u.src=E,setTimeout(()=>{f||(f=!0,m(null))},1e4)}),c=await o(`https://dottap.com/mafia/profile_photo/default/${e}.jpg`);if(c)return c;let a=await o(`https://dottap.com/mafia/profile_photo/${t}.jpg?v=${Math.random()}`);return a||n()}async function ht(d=""){return r.resources[`defaultAvatars_${d}`]?r.resources[`defaultAvatars_${d}`]:(r.resources[`defaultAvatars_${d}`]=await k.loadImageAsDataURL(`${r.config.path}/assets/textures/logo/avatar.jpg`),r.resources[`defaultAvatars_${d}`])}async function z(d){return r.resources[`role_${d}`]?r.resources[`role_${d}`]:(r.resources[`role_${d}`]=await k.loadImageAsDataURL(`${r.config.path}/assets/textures/roles/${d}.png`),r.resources[`role_${d}`])}async function K(d){return r.resources[`background_${d}`]?r.resources[`background_${d}`]:(r.resources[`background_${d}`]=await k.loadImageAsDataURL(`${r.config.path}/assets/textures/backgrounds/${d}.png`),r.resources[`background_${d}`])}async function B(d){return r.resources["assets/textures/"+d]?r.resources["assets/textures/"+d]:(r.resources["assets/textures/"+d]=await k.loadImageAsDataURL(`${r.config.path}/assets/textures/${d}`),r.resources["assets/textures/"+d])}var ge=class extends G{constructor(t){super("Loading");this.title=t;r.title="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430",(async()=>this.element.style.background=`url(${await K("menu3")}) 0% 0% / cover`)();let i=document.createElement("div");i.className="header",this.element.appendChild(i);let n=document.createElement("label");n.innerHTML="\u0411\u0430\u0444\u0438\u044F \u043E\u043D\u043B\u0430\u0439\u043D",i.appendChild(n);let o=document.createElement("div");o.style.textAlign="center",this.element.appendChild(o);let c=document.createElement("p");c.innerHTML=t,o.appendChild(c),re(this,"title",a=>c.innerHTML=a),this.on("back",()=>r.destroy()),(async()=>(this.loadingElem=document.createElement("img"),this.loadingElem.src=await B("loading/2f.png"),o.appendChild(this.loadingElem)))()}loadingElem;rotation=0;tick(t){t%2<1||(this.loadingElem&&(this.loadingElem.style.transform=`rotateZ(${this.rotation%360}deg)`),this.rotation+=30)}};var ee={CIVILIAN:1,DOCTOR:2,SHERIFF:3,MAFIA:4,LOVER:5,TERRORIST:6,JOURNALIST:7,BODYGUARD:8,BARMAN:9,SPY:10,INFORMER:11},Ve=["","\u041E\u0432\u043E\u0449","\u0414\u043E\u043A\u0442\u043E\u0440","\u0428\u0435\u0440\u0438\u0444","\u041C\u0430\u0444\u0438\u044F","\u041B\u044E\u0431\u043E\u0432\u043D\u0438\u0446\u0430","\u0422\u0435\u0440\u0440\u043E\u0440\u0438\u0441\u0442","\u0416\u0443\u0440\u043D\u0430\u043B\u0438\u0441\u0442","\u0422\u0435\u043B\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435\u043B\u044C","\u0411\u0430\u0440\u043C\u0435\u043D","\u0428\u043F\u0438\u043E\u043D","\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0442\u043E\u0440"];var fe=class{username="User";objectId="";token="";bToken="";serverLanguage="";status=0;level=0;experience=0;nextLevelExperience=0;previousLevelExperience=0;isOnline=!0;matchMakingScore=0;photo="";playedGames=0;playerRoleStatistics={[ee.CIVILIAN]:0,[ee.DOCTOR]:0,[ee.SHERIFF]:0,[ee.MAFIA]:0,[ee.LOVER]:0,[ee.TERRORIST]:0,[ee.JOURNALIST]:0,[ee.BODYGUARD]:0,[ee.BARMAN]:0,[ee.SPY]:0,[ee.INFORMER]:0};updated=0;userRank=0;vipUpdated=0;vip=!1;winsAsKiller=0;winsAsMafia=0;winsAsPeaceful=0;goldCoins=0;sliverCoins=0;update(e){this.objectId=e[s.OBJECT_ID],this.username=e[s.USERNAME],this.photo=e[s.PHOTO],this.status=e[s.STATUS],this.token=e[s.TOKEN],this.experience=e[s.EXPERIENCE],this.nextLevelExperience=e[s.NEXT_LEVEL_EXPERIENCE],this.previousLevelExperience=e[s.PREVIOUS_LEVEL_EXPERIENCE],this.level=e[s.LEVEL],this.userRank=e[s.USER_RANK],this.playedGames=e[s.PLAYED_GAMES],this.playerRoleStatistics=e[s.PLAYER_ROLE_STATISTICS],this.serverLanguage=e[s.SERVER_LANGUAGE],this.updated=e[s.UPDATED],this.vip=!!e[s.VIP],this.winsAsKiller=e[s.WINS_AS_KILLER],this.winsAsMafia=e[s.WINS_AS_MAFIA],this.winsAsPeaceful=e[s.WINS_AS_PEACEFUL]}};function N(){return window.navigator.maxTouchPoints||"ontouchstart"in document}function je(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var oe=class extends G{constructor(){super("Auth"),r.title="\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F",(async()=>this.element.style.background=`url(${await K("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("label");t.textContent="\u0411\u0430\u0444\u0438\u044F \u043E\u043D\u043B\u0430\u0439\u043D",e.appendChild(t);let i=document.createElement("div");i.style.textAlign="center",i.style.padding="10px",this.element.appendChild(i);let n=document.createElement("h3");n.textContent="\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F",i.appendChild(n);let o=document.createElement("input");o.placeholder="e-mail \u0438\u043B\u0438 \u043D\u0438\u043A",i.appendChild(o),i.appendChild(document.createElement("br"));let c=document.createElement("input");c.placeholder="\u041F\u0430\u0440\u043E\u043B\u044C",c.type="password",c.autocomplete="off",c.readOnly=!0,c.style.marginTop="5px",c.onfocus=()=>c.readOnly=!1,i.appendChild(c),i.appendChild(document.createElement("br"));let a=document.createElement("p");a.textContent="\u0438\u043B\u0438",a.style.margin="5px",i.appendChild(a);let E=document.createElement("input");E.placeholder="\u0422\u043E\u043A\u0435\u043D",i.appendChild(E),i.appendChild(document.createElement("br"));let m=document.createElement("input");m.placeholder="ID \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",m.style.marginTop="5px",i.appendChild(m),i.appendChild(document.createElement("br")),i.appendChild(document.createElement("br"));let u=document.createElement("button");u.textContent="\u0412\u043E\u0439\u0442\u0438",u.onclick=async()=>{await r.server.auth.auth({email:o.value,password:c.value,token:E.value,userId:m.value})},i.appendChild(u);let f=document.createElement("button");f.textContent="\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F",f.onclick=async()=>{await r.server.auth.signUp({email:o.value,password:c.value})},i.appendChild(f);let y=document.createElement("p");if(y.innerHTML=`
\u041C\u044B \u043D\u0435 \u0441\u043E\u0431\u0438\u0440\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u043E\u0432.<br/>
\u041D\u0430\u0448 \u0438\u0441\u0445\u043E\u0434\u043D\u044B\u0439 \u043A\u043E\u0434 \u043E\u0442\u043A\u0440\u044B\u0442 <a href="https://github.com/lumik0/bafiaonline">Github</a><br/>
<br/>
`,i.appendChild(y),N()){let _=document.createElement("button");_.textContent="\u0417\u0430\u043A\u0440\u044B\u0442\u044C \u0438\u0433\u0440\u0443",_.addEventListener("click",()=>r.win.close()),i.appendChild(_)}}};var V=class extends q{constructor(t={},i=document.createElement("div")){super();this.element=i;let n=this;this.id=r.boxs.length,r.boxs.push(this),r.screen.element.style.pointerEvents="none";let o=t.width??300,c=t.height??150,a=Q();this.element.style.width=o+"px",this.element.style.height=c+"px",this.element.style.position="absolute",this.element.style.animation="0.3s cubic-bezier(0.11, 0.05, 0.22, 0.81) open",this.mainElem=document.createElement("div"),this.mainElem.style.position="absolute",this.mainElem.style.display="flex",this.mainElem.style.justifyContent="center",this.mainElem.style.alignItems="center",this.mainElem.style.width="100%",this.mainElem.style.height="100%",this.mainElem.style.left="0",this.mainElem.style.top="0",r.element.appendChild(this.mainElem),this.background=document.createElement("div"),this.background.style.background="black",this.background.style.position="absolute",this.background.style.transition="opacity .5s",this.background.style.display="flex",this.background.style.justifyContent="center",this.background.style.alignItems="center",this.background.style.opacity="0",this.background.style.width="100%",this.background.style.height="100%",this.background.style.left="0",this.background.style.top="0",this.mainElem.appendChild(this.background);let E=document.createElement("div");E.style.background="#d03a41",E.style.width="100%",E.style.borderRadius="10px",this.element.appendChild(E);let m=document.createElement("div");m.style.width="100%",m.style.height="35px",m.style.display="flex",m.style.justifyContent="center",m.style.alignItems="center",m.textContent=t.title??"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F",E.appendChild(m);let u=document.createElement("div");u.style.width="100%",u.style.height="100%",u.style.display="flex",u.style.justifyContent="center",E.appendChild(u),this.content=document.createElement("div"),this.content.style.background="#B4AEAC",this.content.style.margin="0 5px 5px 5px",this.content.style.width="100%",this.content.style.height=c-40+"px",this.content.style.borderRadius="10px",u.appendChild(this.content),this.mainElem.appendChild(this.element),t.canCloseAnywhere&&this.background.addEventListener("click",f=>{n.close()}),$(50).then(()=>{this.background.style.opacity=".6"}),this.loop=r.on("tick",f=>this.emit("tick",f))}mainElem;content;background;loop;id=-1;async close(){(await this.call("close",{isCancelled:!1})).isCancelled||(this.background.style.opacity="0",this.element.style.opacity="0",this.element.style.animation="0.2s cubic-bezier(0.11, 0.05, 0.22, 0.81) close",$(300).then(()=>this.destroy()))}destroy(){this.emit("destroy"),r.boxs.splice(this.id,1),r.boxs.length==0&&(r.screen.element.style.pointerEvents="all"),this.element.remove(),this.background.remove(),this.mainElem.remove()}};async function M(d,e={}){let t=new V({title:e.title,height:e.height}),i=document.createElement("div");i.innerHTML=d.replaceAll(`
`,"<br/>"),i.style.color="black",i.style.textAlign="center",i.style.padding="15px 5px",t.content.appendChild(i);let n=document.createElement("div");n.style.width="100%",n.style.position="absolute",n.style.bottom="15px",n.style.display="flex",n.style.justifyContent="center",n.style.left="0",t.content.appendChild(n);let o=document.createElement("button");return o.textContent=e.btnText??"OK",o.style.width="80%",o.addEventListener("click",()=>t.close()),n.appendChild(o),await t.wait("destroy")}async function ve(d,e={}){let t=new V({title:e.title,height:e.height??175}),i=document.createElement("div");i.innerHTML=d.replaceAll(`
`,"<br/>"),i.style.color="black",i.style.textAlign="center",i.style.padding="15px 5px",t.content.appendChild(i);let n=document.createElement("div");n.style.width="100%",n.style.position="absolute",n.style.bottom="15px",n.style.display="flex",n.style.justifyContent="column",n.style.flexDirection="column",n.style.alignItems="center",n.style.left="0",t.content.appendChild(n);let o=document.createElement("input");o.style.width="80%",o.style.marginBottom="10px",o.placeholder=e.placeholder??"",n.appendChild(o);let c=document.createElement("button");return c.textContent=e.btnText??"OK",c.style.width="80%",c.addEventListener("click",()=>t.close()),n.appendChild(c),o.focus(),await t.wait("destroy"),o.value}function ne(d,e){if(document.selection){d.focus();let t=document.selection.createRange();t.text=e,d.focus()}else if(d.selectionStart||d.selectionStart===0){let t=d.selectionStart,i=d.selectionEnd,n=d.scrollTop;d.value=d.value.substring(0,t)+e+d.value.substring(i,d.value.length),d.focus(),d.selectionStart=t+e.length,d.selectionEnd=t+e.length,d.scrollTop=n}else d.value+=e,d.focus()}function de(d,e){let t=document.createElement(d);if(e.className&&(t.className=e.className),e.id&&(t.id=e.id),e.text&&(t.textContent=e.text),e.html&&(t.innerHTML=e.html),e.width&&(t.width=e.width),e.height&&(t.height=e.height),e.css)for(let i in e.css)t.style[i]=e.css[i];return t}var Je=mt(We());function te(d,e="azxsw",t=5){let i=d;for(let n=0;n<t;n++)i=(0,Je.default)(i+e);return i}function Et(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=crypto.getRandomValues(new Uint8Array(1))[0]%16;return(e==="x"?t:t&3|8).toString(16)})}var ye=class extends q{constructor(t=Et()){super();this.uuid=t;this.id=r.components.length,r.components.push(this),this.elem=document.createElement("div"),r.element.appendChild(this.elem),$(50).then(()=>{r.on("resize",i=>this.emit("resize",i)).key(`component_${t}`),r.on("keydown",i=>this.emit("keydown",i)).key(`component_${t}`),r.on("keyup",i=>this.emit("keyup",i)).key(`component_${t}`),r.on("click",i=>this.emit("click",i)).key(`component_${t}`),r.on("contextmenu",i=>this.emit("contextmenu",i)).key(`component_${t}`),r.server.on("message",i=>this.emit("message",i)).key(`component_${t}`)})}id;elem;destroy(){this.emit("destroy"),this.removeAllEvents(),r.removeByKey(`component_${this.uuid}`),r.server.removeByKey(`component_${this.uuid}`),r.components.splice(this.id,1),r.element.removeChild(this.elem),this.elem.remove()}};var ae=class extends ye{constructor(t=[],i){super();this.menu=t;this.event=i;i.preventDefault();let n=Q(),o=r.zoom,c=document.createElement("div");c.style.position="fixed",c.style.display="flex",c.style.flexDirection="column",c.style.left=i.pageX/o/n+"px",c.style.top=i.pageY/o/n+"px";for(let a=0;a<t.length;a++){let E=t[a],m=document.createElement("button");m.style.borderRadius=a==0?"7px 7px 0 0":a==t.length-1?"0 0 7px 7px":"0",m.textContent=E,m.onclick=()=>this.result=E,c.appendChild(m)}this.elem.appendChild(c),this.on("click",async()=>{await $(0),this.destroy()}),this.on("contextmenu",async()=>{await $(0),this.destroy()})}result;waitForResult(){return new Promise(async(t,i)=>{await this.wait("destroy"),t(this.result)})}};var he={user_62c9b5ac181e3eda808psq:"dev"};function _e(d){return[4,9,6,11].includes(d)}var se=class extends G{constructor(t,i={}){super("Room");this.roomObjectId=t;this.options=i;typeof i.sendRoomEnter!="boolean"&&(i.sendRoomEnter=!0),r.title="\u041A\u043E\u043C\u043D\u0430\u0442\u0430",this.oldAppSettingsData=JSON.parse(JSON.stringify(r.settings.data)),(async()=>this.element.style.background=`url(${await K("day3")}) 0% 0% / cover`)(),this.headerElem=document.createElement("div"),this.headerElem.className="header",this.element.appendChild(this.headerElem);let n=document.createElement("button");n.className="back",n.onclick=()=>this.emit("back");let o=document.createElement("img");o.width=24,B("ui/Jb.png").then(c=>o.src=c),n.appendChild(o),this.headerElem.appendChild(n),this.titleElem=document.createElement("label"),this.titleElem.textContent="",this.titleElem.style.width="300px",this.titleElem.style.userSelect="text",this.headerElem.appendChild(this.titleElem),this.loadingDivElem=document.createElement("div"),this.loadingDivElem.style.display="flex",this.loadingDivElem.style.justifyContent="center",this.loadingDivElem.style.margin="15px",this.element.appendChild(this.loadingDivElem),this.loadingElem=document.createElement("img"),this.loadingElem.style.textAlign="center",B("loading/2f.png").then(c=>this.loadingElem.src=c),this.loadingDivElem.appendChild(this.loadingElem),this.on("back",()=>{r.screen=new J}),this.init()}headerElem;loadingDivElem;loadingElem;rotation=0;titleElem;gameInfoElem;playersListElem;rangeZoomElem;gamePlayersListElem;resizablePLElem;messagesElem;infoElem;input;meElem;yourRoleElem;deadImgElem;myVoteElem;affectedByRolesElem;localFirstMessages=[];localAffectedByRoles=[];clearMessages=!0;isInitialized=!1;preInitCallback=()=>{};modelType=0;title="\u041A\u043E\u043C\u043D\u0430\u0442\u0430";maxPlayers=8;minPlayers=1;minLevel=1;isVipEnabled=!1;selectedRoles=[];status=0;get isGame(){return this.status==2}gameDayTime=0;timer=0;playersStat;oldAppSettingsData;usersWaiting=[];playersData={};players=[];joinLeaveMessages={};lastMessage;tick(t){t%2<1||(this.loadingElem&&(this.loadingElem.style.transform=`rotateZ(${this.rotation%360}deg)`),this.rotation+=30)}async reconnect(){super.reconnect();let t=this;this.options.sendRoomEnter&&r.server.send(s.ROOM_ENTER,{[s.ROOM_PASS]:this.options.password?te(this.options.password):"",[s.ROOM_OBJECT_ID]:this.roomObjectId});let i=await r.server.awaitPacket([s.ROOM_ENTER,s.ROOM_PASSWORD_IS_WRONG_ERROR,s.GAME_STARTED,s.USER_IN_ANOTHER_ROOM,s.USER_USING_DOUBLE_ACCOUNT,s.USER_LEVEL_NOT_ENOUGH,s.USER_KICKED,s.ROOM_CREATED],2e3);if(i[s.TYPE]==s.ROOM_PASSWORD_IS_WRONG_ERROR){r.screen=new J,M("\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043F\u0430\u0440\u043E\u043B\u044C!");return}else if(i[s.TYPE]==s.GAME_STARTED){r.screen=new J,M("\u0418\u0433\u0440\u0430 \u0443\u0436\u0435 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C");return}else if(i[s.TYPE]==s.USER_IN_ANOTHER_ROOM){r.screen=new J,M("\u041D\u0435\u043B\u044C\u0437\u044F \u0437\u0430\u0439\u0442\u0438");return}else if(i[s.TYPE]==s.USER_USING_DOUBLE_ACCOUNT){r.screen=new J,M(`\u0412 \u0434\u0430\u043D\u043D\u043E\u0439 \u043A\u043E\u043C\u043D\u0430\u0442\u0435 \u0443\u0436\u0435 \u0435\u0441\u0442\u044C \u0438\u0433\u0440\u043E\u043A, \u043A\u043E\u0442\u043E\u0440\u044B\u0439 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D \u043A \u0442\u043E\u043C\u0443 \u0436\u0435 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044E, \u0447\u0442\u043E \u0438 \u0432\u044B

\u0412\u0435\u0440\u043E\u044F\u0442\u043D\u043E \u0432\u044B \u0438 \u044D\u0442\u043E\u0442 \u0438\u0433\u0440\u043E\u043A \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0435 \u043E\u0431\u0449\u0443\u044E \u0442\u043E\u0447\u043A\u0443 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0441\u0435\u0442\u0438 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442

\u0415\u0441\u043B\u0438 \u0432\u044B \u0445\u043E\u0442\u0438\u0442\u0435 \u0438\u0433\u0440\u0430\u0442\u044C \u0441 \u0434\u0430\u043D\u043D\u044B\u043C \u0438\u0433\u0440\u043E\u043A\u043E\u043C \u0432 \u043E\u0434\u043D\u043E\u0439 \u043A\u043E\u043C\u043D\u0430\u0442\u0435 - \u0441\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043A\u043E\u043C\u043D\u0430\u0442\u0443 \u0441 \u043F\u0430\u0440\u043E\u043B\u0435\u043C \u0438\u043B\u0438 \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044C, \u0447\u0442\u043E \u0432\u044B \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043A\u0430\u0436\u0434\u044B\u0439 \u043A \u0441\u0432\u043E\u0435\u0439 \u0442\u043E\u0447\u043A\u0435 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u0438\u043B\u0438 \u043C\u043E\u0431\u0438\u043B\u044C\u043D\u044B\u043C \u0434\u0430\u043D\u043D\u044B\u043C`,{height:360});return}else if(i[s.TYPE]==s.USER_LEVEL_NOT_ENOUGH){r.screen=new J,M("\u0412\u0430\u0448 \u0443\u0440\u043E\u0432\u0435\u043D\u044C \u043C\u0430\u043B\u0435\u043D\u044C\u043A\u0438\u0439");return}else if(i[s.TYPE]==s.USER_KICKED){r.screen=new J,M("\u0412\u0430\u0441 \u0432\u044B\u0433\u043D\u0430\u043B\u0438");return}let n=i[s.ROOM];this.roomObjectId=n[s.OBJECT_ID],this.modelType=n[s.ROOM_MODEL_TYPE],this.title=n[s.TITLE],this.maxPlayers=n[s.MAX_PLAYERS],this.minPlayers=n[s.MIN_PLAYERS],this.minLevel=n[s.MIN_LEVEL],this.isVipEnabled=n[s.VIP_ENABLED],this.selectedRoles=n[s.SELECTED_ROLES],this.status=n[s.STATUS],this.gameDayTime=n[s.DAYTIME],r.server.send(s.CREATE_PLAYER,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token,[s.ROOM_OBJECT_ID]:this.roomObjectId,[s.ROOM_MODEL_TYPE]:0});let o=await r.server.awaitPacket(s.ROOM_STATISTICS);function c(){let a=o[s.ROOM_STATISTICS];if(t.messagesElem){t.messagesElem.innerHTML="";for(let E of a[s.MESSAGES])$(50).then(()=>t.addMessage(E,!1))}else t.localFirstMessages=a[s.MESSAGES];if(t.players=a[s.PLAYERS],t.titleElem.textContent=`${t.title} (${t.players.length}/${t.maxPlayers})`,a[s.GAME_STATUS]){if(t.infoElem.innerHTML="\u0417\u0430\u043F\u0443\u0441\u043A \u0438\u0433\u0440\u044B..",t.status=a[s.GAME_STATUS][s.STATUS],t.gameDayTime=a[s.GAME_STATUS][s.DAYTIME],t.timer=a[s.GAME_STATUS][s.TIMER],a[s.PLAYERS_DATA]){let E=0;for(let m of a[s.PLAYERS_DATA])t.playersData[m[s.USER_OBJECT_ID]]={index:E,alive:m[s.ALIVE]??!0,affectedByRoles:m[s.AFFECTED_BY_ROLES]??[],isDayActionUsed:m[s.IS_DAY_ACTION_USED],isNightActionAlternative:m[s.IS_NIGHT_ACTION_ALTERNATIVE],isNightActionUsed:m[s.IS_NIGHT_ACTION_USED],userObjectId:m[s.USER_OBJECT_ID],role:m[s.ROLE],vote:m[s.VOTE]??0},E++}if(a[s.PLAYERS])for(let E of a[s.PLAYERS]){let m=E[s.USER],u=m[s.OBJECT_ID],f=m[s.USERNAME];t.playersData[u]||(t.playersData[u]={}),t.playersData[u].username=f}}else t.infoElem.innerHTML="\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F",t.updatePlayersWaiting(a[s.PLAYERS])}this.isInitialized?c():this.preInitCallback=c}async init(){let t=await this.reconnect();this.loadingDivElem.remove(),this.on("message",a=>{if(a[s.TYPE]==s.MESSAGE)this.addMessage(a[s.MESSAGE]);else if(a[s.TYPE]==s.USERS&&!this.isGame)this.updatePlayersWaiting(a[s.USERS]);else if(a[s.TYPE]==s.ADD_PLAYER&&!this.isGame)this.players.push(a[s.PLAYER]),this.updatePlayersWaiting(this.players);else if(a[s.TYPE]==s.REMOVE_PLAYER&&!this.isGame)this.players.splice(this.players.findIndex(E=>E[s.USER][s.USER_OBJECT_ID]==a[s.USER_OBJECT_ID]),1),this.updatePlayersWaiting(this.players);else if(typeof a[s.TIMER]=="number"&&typeof a[s.TYPE]>"u"&&!this.isGame)this.infoElem.textContent=P(`\u0418\u0433\u0440\u0430 \u043D\u0430\u0447\u043D\u0451\u0442\u0441\u044F \u0447\u0435\u0440\u0435\u0437 ${a[s.TIMER]}`);else if(a[s.TYPE]==s.PLAYERS_STAT)this.playersStat=a;else if(a[s.TYPE]==s.ROOM_STATISTICS){if(a[s.ROOM_STATISTICS][s.PLAYERS]){let E=0;for(let m of a[s.ROOM_STATISTICS][s.PLAYERS]){let u=m[s.USER],f=u[s.OBJECT_ID],y=u[s.USERNAME];this.playersData[f]||(this.playersData[f]={}),this.playersData[f].index=E,this.playersData[f].username=y,E++}}if(a[s.ROOM_STATISTICS][s.PLAYERS_DATA]){for(let E of a[s.ROOM_STATISTICS][s.PLAYERS_DATA]){let m=E[s.USER_OBJECT_ID];this.playersData[m]||(this.playersData[m]={}),this.playersData[m].affectedByRoles=E[s.AFFECTED_BY_ROLES],typeof E[s.ALIVE]=="boolean"&&(this.playersData[m].alive=E[s.ALIVE]),this.playersData[m].isDayActionUsed=E[s.IS_DAY_ACTION_USED],this.playersData[m].isNightActionAlternative=E[s.IS_NIGHT_ACTION_ALTERNATIVE],this.playersData[m].isNightActionUsed=E[s.IS_NIGHT_ACTION_USED],typeof E[s.ROLE]=="number"&&(this.playersData[m].role=E[s.ROLE]),typeof E[s.VOTE]=="number"&&(this.playersData[m].vote=E[s.VOTE]),this.playersData[m].userObjectId=m}this.updatePlayersGame()}if(a[s.ROOM_STATISTICS][s.GAME_STATUS]&&(this.status=a[s.ROOM_STATISTICS][s.GAME_STATUS][s.STATUS],this.timer=a[s.ROOM_STATISTICS][s.GAME_STATUS][s.TIMER]),this.isGame){this.clearMessages&&(this.lastMessage={},this.messagesElem.innerHTML="");for(let E of a[s.ROOM_STATISTICS][s.MESSAGES])this.addMessage(E,!1);this.initGame(),this.status==3&&this.updatePlayersGame()}}else if(a[s.TYPE]==s.ROLES){for(let E of a[s.ROLES]){let m=E[s.USER_OBJECT_ID],u=E[s.ROLE];this.playersData[m]?this.playersData[m].role=u:this.playersData[m]={role:u}}this.updatePlayersGame()}});let i=document.createElement("div");i.style.display="flex",i.style.width="100%",i.style.marginRight="10px",i.style.flexDirection="row-reverse",i.style.alignItems="center";for(let a of this.selectedRoles){let E=document.createElement("img");E.src=await z(a),E.width=25,E.height=35,E.onmousedown=m=>m.preventDefault(),i.appendChild(E)}this.headerElem.appendChild(i),r.title=`\u041A\u043E\u043C\u043D\u0430\u0442\u0430: ${this.title}`,this.titleElem.innerHTML=P(this.title),this.infoElem=document.createElement("div"),this.infoElem.className="black",this.infoElem.style.textAlign="center",this.infoElem.style.margin="5px 0",this.infoElem.innerHTML="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043A\u043E\u043C\u043D\u0430\u0442\u044B..",this.element.appendChild(this.infoElem),this.playersListElem=document.createElement("div"),this.playersListElem.style.overflow="overlay",this.playersListElem.style.margin="5px 1px",this.playersListElem.style.outline="2px solid #c0c0c0",this.playersListElem.style.borderRadius="3px",this.playersListElem.style.background="rgba(255,255,255,.5)",this.element.appendChild(this.playersListElem);let n=document.createElement("div");n.style.width="100%";let o=!1;this.rangeZoomElem=document.createElement("input"),this.rangeZoomElem.style.display="none",this.rangeZoomElem.style.width="100%",this.rangeZoomElem.type="range",this.rangeZoomElem.min="25",this.rangeZoomElem.max="50",this.rangeZoomElem.value=this.oldAppSettingsData.game.zoomPL*25+"",this.rangeZoomElem.onmousedown=()=>o=!0,this.rangeZoomElem.onmouseup=()=>o=!1,this.rangeZoomElem.onmousemove=()=>{if(!o)return;let a=parseInt(this.rangeZoomElem.value)/25;r.settings.data.game.zoomPL=a,this.gamePlayersListElem.style.zoom=a+""},n.appendChild(this.rangeZoomElem),this.playersListElem.appendChild(n),this.gamePlayersListElem=document.createElement("div"),this.gamePlayersListElem.style.height="155px",this.gamePlayersListElem.style.display="flex",this.gamePlayersListElem.style.flexWrap="wrap",this.gamePlayersListElem.style.flexDirection="column",this.gamePlayersListElem.style.zoom="1",this.playersListElem.appendChild(this.gamePlayersListElem),this.resizablePLElem=document.createElement("div"),this.resizablePLElem.style.margin="2px",this.resizablePLElem.style.cursor="e-resize",this.resizablePLElem.style.float="right",this.resizablePLElem.style.width="5px",this.resizablePLElem.style.display="none",this.resizablePLElem.onmousedown=a=>{let E=this.playersListElem,m=Q(),u=a.clientX/m,f=E.clientWidth,y=5;function _(b){let S=b.clientX/m,R=f;R=Math.max(y,f-(S-u)),b.stopPropagation?.(),b.preventDefault?.(),E.style.width=R+"px"}function I(b){r.settings.data.game.widthPL=parseInt(E.style.width.replace("px","")),document.removeEventListener("mousemove",_,!0),document.removeEventListener("mouseup",I,!0),b.stopPropagation?.()}document.addEventListener("mousemove",_,!0),document.addEventListener("mouseup",I,!0),a.stopPropagation?.(),a.preventDefault?.()},this.element.appendChild(this.resizablePLElem),this.gameInfoElem=document.createElement("div"),this.gameInfoElem.style.height="125px",this.gameInfoElem.style.margin="5px 10px",this.gameInfoElem.style.outline="2px solid #c0c0c0",this.gameInfoElem.style.borderRadius="3px",this.gameInfoElem.style.background="rgba(255,255,255,.5)",this.gameInfoElem.style.display="none",this.element.appendChild(this.gameInfoElem),this.messagesElem=document.createElement("div"),this.messagesElem.style.height=r.height-(N()?285:265)+"px",this.messagesElem.style.textAlign="center",this.messagesElem.style.overflowX="hidden",this.messagesElem.style.overflowY="overlay",this.messagesElem.style.margin="10px 10px 5px 10px",this.messagesElem.style.outline="2px solid #c0c0c0",this.messagesElem.style.borderRadius="3px",this.messagesElem.style.background="rgba(255,255,255,.5)",this.messagesElem.style.display="flex",this.messagesElem.style.flexDirection="column",this.messagesElem.style.justifyContent="flex-start",this.element.appendChild(this.messagesElem);for(let a of this.localFirstMessages)$(50).then(()=>this.addMessage(a,!1));let c=document.createElement("div");c.style.width="100%",this.element.appendChild(c),this.input=document.createElement("input"),this.input.className="input-chat",this.input.type="text",this.input.placeholder="\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435",this.input.addEventListener("keydown",a=>{if(a.key=="Enter"&&this.input.value!=""){let E=this.input.value;this.input.value="",this.sendMessage(E)}}),N()&&(this.input.addEventListener("focus",()=>{r.width=innerWidth,r.height=innerHeight-1}),this.input.addEventListener("blur",()=>{r.width=innerWidth,r.height=innerHeight-2})),this.on("keydown",a=>a.key=="Enter"&&this.input.focus()),c.appendChild(this.input),this.on("resize",()=>{this.messagesElem.style.height=r.height-(N()?285:265)+"px"}).key("waiting"),this.isInitialized=!0,this.preInitCallback(),this.isGame&&this.initGame(),this.messagesElem.scrollTop=this.messagesElem.scrollHeight}async initGame(){this.element.removeChild(this.infoElem),this.removeByKey("waiting"),this.playersListElem.style.float="right",this.playersListElem.style.flexFlow="column wrap",this.playersListElem.style.overflowX="hidden",this.playersListElem.style.overflowY="overlay",this.playersListElem.style.width=(N()?115:this.oldAppSettingsData.game.widthPL)+"px",this.playersListElem.style.height=r.height-(N()?100:80)+"px",this.gamePlayersListElem.style.flexDirection="row",this.gamePlayersListElem.style.alignContent="flex-start",this.gamePlayersListElem.style.justifyContent="center",this.gamePlayersListElem.style.zoom=this.oldAppSettingsData.game.zoomPL+"",this.gamePlayersListElem.innerHTML="",N()||(this.rangeZoomElem.style.display="block"),this.resizablePLElem.style.display="block",this.resizablePLElem.style.height=r.height-(N()?100:80)+"px",this.messagesElem.style.height=r.height-(N()?235:215)+"px",this.changeDayTime(),this.on("resize",()=>{this.playersListElem.style.height=r.height-(N()?100:80)+"px",this.resizablePLElem.style.height=r.height-(N()?100:80)+"px",this.messagesElem.style.height=r.height-(N()?235:215)+"px"});let t=`\u0412\u044B<br/>${Ve[this.playersData[r.user.objectId].role??0]}`,i,n,o,c;{this.gameInfoElem.style.display="flex";{let a=document.createElement("span"),E=document.createElement("img");this.deadImgElem=de("img",{width:50,height:70,css:{display:"none",position:"absolute",top:"56px"}}),B("roles/dead.png").then(m=>this.deadImgElem.src=m),this.deadImgElem.onmousedown=m=>m.preventDefault(),this.myVoteElem=de("div",{css:{background:"red",color:"white",padding:"3px",position:"absolute",right:"5px",bottom:"20px",borderRadius:"3px",display:"none"}}),this.affectedByRolesElem=de("div",{css:{width:"125px",height:"100%",marginLeft:"5px",display:"flex",alignItems:"center",justifyContent:"flex-start",flexWrap:"wrap",alignContent:"center"}}),this.meElem=de("div",{css:{position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"0 5px"}}),this.yourRoleElem=de("span",{html:t,className:"black",css:{fontSize:"smaller",textAlign:"center",padding:"1px"}}),a.textContent=P(r.user.username),a.className="black",a.style.fontSize="smaller",a.style.textAlign="center",a.style.padding="1px",E.src=await z(this.playersData[r.user.objectId].role??1),E.width=50,E.height=70,E.onmousedown=m=>m.preventDefault(),this.meElem.appendChild(this.yourRoleElem),this.meElem.appendChild(E),this.meElem.appendChild(this.deadImgElem),this.meElem.appendChild(this.myVoteElem),this.meElem.appendChild(a),this.gameInfoElem.appendChild(this.meElem),this.gameInfoElem.appendChild(this.affectedByRolesElem)}{let a=this.playersStat??{},E=document.createElement("div");E.style.display="flex",E.style.alignItems="flex-end",E.style.flexDirection="column",E.style.padding="8px",E.style.width="100%",n=document.createElement("div"),n.textContent=P(`\u041C\u0430\u0444\u0438\u044F: ${a[s.MAFIA_ALL]} | ${a[s.MAFIA_ALIVE]}`),n.style.color="#940000",o=document.createElement("div"),o.textContent=P(`\u041C\u0438\u0440\u043D\u044B\u0435: ${a[s.CIVILIAN_ALL]} | ${a[s.CIVILIAN_ALIVE]}`),o.style.color="#186400",i=document.createElement("div"),i.textContent=P(this.timer+""),i.className="black",i.style.float="right",i.style.fontSize="35px",i.style.fontWeight="bold",i.style.marginTop="15px",i.style.padding="5px",c=document.createElement("button"),c.textContent="\u0421\u0434\u0430\u0442\u044C\u0441\u044F",c.style.marginTop="-5px",c.style.display="none";{let m=this.playersData[r.user.objectId].role??1;this.players.length>7&&this.playersData[r.user.objectId].alive&&(a[s.MAFIA_ALIVE]==1&&_e(m)||a[s.CIVILIAN_ALIVE]==1&&!_e(m))&&(i.style.marginTop="0",c.style.display="block")}c.onclick=()=>r.server.send(s.GIVE_UP,{[s.ROOM_OBJECT_ID]:this.roomObjectId}),E.appendChild(n),E.appendChild(o),E.appendChild(i),E.appendChild(c),this.gameInfoElem.appendChild(E)}}this.playersData[r.user.objectId].alive||(this.deadImgElem.style.top=this.yourRoleElem.clientHeight+1+"px",this.deadImgElem.style.display="flex"),this.on("message",a=>{if(this.isGame){if(a[s.TYPE]==s.GAME_DAYTIME)this.gameDayTime=a[s.DAYTIME],i.textContent=P(a[s.TIMER]),this.changeDayTime(),this.updatePlayersGame();else if(typeof a[s.TIMER]=="number")this.timer=a[s.TIMER],i.textContent=P(a[s.TIMER]);else if(a[s.TYPE]==s.PLAYERS_STAT)n.textContent=P(`\u041C\u0430\u0444\u0438\u044F: ${a[s.MAFIA_ALL]} | ${a[s.MAFIA_ALIVE]}`),o.textContent=P(`\u041C\u0438\u0440\u043D\u044B\u0435: ${a[s.CIVILIAN_ALL]} | ${a[s.CIVILIAN_ALIVE]}`),$(500).then(()=>{let E=this.playersData[r.user.objectId].role??1;this.players.length>7&&this.playersData[r.user.objectId].alive&&(a[s.MAFIA_ALIVE]==1&&_e(E)||a[s.CIVILIAN_ALIVE]==1&&!_e(E))&&(c.style.display="block",i.style.marginTop="0")});else if(a[s.TYPE]==s.USER_DATA){for(let E in a[s.PLAYERS_DATA]){let m=a[s.PLAYERS_DATA][E],u=m[s.USER_OBJECT_ID];m[s.AFFECTED_BY_ROLES]&&(this.playersData[u].affectedByRoles=m[s.AFFECTED_BY_ROLES]),typeof m[s.ALIVE]=="boolean"&&(this.playersData[u].alive=m[s.ALIVE]),typeof m[s.IS_DAY_ACTION_USED]=="boolean"&&(this.playersData[u].isDayActionUsed=m[s.IS_DAY_ACTION_USED]),typeof m[s.IS_NIGHT_ACTION_ALTERNATIVE]=="boolean"&&(this.playersData[u].isNightActionAlternative=m[s.IS_NIGHT_ACTION_ALTERNATIVE]),typeof m[s.IS_NIGHT_ACTION_USED]=="boolean"&&(this.playersData[u].isNightActionUsed=m[s.IS_NIGHT_ACTION_USED]),typeof m[s.ROLE]=="number"&&(this.playersData[u].role=m[s.ROLE]),typeof m[s.VOTE]=="number"&&(this.playersData[u].vote=m[s.VOTE]),a[s.PLAYERS_DATA].length==1&&u!=r.user.objectId&&typeof m[s.VOTE]!="number"&&(this.playersData[u].vote=(this.playersData[u].vote??0)+1)}this.updatePlayersGame()}}}),this.updatePlayersGame()}async changeDayTime(){this.gameDayTime<2?(this.element.style.background=`url(${await K("night")}) 0% 0% / cover`,this.playersListElem.style.outline="2px solid rgb(128 128 128)",this.playersListElem.style.background="rgb(255 255 255 / 50%)",this.gameInfoElem.style.outline="2px solid rgb(128 128 128)",this.gameInfoElem.style.background="rgb(255 255 255 / 50%)",this.messagesElem.style.outline="2px solid rgb(128 128 128)",this.messagesElem.style.background="rgb(255 255 255 / 50%)"):(this.element.style.background=`url(${await K("day3")}) 0% 0% / cover`,this.playersListElem.style.outline="2px solid #c0c0c0",this.playersListElem.style.background="rgba(255,255,255,.5)",this.gameInfoElem.style.outline="2px solid #c0c0c0",this.gameInfoElem.style.background="rgba(255,255,255,.5)",this.messagesElem.style.outline="2px solid #c0c0c0",this.messagesElem.style.background="rgba(255,255,255,.5)");for(let t in this.playersData)this.playersData[t].didAutoClick=!1}updatePlayersGame(){let t=this,i=Object.entries(this.playersData).sort(([,n],[,o])=>(n.index??0)-(o.index??0));this.gamePlayersListElem.innerHTML="";for(let[n,o]of i){if(r.user.objectId==o.userObjectId){if(this.deadImgElem&&this.deadImgElem.style.display=="none"&&this.yourRoleElem&&o.alive==!1&&(this.deadImgElem.style.top=this.yourRoleElem.clientHeight+1+"px",this.deadImgElem.style.display="flex",r.settings.data.game.showYouDiedMessage&&M("\u0412\u044B \u0443\u043C\u0435\u0440\u043B\u0438")),this.myVoteElem&&(typeof this.playersData[n].vote=="number"&&this.playersData[n].vote>0?(this.myVoteElem.style.display="block",this.myVoteElem.textContent=P(this.playersData[n].vote+"")):this.myVoteElem.style.display="none"),this.affectedByRolesElem){let _=this.playersData[n].affectedByRoles??[];if(!(this.localAffectedByRoles.length==_.length&&this.localAffectedByRoles.every((b,S)=>b==_[S]))){this.localAffectedByRoles=_,this.affectedByRolesElem.innerHTML="";for(let b of _){let S=document.createElement("img");z(b).then(R=>S.src=R),S.width=28,S.height=40,S.style.opacity="0",S.style.animation="1s opacity linear alternate infinite",S.style.margin="1px",S.onmousedown=R=>R.preventDefault(),this.affectedByRolesElem.appendChild(S)}}}continue}async function c(_){let b=await new ae(t.playersData[n].alive?["\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C",`${t.playersData[n].autoClick?"\u2705 ":""}\u0410\u0432\u0442\u043E-\u043A\u043B\u0438\u043A`]:["\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C"],_).waitForResult();b==`${t.playersData[n].autoClick?"\u2705 ":""}\u0410\u0432\u0442\u043E-\u043A\u043B\u0438\u043A`?(t.playersData[n].autoClick=!t.playersData[n].autoClick,t.playersData[n].didAutoClick=!1):b=="\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C"&&j(n)}let a=this.playersData[n].username??"?",E=document.createElement("div");E.style.margin="2px",E.style.width="50px",E.style.textAlign="center",E.style.position="relative",E.style.height="100px";let m=document.createElement("div");m.textContent=P(a),m.className="black",m.style.wordBreak="break-all",m.style.textAlign="center",m.style.fontSize="12px",m.style.marginTop="-2px";let u=document.createElement("img");if(z(o.role??0).then(_=>u.src=_),u.width=50,u.height=70,u.oncontextmenu=c,u.onmousedown=_=>_.preventDefault(),E.appendChild(u),!o.alive){let _=document.createElement("img");B("roles/dead.png").then(I=>_.src=I),_.width=50,_.height=70,_.style.position="absolute",_.style.left="0",_.onmousedown=I=>I.preventDefault(),_.onclick=()=>this.addNickToInput(a),_.oncontextmenu=c,E.appendChild(_)}if(typeof this.playersData[n].vote=="number"&&this.playersData[n].vote>0){let _=this.playersData[n].vote,I=document.createElement("div");I.style.background="red",I.style.color="white",I.style.padding="3px",I.style.position="absolute",I.style.right="0",I.style.bottom="30px",I.style.borderRadius="3px",I.textContent=P(_+""),E.appendChild(I)}let f="",y=this.gameDayTime<2?this.playersData[r.user.objectId].isNightActionUsed:this.playersData[r.user.objectId].isDayActionUsed;if(me(this.playersData[r.user.objectId].role).case(2,()=>this.gameDayTime==1&&void(f="_2")).case(3,()=>this.gameDayTime==1&&void(f="check",this.playersData[n].affectedByRoles?.includes(3)&&(f=""))).case(4,()=>this.gameDayTime==1&&void(f="kill",_e(this.playersData[n].role??1)&&(f=""))).case(5,()=>this.gameDayTime==0&&void(f="_5")).case(6,()=>this.gameDayTime==3&&void(f="_6")).case(7,()=>this.gameDayTime==1&&void(this.playersData[n].affectedByRoles?.includes(7)||(f="_7"))).case(8,()=>this.gameDayTime==2&&void(f="_8",this.playersData[r.user.objectId].isNightActionUsed&&(f=""))).case(9,()=>this.gameDayTime==1&&void(f="_9")).case(11,()=>this.gameDayTime==1&&void(f="check",this.playersData[n].affectedByRoles?.includes(11)&&(f=""))),f==""&&this.gameDayTime==3&&(f="kill"),this.gameDayTime==1&&this.playersData[r.user.objectId].affectedByRoles?.includes(9)&&!this.playersData[r.user.objectId].isNightActionUsed&&(y=!1),f!=""&&this.status!=3&&!y&&this.playersData[r.user.objectId].alive&&this.playersData[n].alive){let _=document.createElement("img");B(`roles/${f}.png`).then(I=>_.src=I),_.width=50,_.height=70,_.style.position="absolute",_.style.left="0",_.style.transform="scale(0)",_.style.animation=".7s zoom-in-zoom-out alternate infinite",_.style.animationDelay=".3s",_.onmousedown=I=>I.preventDefault(),_.oncontextmenu=c,_.onclick=u.onclick=()=>{r.server.send(s.ROLE_ACTION,{[s.USER_OBJECT_ID]:n,[s.ROOM_OBJECT_ID]:this.roomObjectId,[s.ROOM_MODEL_TYPE]:this.modelType}),this.updatePlayersGame()},E.appendChild(_),this.playersData[n].autoClick&&!this.playersData[n].didAutoClick&&(this.playersData[n].didAutoClick=!0,_.click())}else u.onclick=()=>this.addNickToInput(a);E.appendChild(m),this.gamePlayersListElem.appendChild(E)}}addMessage(t,i=!1){let n=t[s.TEXT],o=t[s.MESSAGE_TYPE],c=t[s.MESSAGE_STICKER],a=t[s.USER],E=a?a[s.OBJECT_ID]:"";if(a||o==10||o==25||o==26){let m=a?a[s.USERNAME]:o==25||o==26?"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0442\u043E\u0440":o==10?"\u041C\u0430\u0444\u0438\u044F":"???",u=n,f="black";if(o==9||o==13||o==26?(u=`\u0413\u043E\u043B\u043E\u0441\u0443\u0435\u0442 \u0437\u0430 [${n}]`,f="#186400"):o==11?f="#545454":o==17?f="#113B81":o==18?(u=`\u0412\u0417\u041E\u0420\u0412\u0410\u041B \u0438\u0433\u0440\u043E\u043A\u0430 [${n}]`,f="#940000"):o==21?(u=`\u0412\u0417\u041E\u0420\u0412\u0410\u041B \u0438\u0433\u0440\u043E\u043A\u0430 [${n}], \u043D\u043E \u0438\u0433\u0440\u043E\u043A \u0431\u044B\u043B \u043F\u043E\u0434 \u0437\u0430\u0449\u0438\u0442\u043E\u0439 \u0442\u0435\u043B\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435\u043B\u044F \u0438 \u043E\u0441\u0442\u0430\u043B\u0441\u044F \u0436\u0438\u0432!`,f="#940000"):o==27&&(u="\u0421\u0434\u0430\u043B\u0441\u044F",f="#940000"),this.lastMessage&&this.lastMessage.divM&&this.lastMessage.username==m){let y=document.createElement("span");he[E]=="dev"?y.innerHTML=u:y.innerHTML=P(u),y.style.color=f,y.style.userSelect="text",this.lastMessage.divM.appendChild(y)}else{let y=document.createElement("div");y.style.display="flex",y.style.textAlign="left";let _=document.createElement("img");Z(a).then(R=>_.src=R),_.style.borderRadius="100%",_.width=35,_.height=35,_.style.margin="5px",_.onmousedown=R=>R.preventDefault(),_.onclick=()=>j(E);let I=document.createElement("div");I.style.display="flex",I.style.flexDirection="column",I.style.justifyContent="center",I.style.wordBreak="auto-phrase";let b=document.createElement("span");b.textContent=P(m),b.style.color=o==17?"#4B4483":o==11?"#545454":"black",b.onclick=()=>this.addNickToInput(m);let S=document.createElement("span");he[E]=="dev"?S.innerHTML=u:S.innerHTML=P(u),S.style.color=f,S.style.userSelect="text",y.appendChild(_),y.appendChild(I),I.appendChild(b),I.appendChild(S),this.messagesElem.appendChild(y),this.lastMessage={username:m,divM:I}}}else{let m=document.createElement("div"),u=n,f="black",y=!1;if(o==2?(u=`\u0418\u0433\u0440\u043E\u043A ${n} \u0432\u043E\u0448\u0451\u043B`,f="#186400"):o==3?(u=`\u0418\u0433\u0440\u043E\u043A ${n} \u0432\u044B\u0448\u0435\u043B`,f="#940000"):o==4?u="\u0418\u0433\u0440\u0430 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C":o==5?(u="\u041D\u0430\u0441\u0442\u0443\u043F\u0438\u043B\u0430 \u043D\u043E\u0447\u044C [\u041C\u0410\u0424\u0418\u042F \u0432 \u0447\u0430\u0442\u0435]",f="#113B81"):o==6?(u="[\u041C\u0410\u0424\u0418\u042F \u0432\u044B\u0431\u0438\u0440\u0430\u0435\u0442 \u0436\u0435\u0440\u0442\u0432\u0443]",f="#113B81"):o==7?(u="\u041D\u0430\u0441\u0442\u0443\u043F\u0438\u043B \u0434\u0435\u043D\u044C [\u0412\u0441\u0435 \u043E\u0431\u0449\u0430\u044E\u0442\u0441\u044F \u0432 \u0447\u0430\u0442\u0435]",f="#C46509"):o==8?(u="[\u0412\u0441\u0435 \u0433\u043E\u043B\u043E\u0441\u0443\u044E\u0442] \u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0433\u0440\u043E\u043A\u0430, \u043A\u043E\u0442\u043E\u0440\u043E\u0433\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u043A\u0430\u0437\u043D\u0438\u0442\u044C",f="#C46509"):o==12?(u=`\u0418\u0433\u0440\u043E\u043A [${n}] \u0423\u0411\u0418\u0422!`,f="#940000"):o==14?(u="\u0412\u0421\u0415 \u043E\u0441\u0442\u0430\u043B\u0438\u0441\u044C \u0436\u0438\u0432\u044B. \u041D\u0438\u043A\u043E\u0433\u043E \u043D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0431\u0438\u0442\u044C!",f="#186400"):o==15?(u="\u0418\u0433\u0440\u0430 \u043E\u043A\u043E\u043D\u0447\u0435\u043D\u0430! \u041C\u0418\u0420\u041D\u042B\u0415 \u0416\u0418\u0422\u0415\u041B\u0418 \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0438!",f="#186400"):o==16?(u="\u0418\u0433\u0440\u0430 \u043E\u043A\u043E\u043D\u0447\u0435\u043D\u0430! \u041C\u0410\u0424\u0418\u042F \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0430!",f="#186400"):o==19?(u=`\u0421\u0420\u041E\u0427\u041D\u0410\u042F \u041D\u041E\u0412\u041E\u0421\u0422\u042C!
\u0416\u0443\u0440\u043D\u0430\u043B\u0438\u0441\u0442 \u043F\u0440\u043E\u0432\u0435\u043B \u0440\u0430\u0441\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u043D\u0438\u0435 \u0438 \u043A\u0430\u043A \u043E\u043A\u0430\u0437\u0430\u043B\u043E\u0441\u044C \u0438\u0433\u0440\u043E\u043A\u0438 [${n.split("#")[0]}] \u0438 [${n.split("#")[2]}] \u0438\u0433\u0440\u0430\u044E\u0442 \u0432 \u043E\u0434\u043D\u043E\u0439 \u043A\u043E\u043C\u0430\u043D\u0434\u0435`,f="#940000"):o==20?(u=`\u0421\u0420\u041E\u0427\u041D\u0410\u042F \u041D\u041E\u0412\u041E\u0421\u0422\u042C!
\u0416\u0443\u0440\u043D\u0430\u043B\u0438\u0441\u0442 \u043F\u0440\u043E\u0432\u0435\u043B \u0440\u0430\u0441\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u043D\u0438\u0435 \u0438 \u043A\u0430\u043A \u043E\u043A\u0430\u0437\u0430\u043B\u043E\u0441\u044C \u0438\u0433\u0440\u043E\u043A\u0438 [${n.split("#")[0]}] \u0438 [${n.split("#")[2]}] \u0438\u0433\u0440\u0430\u044E\u0442 \u0432 \u0440\u0430\u0437\u043D\u044B\u0445 \u043A\u043E\u043C\u0430\u043D\u0434\u0430\u0445`,f="#940000"):o==22?u="\u043D\u0438\u0447\u044C\u044F":o==23?(u=`[${n.split("#")[0]}] \u043D\u0430\u0447\u0430\u043B \u0433\u043E\u043B\u043E\u0441\u043E\u0432\u0430\u043D\u0438\u0435, \u0447\u0442\u043E\u0431\u044B \u0432\u044B\u0433\u043D\u0430\u0442\u044C \u0438\u0433\u0440\u043E\u043A\u0430 [${n.split("#")[2]}] \u0438\u0437 \u043A\u043E\u043C\u043D\u0430\u0442\u044B
`,y=!0,f="#113B81"):o==24&&(u=`\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u043B\u043E\u0441\u044C \u0433\u043E\u043B\u043E\u0441\u043E\u0432\u0430\u043D\u0438\u0435. \u0412\u044B\u0433\u043D\u0430\u0442\u044C \u0438\u0433\u0440\u043E\u043A\u0430?
\u0420\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442 \u0433\u043E\u043B\u043E\u0441\u043E\u0432\u0430\u043D\u0438\u044F:
\u0414\u0430: ${n.split("|")[0]} | \u041D\u0435\u0442: ${n.split("|")[1]}`,f="#113B81"),m.innerHTML=(y?u:P(u)).replaceAll(`
`,"<br/>"),m.style.color=f,m.style.userSelect="text",m.style.margin="3px",this.messagesElem.appendChild(m),this.lastMessage={},o==23){let _=document.createElement("p");_.style.margin="5px",_.textContent="10",m.appendChild(_);let I=document.createElement("button");I.textContent="\u0412\u044B\u0433\u043D\u0430\u0442\u044C",I.onclick=()=>{r.server.send(s.KICK_USER_VOTE,{[s.ROOM_OBJECT_ID]:this.roomObjectId,[s.VOTE]:!0}),I.disabled=!0,b.disabled=!0},m.appendChild(I);let b=document.createElement("button");b.textContent="\u041D\u0435 \u0432\u044B\u0433\u043E\u043D\u044F\u0442\u044C",b.onclick=()=>{r.server.send(s.KICK_USER_VOTE,{[s.ROOM_OBJECT_ID]:this.roomObjectId,[s.VOTE]:!0}),I.disabled=!0,b.disabled=!0},m.appendChild(b),this.on("message",S=>{if(S[s.TYPE]==s.KICK_TIMER){let R=S[s.TIMER];_.textContent=R,R<1&&this.removeByKey("kick")}}).key("kick")}(o==2||o==3)&&(this.joinLeaveMessages[n]&&this.joinLeaveMessages[n].remove(),this.joinLeaveMessages[n]=m)}this.messagesElem.scrollHeight-r.height-this.messagesElem.scrollTop<75&&this.messagesElem.scroll({top:this.messagesElem.scrollHeight,behavior:"smooth"}),i&&this.messagesElem.firstElementChild&&this.messagesElem.removeChild(this.messagesElem.firstElementChild)}addNickToInput(t){let i=document.activeElement==this.input;if(this.input.value.includes(`[${t}]`)){let n=this.input.value.indexOf(`[${t}]`);this.input.value.lastIndexOf(`[${t}]`)==0?this.input.value=this.input.value.replace(`[${t}] `,""):this.input.value.substring(0,n).endsWith(" ")?this.input.value=this.input.value.replace(` [${t}] `,""):this.input.value=this.input.value.replace(`[${t}]`,"")}else[""," "].includes(this.input.value.substring((this.input.selectionStart??1)-1))?ne(this.input,`[${t}] `):ne(this.input,` [${t}] `);N()&&this.input.focus()}sendMessage(t,i={}){if(t.startsWith(r.settings.data.game.barmanEffect)){let n="?!&@#%^~<>*";t=Array.from({length:[...t].length-1},()=>n[Math.random()*n.length|0]).join("")}r.server.send(s.ROOM_MESSAGE_CREATE,{[s.MESSAGE]:{[s.MESSAGE_STYLE]:i.messageStyle??0,[s.MESSAGE_STICKER]:i.messageSticker??!1,[s.TEXT]:t},[s.ROOM_OBJECT_ID]:this.roomObjectId,[s.ROOM_MODEL_TYPE]:this.modelType}),this.messagesElem.scroll({top:this.messagesElem.scrollHeight,behavior:"smooth"})}updatePlayersWaiting(t){this.usersWaiting=t.map(i=>i[s.USER][s.OBJECT_ID]),this.titleElem.textContent=`${this.title} (${t.length}/${this.maxPlayers})`,this.gamePlayersListElem.innerHTML="";for(let i=0;i<t.length;i++){let o=t[i][s.USER],c=document.createElement("div"),a=document.createElement("img"),E=document.createElement("span");Z(o).then(m=>a.src=m),a.style.borderRadius="100%",a.width=a.height=25,a.style.margin="5px",a.onmousedown=m=>m.preventDefault(),a.onclick=()=>j(o[s.OBJECT_ID]),E.textContent=P(o[s.USERNAME]),E.className="black",E.onclick=()=>this.addNickToInput(o[s.USERNAME]),c.style.display="flex",c.style.textAlign="left",c.style.alignItems="center",c.appendChild(a),c.appendChild(E),this.gamePlayersListElem.appendChild(c)}}destroy(){r.server.send(s.REMOVE_PLAYER,{[s.ROOM_OBJECT_ID]:this.roomObjectId}),super.destroy()}};function Xe(d={}){let e=new V({title:d.title??"\u0417\u0410\u0413\u0420\u0423\u0417\u041A\u0410",canCloseAnywhere:d.canCloseAnywhere||!1,height:175}),t=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.padding="15px 0 0 0",t.style.position="absolute",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.left="0",e.content.appendChild(t);let i=document.createElement("img");k.loadImageAsDataURL(`${r.config.path}/assets/textures/loading/Tx.png`).then(c=>i.src=c),t.appendChild(i);let n=document.createElement("p");n.style.color="black",n.textContent=d.text??"",t.appendChild(n);let o=0;return e.on("tick",c=>{c%2<1||(i.style.transform=`rotateZ(${o%360}deg)`,o+=30)}),{box:e,changeText(c){n.textContent=c},done(){e.close()}}}var Ie=class extends G{data;constructor(){super("RoomCreation"),r.title="\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u043A\u043E\u043C\u043D\u0430\u0442\u044B",(async()=>this.element.style.background=`url(${await K("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("button");t.className="back",t.onclick=()=>this.emit("back"),e.appendChild(t);let i=document.createElement("img");i.width=24,B("ui/Jb.png").then(o=>i.src=o),t.appendChild(i);let n=document.createElement("label");n.textContent="\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u043A\u043E\u043C\u043D\u0430\u0442\u044B",e.appendChild(n),this.on("back",()=>{r.screen=new J}),this.data=r.settings.data.roomCreate,this.init()}createRoom(e){r.server.send(s.ROOM_CREATE,{[s.TOKEN]:r.user.token,[s.USER_OBJECT_ID]:r.user.objectId,[s.ROOM]:{[s.TITLE]:e.title,[s.DAYTIME]:0,[s.MIN_PLAYERS]:e.minPlayers,[s.MAX_PLAYERS]:e.maxPlayers,[s.MIN_LEVEL]:e.minLevel,[s.SELECTED_ROLES]:e.selectedRoles,[s.PASSWORD]:e.password?te(e.password):"",[s.VIP_ENABLED]:e.vip}}),r.screen=new se("",{sendRoomEnter:!1})}init(){let e=this,t=document.createElement("div");t.style.display="flex",t.style.padding="10px",t.style.justifyContent="center",t.style.flexDirection="column",this.element.appendChild(t);function i(m,{fontSize:u=16,margin:f="10px"}={}){let y=document.createElement("p");y.style.textAlign="center",y.style.fontSize=u+"px",y.style.margin=f,y.innerHTML=m,t.appendChild(y)}function n(m,u,f){let y=document.createElement("div");y.style.display="flex",y.style.alignItems="center",y.style.padding="3px",t.appendChild(y);let _=document.createElement("img");_.width=25,f.then(S=>_.src=S),y.appendChild(_);let I=document.createElement("input");I.style.zoom="1.5",I.type="checkbox",I.checked=typeof u=="string"?!!e.data[u]:e.data.selectedRoles.includes(u),I.onchange=()=>{typeof u=="string"?e.data[u]=I.checked:e.data.selectedRoles=e.data.selectedRoles.includes(u)?e.data.selectedRoles.filter(S=>S!==u):[...e.data.selectedRoles,u],console.log(e.data)},y.appendChild(I);let b=document.createElement("span");b.textContent=m,y.appendChild(b)}function o(m){function u(R,A,O){let U=document.createElement("div");U.className="range-tooltip",R.appendChild(U);function H(){let w=Number(A.min),x=Number(A.max),F=Number(A.value),Y=R.clientWidth,l=(F-w)/(x-w)*Y/r.zoom/Q();U.style.left=l+"px",U.textContent=O()}A.addEventListener("pointerdown",()=>{H(),U.style.opacity="1"}),A.addEventListener("input",H);function v(){U.style.opacity="0"}A.addEventListener("pointerup",v),A.addEventListener("pointercancel",v),A.addEventListener("pointerleave",v)}if(m=="lvl"){let R=document.createElement("div");R.style.position="relative",t.appendChild(R);let A=document.createElement("input");A.style.width="100%",A.type="range",A.min="1",A.max="13",A.value=String(e.data.minLevel),R.appendChild(A),u(R,A,()=>`${A.value}`),A.oninput=()=>{e.data.minLevel=Number(A.value)};return}let f=document.createElement("div");f.className="range-wrapper",t.appendChild(f);let y=document.createElement("div");y.className="range-track",f.appendChild(y);let _=document.createElement("div");_.className="range-active",f.appendChild(_);let I=document.createElement("input"),b=document.createElement("input");u(f,I,()=>String(e.data.minPlayers)),u(f,b,()=>String(e.data.maxPlayers)),I.type=b.type="range",I.min=b.min="1",I.max=b.max="21",I.value=String(e.data.minPlayers),b.value=String(e.data.maxPlayers);function S(R){let A=Number(I.value),O=Number(b.value);A>O&&(R==I?O=A:A=O),I.value=String(A),b.value=String(O),e.data.minPlayers=A,e.data.maxPlayers=O;let U=f.clientWidth,H=(A-1)/20*U/r.zoom/Q(),v=(O-1)/20*U/r.zoom/Q();_.style.left=H+"px",_.style.width=v-H+"px"}I.oninput=()=>S(I),b.oninput=()=>S(b),f.appendChild(I),f.appendChild(b),S()}let c=document.createElement("input");c.placeholder="\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u043E\u043C\u043D\u0430\u0442\u044B",c.style.width="100%",c.value=r.settings.data.roomCreate.title,c.oninput=()=>this.data.title=c.value,t.appendChild(c),i("\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0438\u0433\u0440\u043E\u043A\u043E\u0432"),o("players"),i("\u0423\u0440\u043E\u0432\u0435\u043D\u044C \u043A\u043E\u043C\u043D\u0430\u0442\u044B"),o("lvl"),i("\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438"),n("VIP \u043A\u043E\u043C\u043D\u0430\u0442\u0430","vip",B("vip/_u.png")),i("\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0440\u043E\u043B\u0438",{margin:"10px 0 5px 0"}),i("\u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043C\u0430\u0444\u0438\u0438",{fontSize:13,margin:"5px"}),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0422\u0435\u0440\u0440\u043E\u0440\u0438\u0441\u0442",6,z(6)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0411\u0430\u0440\u043C\u0435\u043D",9,z(9)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0442\u043E\u0440",11,z(11)),i("\u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043C\u0438\u0440\u043D\u044B\u0445 \u0436\u0438\u0442\u0435\u043B\u0435\u0439",{fontSize:13,margin:"5px"}),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0414\u043E\u043A\u0442\u043E\u0440",2,z(2)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u041B\u044E\u0431\u043E\u0432\u043D\u0438\u0446\u0430",5,z(5)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0416\u0443\u0440\u043D\u0430\u043B\u0438\u0441\u0442",7,z(7)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0422\u0435\u043B\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435\u043B\u044C",8,z(8)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0428\u043F\u0438\u043E\u043D",10,z(10));let a=document.createElement("input");a.placeholder="\u041F\u0430\u0440\u043E\u043B\u044C (\u041E\u0441\u0442\u0430\u0432\u044C\u0442\u0435 \u043F\u0443\u0441\u0442\u044B\u043C \u0434\u043B\u044F \u0432\u044B\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F)",a.style.width="100%",a.value=r.settings.data.roomCreate.password,a.oninput=()=>this.data.password=a.value,t.appendChild(a);let E=document.createElement("button");E.textContent="\u0421\u043E\u0437\u0434\u0430\u0442\u044C",E.onclick=()=>this.createRoom(this.data),t.appendChild(E)}destroy(){super.destroy(),r.settings.data.roomCreate=this.data}};var J=class d extends G{div;titleElem;search="";constructor(){super("Rooms"),r.title="\u041A\u043E\u043C\u043D\u0430\u0442\u044B",this.element.style.overflow="hidden",(async()=>this.element.style.background=`url(${await K("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("button");t.className="back",t.onclick=()=>this.emit("back"),e.appendChild(t);let i=document.createElement("img");i.width=24,B("ui/Jb.png").then(n=>i.src=n),t.appendChild(i),this.titleElem=document.createElement("label"),this.titleElem.textContent="\u041A\u043E\u043C\u043D\u0430\u0442\u044B",e.appendChild(this.titleElem),this.on("back",()=>{r.screen=new W}),this.init()}async reconnect(){super.reconnect(),this.rooms=[],this.updateRooms(),r.server.send(s.ADD_CLIENT_TO_ROOMS_LIST,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token});let e=await r.server.awaitPacket(s.ROOMS),t=this.getRooms(e[s.ROOMS]);for(let i of t)this.addRoom(i)}async init(){r.server.send(s.ADD_CLIENT_TO_ROOMS_LIST,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token});let e=await r.server.awaitPacket(s.ROOMS),t=document.createElement("div");t.className="rooms-filter",this.element.appendChild(t);{let c=document.createElement("input");c.placeholder="\u041F\u043E\u0438\u0441\u043A",c.size=30,c.onchange=c.onkeyup=()=>{this.search=c.value,this.updateRooms()},t.appendChild(c);let a=document.createElement("button");a.textContent="\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C",a.onclick=async()=>{this.rooms=[],this.updateRooms(),r.server.send(s.ADD_CLIENT_TO_ROOMS_LIST,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token});let u=await r.server.awaitPacket(s.ROOMS),f=this.getRooms(u[s.ROOMS]);for(let y of f)this.addRoom(y)},t.appendChild(a);let E=document.createElement("button");E.textContent="\u0424\u0438\u043B\u044C\u0442\u0440",E.onclick=()=>{let u=new V({title:"\u0424\u0418\u041B\u042C\u0422\u0420",width:150,height:150,canCloseAnywhere:!0})},t.appendChild(E);let m=document.createElement("button");m.textContent="\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430",m.onclick=()=>{let u=new V({title:"\u0421\u041E\u0420\u0422\u0418\u0420\u041E\u0412\u041A\u0410",width:150,height:150,canCloseAnywhere:!0})},t.appendChild(m),this.on("keydown",u=>{u.ctrlKey&&u.key=="f"&&(c.focus(),u.preventDefault())})}this.div=document.createElement("div"),this.div.style.textAlign="center",this.div.style.overflowY="overlay",this.div.style.height=r.height-(95+t.clientHeight)+"px",this.element.appendChild(this.div);let i=this.getRooms(e[s.ROOMS]);for(let c of i)this.addRoom(c);let n=document.createElement("div");n.style.textAlign="center",n.style.margin="3px",this.element.appendChild(n);let o=document.createElement("button");o.textContent="\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043A\u043E\u043C\u043D\u0430\u0442\u0443",o.style.width="99%",o.onclick=()=>r.screen=new Ie,n.appendChild(o),this.on("message",c=>{c[s.TYPE]==s.ROOM_IN_LOBBY_STATE?(this.getRoomByObjectId(c[s.ROOM_IN_LOBBY_STATE][s.ROOM_OBJECT_ID])?.rils(c[s.ROOM_IN_LOBBY_STATE]),this.updateRooms()):c[s.TYPE]==s.GAME_STATUS_IN_ROOMS_LIST?(this.getRoomByObjectId(c[s.ROOM_OBJECT_ID]).room.status=c[s.STATUS],this.updateRooms()):c[s.TYPE]==s.ADD?(this.addRoom(c[s.ROOM]),this.updateRooms()):c[s.TYPE]==s.REMOVE&&(this.getRoomByObjectId(c[s.ROOM_OBJECT_ID])?.remove(),this.rooms.splice(this.getRoomIdByObjectId(c[s.ROOM_OBJECT_ID]),1),this.updateRooms())}),this.on("resize",c=>{this.div.style.height=r.height-(85+t.clientHeight+5)+"px"})}rooms=[];roomsId=0;getRoomByObjectId(e){return this.rooms.find(t=>t.room[s.OBJECT_ID]==e)}getRoomIdByObjectId(e){return this.rooms.findIndex(t=>t.room[s.OBJECT_ID]==e)}getRooms(e){let t=e.sort((n,o)=>{let c=n[s.ROOM_STATUS]-o[s.ROOM_STATUS];if(c!==0)return c;let a=n[s.STATUS]-o[s.STATUS];return a!==0?a:n[s.MIN_LEVEL]-o[s.MIN_LEVEL]}),i=`\u041A\u043E\u043C\u043D\u0430\u0442\u044B: (${e.length}/${t.length})`;return this.titleElem.textContent=P(i),r.title=i,t}updateRooms(){this.div.innerHTML="";let e=[];for(let i of this.rooms)e.push(i.room);let t=this.getRooms(e);this.rooms=[];for(let i of t)this.addRoom(Object.assign({},i))}filter(e){return e?this.search==""?!0:e[s.TITLE].toLowerCase().includes(this.search.toLowerCase()):!1}static orderRoles=[2,7,10,11,9,5,6,8];static getRoomElement(e){let t=typeof e[s.SAME_ROOM]=="boolean",i=e[s.OBJECT_ID],n=e[s.MIN_LEVEL],o=t?2:e[s.ROOM_STATUS],c=n==3?2:n==5?3:n==7?4:n==9?5:n==11?6:1,a=e[s.SELECTED_ROLES]??[],E=e[s.PASSWORD];async function m(){if(E){let S=await ve(`\u042D\u0442\u0430 \u043A\u043E\u043C\u043D\u0430\u0442\u0430 \u043F\u043E\u0434 \u0437\u0430\u043C\u043A\u043E\u043C

\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C`,{btnText:"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C",placeholder:"\u041F\u0430\u0440\u043E\u043B\u044C",title:"\u0412\u0412\u0415\u0421\u0422\u0418 \u041F\u0410\u0420\u041E\u041B\u042C",height:200});if(S=="")return;if(r.server.send(s.ROOM_ENTER,{[s.ROOM_PASS]:te(S),[s.ROOM_OBJECT_ID]:i}),(await r.server.awaitPacket([s.ROOM_ENTER,s.ROOM_PASSWORD_IS_WRONG_ERROR,s.GAME_STARTED,s.USER_IN_ANOTHER_ROOM,s.USER_USING_DOUBLE_ACCOUNT,s.USER_LEVEL_NOT_ENOUGH,s.USER_KICKED]))[s.TYPE]==s.ROOM_PASSWORD_IS_WRONG_ERROR){await M("\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043F\u0430\u0440\u043E\u043B\u044C!"),m();return}r.screen=new se(i,{password:S,sendRoomEnter:!0});return}r.screen=new se(i)}let u=document.createElement("div");u.className="room";let f=document.createElement("img");f.className="room-lvl";let y=document.createElement("div");y.className="room-title";let _=document.createElement("div");_.className="room-status";let I=document.createElement("div");if(I.className="room-btn-players",o==0){let S=document.createElement("div");S.className="black",S.style.textAlign="center",S.style.padding="5px",S.textContent="\u0412\u044B \u0438\u0433\u0440\u0430\u0435\u0442\u0435 \u0432 \u044D\u0442\u043E\u0439 \u043A\u043E\u043C\u043D\u0430\u0442\u0435",u.appendChild(S)}else if(o==1){let S=document.createElement("div");S.className="black",S.style.textAlign="center",S.style.padding="5px",S.textContent="\u0412\u0430\u0441 \u0443\u0431\u0438\u043B\u0438 \u0432 \u044D\u0442\u043E\u0439 \u043A\u043E\u043C\u043D\u0430\u0442\u0435",u.appendChild(S)}u.style.background=o==0?"rgb(137 242 165 / 40%)":o==1?"rgb(255 138 146 / 40%)":"rgba(200,200,200,.4)",a.length==0&&(u.style.height=o<2?"110px":"80px"),u.onmouseenter=()=>o==0?"rgb(114 202 137 / 40%)":o==1?"rgb(219 103 111 / 40%)":u.style.background="rgba(200,200,200,.3)",u.onmouseleave=()=>o==0?"rgb(137 242 165 / 40%)":o==1?"rgb(255 138 146 / 40%)":u.style.background="rgba(200,200,200,.4)",u.onclick=()=>m(),t||(u.oncontextmenu=async S=>{S.preventDefault();let R=`\u0417\u0430\u0439\u0442\u0438 \u043A\u043E\u0433\u0434\u0430 ${e[s.MAX_PLAYERS]-1} \u0438\u0433\u0440\u043E\u043A\u043E\u0432 \u0431\u0443\u0434\u0435\u0442`,O=await new ae(["\u0417\u0430\u0439\u0442\u0438",R,"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C object id"],S).waitForResult();me(O).case(R,async()=>{let U=Xe({title:"\u0416\u0414\u0401\u041C",text:`\u041A\u043E\u043B-\u0432\u043E \u0438\u0433\u0440\u043E\u043A\u043E\u0432 \u0432 \u043A\u043E\u043C\u043D\u0430\u0442\u0435: ${e[s.PLAYERS_NUM]}`,canCloseAnywhere:!0}),H=e[s.MAX_PLAYERS];r.server.on("message",async v=>{if(v[s.TYPE]==s.ROOM_IN_LOBBY_STATE){let w=v[s.ROOM_IN_LOBBY_STATE][s.ROOM_OBJECT_ID],x=v[s.ROOM_IN_LOBBY_STATE][s.PLAYERS_IN_ROOM];i==w&&(U.changeText(`\u041A\u043E\u043B-\u0432\u043E \u0438\u0433\u0440\u043E\u043A\u043E\u0432 \u0432 \u043A\u043E\u043C\u043D\u0430\u0442\u0435: ${x}`),H-x==1&&(await $(50),U.done(),m()))}else if(v[s.TYPE]==s.GAME_STATUS_IN_ROOMS_LIST){let w=v[s.ROOM_IN_LOBBY_STATE][s.ROOM_OBJECT_ID];i==w&&v[s.STATUS]==2&&(U.done(),M("\u0418\u0433\u0440\u0430 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C"))}}).key("waitingRils"),U.box.on("destroy",()=>r.server.removeByKey("waitingRils"))}).case("\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C object id",()=>{})}),B(`rank/rank${c}_36.png`).then(S=>f.src=S),y.textContent=`${e[s.PASSWORD]?"\u{1F512} ":""}`+e[s.TITLE],_.textContent=e[s.STATUS]==0?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F":"\u0418\u0433\u0440\u0430 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C",_.style.color=e[s.STATUS]==0?"green":"red",y.prepend(f),y.appendChild(_),u.appendChild(y);let b=a.slice().sort((S,R)=>this.orderRoles.indexOf(S)-this.orderRoles.indexOf(R));for(let S of b){let R=document.createElement("img");z(S).then(A=>R.src=A),R.width=25,R.height=35,R.style.margin="1px",R.onmousedown=A=>A.preventDefault(),u.appendChild(R)}return I.textContent=typeof e[s.MIN_PLAYERS]=="number"?`\u0418\u0433\u0440\u043E\u043A\u0438: ${e[s.PLAYERS_NUM]} [${e[s.MIN_PLAYERS]}/${e[s.MAX_PLAYERS]}] \u2B63`:`\u0418\u0433\u0440\u043E\u043A\u0438: [${e[s.PLAYERS_NUM]}]`,u.appendChild(I),u}addRoom(e){let t=this,i=e[s.OBJECT_ID];if(!this.filter(e)){this.getRoomByObjectId(i)&&this.rooms.splice(this.getRoomIdByObjectId(i),1),this.rooms.push(Object.assign({},{room:e,id:this.roomsId,rils(){},remove(){}}));return}let n=d.getRoomElement(e);this.div.appendChild(n),this.getRoomByObjectId(i)&&this.rooms.splice(this.getRoomIdByObjectId(i),1),this.rooms.push(Object.assign({},{room:e,id:this.roomsId,rils(o){let c=o[s.PLAYERS_IN_ROOM],a=e[s.MIN_PLAYERS],E=e[s.MAX_PLAYERS]},remove(){t.div.removeChild(n)}})),this.roomsId++}};function pt(d){let e=Math.floor(d/86400),t=Math.floor(d%86400/3600),i=Math.floor(d%3600/60),n=d%60;return{days:e,hours:t,minutes:i,seconds:n}}function De(d,e,t,i="nominative"){let n=i==="genitive"?t:e;return d%10===1&&d%100!==11?n[0]:d%10>=2&&d%10<=4&&(d%100<10||d%100>=20)?n[1]:n[2]}function gt(d,e="nominative"){if(d==0)return"0 \u0441\u0435\u043A\u0443\u043D\u0434";let t=pt(d),i=[],n=["\u0434\u0435\u043D\u044C","\u0434\u043D\u044F","\u0434\u043D\u0435\u0439"],o=["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043E\u0432"],c=["\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u044B","\u043C\u0438\u043D\u0443\u0442"],a=["\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u044B","\u0441\u0435\u043A\u0443\u043D\u0434"],E=["\u0434\u043D\u044F","\u0434\u043D\u0435\u0439","\u0434\u043D\u0435\u0439"],m=["\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043E\u0432","\u0447\u0430\u0441\u043E\u0432"],u=["\u043C\u0438\u043D\u0443\u0442\u044B","\u043C\u0438\u043D\u0443\u0442","\u043C\u0438\u043D\u0443\u0442"],f=["\u0441\u0435\u043A\u0443\u043D\u0434\u0443","\u0441\u0435\u043A\u0443\u043D\u0434\u044B","\u0441\u0435\u043A\u0443\u043D\u0434"];return t.days>0&&i.push(`${t.days} ${De(t.days,n,E,e)}`),t.hours>0&&i.push(`${t.hours} ${De(t.hours,o,m,e)}`),t.minutes>0&&i.push(`${t.minutes} ${De(t.minutes,c,u,e)}`),(t.seconds>0||i.length===0)&&i.push(`${t.seconds} ${De(t.seconds,a,f,e)}`),i.join(" ")}function Pe(d,e="nominative"){if(!Number.isInteger(d)||d<0)throw new Error("\u0412\u0445\u043E\u0434\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u043D\u0435\u043E\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u043C \u0446\u0435\u043B\u044B\u043C \u0447\u0438\u0441\u043B\u043E\u043C");return gt(d,e)}function Ee(d){let e=new Date(d),t=E=>E.toString().padStart(2,"0"),i=t(e.getDate()),n=t(e.getMonth()+1),o=e.getFullYear(),c=t(e.getHours()),a=t(e.getMinutes());return`${i}.${n}.${o} ${c}:${a}`}async function ie(d,e={}){let t=null,i=new V({title:e.title??"\u041F\u041E\u0414\u0422\u0412\u0415\u0420\u0416\u0414\u0415\u041D\u0418\u0415",height:e.height,canCloseAnywhere:!1}),n=document.createElement("div");n.innerHTML=d.replaceAll(`
`,"<br/>"),n.style.color="black",n.style.textAlign="center",n.style.padding="15px 5px",i.content.appendChild(n);let o=document.createElement("div");o.style.width="100%",o.style.position="absolute",o.style.bottom="15px",o.style.display="flex",o.style.justifyContent="center",o.style.left="0",i.content.appendChild(o);let c=document.createElement("button");c.textContent=e.btnYes??"\u0414\u0410",c.style.width="45%",c.style.marginRight="2px",c.addEventListener("click",()=>{t=!0,i.close()}),o.appendChild(c);let a=document.createElement("button");return a.textContent=e.btnNo??"\u041D\u0415\u0422",a.style.width="45%",c.style.marginLeft="2px",a.addEventListener("click",()=>{t=!1,i.close()}),o.appendChild(a),await i.wait("destroy"),t}var le=class extends G{div;list;constructor(){super("Friends"),this.element.style.overflow="hidden",r.title="\u0414\u0440\u0443\u0437\u044C\u044F",(async()=>this.element.style.background=`url(${await K("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("button");t.className="back",t.onclick=()=>this.emit("back"),e.appendChild(t);let i=document.createElement("img");i.width=24,B("ui/Jb.png").then(o=>i.src=o),t.appendChild(i);let n=document.createElement("label");n.textContent="\u0414\u0440\u0443\u0437\u044C\u044F",e.appendChild(n),this.on("back",()=>{r.screen=new W}),this.init()}async init(){r.server.send(s.ADD_CLIENT_TO_FRIENDSHIP_LIST,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token}),this.div=document.createElement("div"),this.div.style.display="flex",this.div.style.padding="10px",this.div.style.flexDirection="column",this.element.appendChild(this.div);let e=document.createElement("div");e.style.display="flex",e.style.width="100%",this.div.appendChild(e);let t=document.createElement("button");t.className="gray",t.style.width="100%",t.style.margin="2px",t.textContent="\u0414\u0440\u0443\u0437\u044C\u044F",t.onclick=async()=>{r.server.send(s.ADD_CLIENT_TO_FRIENDSHIP_LIST,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token});let o=await r.server.awaitPacket([s.FRIENDSHIP_LIST]);t.className="gray",i.className="dark-gray",this.updateFriends(o[s.FRIENDSHIP_LIST][s.FRIENDSHIP_LIST])},e.appendChild(t);let i=document.createElement("button");i.className="dark-gray",i.style.width="100%",i.style.margin="2px",i.textContent="\u0417\u0430\u043F\u0440\u043E\u0441\u044B",i.onclick=async()=>{r.server.send(s.GET_SENT_FRIEND_REQUESTS_LIST,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token});let o=await r.server.awaitPacket([s.FRIENDSHIP_LIST]);t.className="dark-gray",i.className="gray",this.updateFriends(o[s.FRIENDSHIP_LIST][s.FRIENDSHIP_LIST])},e.appendChild(i),this.list=document.createElement("div"),this.list.style.overflowY="overlay",this.list.style.height=r.height-125+"px",this.div.appendChild(this.list),this.on("resize",()=>{this.list.style.height=r.height-125+"px"});let n=await r.server.awaitPacket([s.FRIENDSHIP_LIST]);this.updateFriends(n[s.FRIENDSHIP_LIST][s.FRIENDSHIP_LIST])}updateFriends(e){this.list.innerHTML="";for(let t of e){let n=!!t[s.FRIEND]?t[s.FRIEND]:t[s.USER],o=t[s.OBJECT_ID],c=n[s.OBJECT_ID],a=n[s.USERNAME],E=Number(t[s.NEW_MESSAGES]),m=!1,u=document.createElement("div");u.style.background="rgba(200,200,200,.4)",u.style.padding="7px",u.style.margin="5px",u.style.borderRadius="10px",u.style.display="flex",u.onclick=()=>{$(5).then(()=>{m||(r.screen=new ce(o,c,n))})};let f=document.createElement("img");f.width=f.height=40,f.style.borderRadius="100%",f.onmousedown=A=>A.preventDefault(),f.onclick=()=>{m=!0,j(c)},Z(n).then(A=>f.src=A),u.appendChild(f);let y=document.createElement("div");y.style.width=y.style.height="15px",y.style.minWidth=y.style.minHeight="15px",y.style.maxWidth=y.style.maxHeight="15px",y.style.boxSizing="border-box",y.style.background=n[s.IS_ONLINE]?"#3fe33f":"#636363",y.style.border="2px solid white",y.style.borderRadius="100%",y.style.position="relative",y.style.left="-45px",u.appendChild(y);let _=document.createElement("div");_.style.display="flex",_.style.flexDirection="column",_.style.width="300px",u.appendChild(_);let I=document.createElement("span");I.textContent=a,I.style.padding="0 5px 7px 10px",I.style.color="black",_.appendChild(I);let b=document.createElement("span");b.textContent=Ee(t[s.UPDATED]),b.style.padding="0 5px 0 5px",b.style.fontSize="11px",b.style.color="black",_.appendChild(b);let S=document.createElement("div");if(S.style.display="flex",S.style.width="100%",S.style.justifyContent="flex-end",u.appendChild(S),t[s.ROOM]){let A=document.createElement("button");A.textContent="\u0412 \u043A\u043E\u043C\u043D\u0430\u0442\u0435",A.onclick=()=>{m=!0,r.screen=new se(t[s.ROOM][s.OBJECT_ID])},S.appendChild(A)}if(E>0){let A=document.createElement("div");if(A.style.display="flex",A.style.alignItems="center",A.style.padding="5px",A.textContent=E>0?E+"":"",E>0){let O=document.createElement("img");O.width=18,O.height=14,O.style.marginLeft="5px",B("ui/0Y.png").then(U=>O.src=U),A.appendChild(O)}S.appendChild(A)}let R=document.createElement("button");R.className="gray",R.textContent="X",R.onclick=async()=>{m=!0,await ie("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u043E\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0438\u0437 \u0434\u0440\u0443\u0437\u0435\u0439? \u0412\u0441\u0435 \u043B\u0438\u0447\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u0442\u0430\u043A-\u0436\u0435 \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B.",{title:"\u0423\u0414\u0410\u041B\u0418\u0422\u042C \u0418\u0417 \u0414\u0420\u0423\u0417\u0415\u0419",height:175})&&(r.server.send(s.REMOVE_FRIEND,{[s.FRIEND_USER_OBJECT_ID]:c}),(await r.server.awaitPacket([s.REMOVE_FRIEND]))[s.TYPE]==s.REMOVE_FRIEND&&u.remove())},S.appendChild(R),this.list.appendChild(u)}}};var ce=class extends G{constructor(t,i,n){super("PrivateChat");this.friendObjectId=t;this.friendUserObjectId=i;this.user=n;r.title=n[s.USERNAME],(async()=>this.element.style.background=`url(${await K("day3")}) 0% 0% / cover`)();let o=document.createElement("div");o.className="header",this.element.appendChild(o);let c=document.createElement("button");c.className="back",c.onclick=()=>this.emit("back"),o.appendChild(c);let a=document.createElement("img");a.width=24,B("ui/Jb.png").then(m=>a.src=m),c.appendChild(a);let E=document.createElement("label");E.textContent=n[s.USERNAME],o.appendChild(E),this.on("back",()=>{r.screen=new le}),this.init()}messagesElem;input;async init(){r.server.send(s.ADD_CLIENT_TO_PRIVATE_CHAT,{[s.TOKEN]:r.user.token,[s.USER_OBJECT_ID]:r.user.objectId,[s.FRIENDSHIP]:this.friendObjectId});let t=await r.server.awaitPacket(s.PRIVATE_CHAT_LIST_MESSAGES);this.messagesElem=document.createElement("div"),this.messagesElem.style.height=r.height-(N()?110:90)+"px",this.messagesElem.style.textAlign="center",this.messagesElem.style.overflowX="hidden",this.messagesElem.style.overflowY="overlay",this.messagesElem.style.margin="10px 10px 5px 10px",this.messagesElem.style.outline="2px solid #c0c0c0",this.messagesElem.style.borderRadius="3px",this.messagesElem.style.background="rgba(255,255,255,.5)",this.messagesElem.style.display="flex",this.messagesElem.style.flexDirection="column",this.messagesElem.style.justifyContent="flex-start",this.element.appendChild(this.messagesElem);let i=document.createElement("div");i.style.width="100%",this.element.appendChild(i),this.input=document.createElement("input"),this.input.className="input-chat",this.input.type="text",this.input.placeholder="\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435",this.input.addEventListener("keydown",n=>{if(n.key=="Enter"&&this.input.value!=""){let o=this.input.value;this.input.value="",this.sendMessage(o)}}),N()&&(this.input.addEventListener("focus",()=>{r.width=innerWidth,r.height=innerHeight-1}),this.input.addEventListener("blur",()=>{r.width=innerWidth,r.height=innerHeight-2})),this.on("keydown",n=>n.key=="Enter"&&this.input.focus()),i.appendChild(this.input),this.on("message",n=>{n[s.TYPE]==s.PRIVATE_CHAT_LAST_MESSAGE&&this.addMessage(n[s.MESSAGE])}),this.on("resize",()=>{this.messagesElem.style.height=r.height-(N()?110:90)+"px"});for(let n of t[s.MESSAGES])this.addMessage(n,!1);this.messagesElem.scrollTop=this.messagesElem.scrollHeight,r.server.send(s.ACCEPT_MESSAGES,{[s.FRIENDSHIP]:this.friendObjectId})}messages=0;lastMessage;lastMessageDate;addMessage(t,i=this.messages>100){let n=t[s.TEXT],o=t[s.MESSAGE_TYPE],c=t[s.MESSAGE_STICKER],a=t[s.USER_OBJECT_ID],E=r.user.objectId==a?r.user:this.user,m=r.user.objectId==a?r.user.username:this.user[s.USERNAME],u=t[s.CREATED],f=t[s.ACCEPTED];if(a&&!t.isDate)if(this.lastMessage&&this.lastMessage.divM&&this.lastMessage.userObjectId==a){let y=document.createElement("span");y.textContent=P(n),y.className="black",y.style.userSelect="text",this.lastMessage.divM.appendChild(y)}else{let y=document.createElement("div");y.style.display="flex",y.style.textAlign="left",f||(y.style.background="#c5c5c5");let _=document.createElement("div");_.style.display="flex",_.style.flexDirection="column",_.style.justifyContent="center",_.style.wordBreak="auto-phrase";let I=document.createElement("img");Z(E).then(R=>I.src=R),I.style.borderRadius="100%",I.width=35,I.height=35,I.style.margin="5px",I.onmousedown=R=>R.preventDefault(),I.onclick=()=>j(a);let b=document.createElement("span");b.textContent=P(m),b.className="black",b.onclick=()=>this.addNickToInput(m);let S=document.createElement("span");S.textContent=P(n),S.style.color="black",S.style.userSelect="text",this.messagesElem.appendChild(y),this.lastMessage={userObjectId:a,divM:_},y.appendChild(I),y.appendChild(_),_.appendChild(b),_.appendChild(S),this.addMessage({isDate:!0,[s.TEXT]:`${Ee(u)}`,[s.ACCEPTED]:f,[s.USER_OBJECT_ID]:a},i)}else{let y=document.createElement("div");y.textContent=P(n),y.style.color="black",y.style.userSelect="text",f||(y.style.background="#c5c5c5"),y.style.textAlign="right",y.style.padding="3px",this.messagesElem.appendChild(y),this.lastMessageDate={userObjectId:a,elem:y}}this.messagesElem.scrollHeight-r.height-this.messagesElem.scrollTop<75&&this.messagesElem.scroll({top:this.messagesElem.scrollHeight,behavior:"smooth"}),i&&this.messagesElem.firstElementChild&&this.messagesElem.removeChild(this.messagesElem.firstElementChild),this.messages++}addNickToInput(t){let i=document.activeElement==this.input;if(this.input.value.includes(`[${t}]`)){let n=this.input.value.indexOf(`[${t}]`);this.input.value.lastIndexOf(`[${t}]`)==0?this.input.value=this.input.value.replace(`[${t}] `,""):this.input.value.substring(0,n).endsWith(" ")?this.input.value=this.input.value.replace(` [${t}] `,""):this.input.value=this.input.value.replace(`[${t}]`,"")}else[""," "].includes(this.input.value.substring((this.input.selectionStart??1)-1))?ne(this.input,`[${t}] `):ne(this.input,` [${t}] `);N()&&this.input.focus()}sendMessage(t,i={}){if(t.startsWith(r.settings.data.game.barmanEffect)){let n="?!&@#%^~<>*";t=Array.from({length:[...t].length-1},()=>n[Math.random()*n.length|0]).join("")}r.server.send(s.PRIVATE_CHAT_MESSAGE_CREATE,{[s.MESSAGE]:{[s.FRIENDSHIP]:this.friendObjectId,[s.MESSAGE_STYLE]:i.messageStyle??0,[s.MESSAGE_STICKER]:i.messageSticker??!1,[s.TEXT]:t}})}};function ft(d){let e=[4,6,9,11],t=[1,2,3,5,7,8,10],i=0,n=0;e.forEach(y=>{i+=d.roleStats[y]||0}),t.forEach(y=>{n+=d.roleStats[y]||0});let o=i+n,c=d.winsAsPeaceful+d.winsAsMafia,a=(c*100/d.playedGames).toFixed(2),E=(d.winsAsMafia*100/c).toFixed(1),m=(d.winsAsPeaceful*100/c).toFixed(1),u=i>0?Math.round(d.winsAsMafia*100/i):0,f=n>0?Math.round(d.winsAsPeaceful*100/n):0;return{totalWins:`(${a}%) ${c}`,winsAsMafia:`(${E}%) ${d.winsAsMafia}`,winsAsPeaceful:`(${m}%) ${d.winsAsPeaceful}`,gamesAsMafia:i,gamesAsPeaceful:n,mafiaWinRatePercentOfGamesAsMafia:u,peacefulWinRatePercentOfGamesAsPeaceful:f}}async function j(d){let e=Q(),t=new V({title:"\u041F\u0420\u041E\u0424\u0418\u041B\u042C",width:r.width/e/.75,height:r.height/e/.75,canCloseAnywhere:!0});t.content.style.overflowY="overlay",r.server.send(s.GET_USER_PROFILE,{[s.USER_RECEIVER]:d,[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token});let n=(await r.server.awaitPacket(s.USER_PROFILE))[s.USER_PROFILE],o=n[s.ROOM],c=n[s.PROFILE_USER_DATA],a={isOnline:c[s.IS_ONLINE],experience:c[s.EXPERIENCE],level:c[s.LEVEL],matchMakingScore:c[s.MATCH_MAKING_SCORE],nextLevelExperience:c[s.NEXT_LEVEL_EXPERIENCE],prevLevelExperience:c[s.PREVIOUS_LEVEL_EXPERIENCE],objectId:c[s.OBJECT_ID],photo:c[s.PHOTO],roleStats:c[s.PLAYER_ROLE_STATISTICS],sex:c[s.SEX],playedGames:c[s.PLAYED_GAMES],serverLanguage:c[s.SERVER_LANGUAGE],status:c[s.STATUS],updated:c[s.UPDATED],username:c[s.USERNAME],vip:c[s.VIP],winsAsMafia:c[s.WINS_AS_MAFIA],winsAsPeaceful:c[s.WINS_AS_PEACEFUL],sliver:n[s.USER_ACCOUNT_COINS][s.SILVER_COINS],gold:n[s.USER_ACCOUNT_COINS][s.GOLD_COINS],friend:n[s.FRIENDSHIP],friendFlag:n[s.FRIENDSHIP_FLAG]},E=typeof a.gold=="number",m=!1,u=document.createElement("div");u.style.width="100%",u.style.display="flex",u.style.flexDirection="column",u.style.alignItems="center",u.style.overflowY="overlay";let f=document.createElement("div");f.style.width=f.style.height="20px",f.style.minWidth=f.style.minHeight="20px",f.style.maxWidth=f.style.maxHeight="20px",f.style.boxSizing="border-box",f.style.background=a.isOnline?"#3fe33f":"#636363",f.style.border="2px solid white",f.style.borderRadius="100%",f.style.position="relative",f.style.left="-40px",f.style.top="-80px";let y=document.createElement("img");y.src=await Z(c),y.style.borderRadius="100%",y.width=y.height=100,y.style.margin="5px",y.style.transition=".5s",y.style.marginBottom="-10px",y.onmousedown=v=>v.preventDefault(),y.onclick=()=>{let v=Q();m?(y.style.position="static",y.style.width="",y.style.height="",y.style.borderRadius="100%",$(500).then(()=>f.style.display="block")):(y.style.position="relative",y.style.width=r.width/v/1.75+"px",y.style.height=r.width/v/1.75+"px",y.style.borderRadius="0",f.style.display="none"),m=!m},u.appendChild(y),u.appendChild(f);function _(v,w=!1){let x=document.createElement("h4");w&&(x.style.userSelect="text"),x.style.color="black",x.style.margin="5px",x.textContent=v,u.appendChild(x)}_(a.username,!0);let I=document.createElement("div");I.style.width="80%",I.style.textAlign="center",u.appendChild(I);function b(v,w){let x=document.createElement("button");x.style.margin="1px",x.textContent=v,w?x.onclick=w:x.disabled=!0,I.appendChild(x)}if(d!=r.user.objectId&&(a.friend?a.friendFlag==2?b("\u041F\u0440\u0438\u043D\u044F\u0442\u044C \u0434\u0440\u0443\u0436\u0431\u0443",async()=>{if(await ie("\u041F\u0440\u0438\u043D\u044F\u0442\u044C \u0437\u0430\u044F\u0432\u043A\u0443 \u0432 \u0434\u0440\u0443\u0437\u044C\u044F \u043E\u0442 \u0434\u0430\u043D\u043D\u043E\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",{title:"\u041F\u0420\u0418\u041D\u042F\u0422\u042C \u0414\u0420\u0423\u0416\u0411\u0423"})){r.server.send(s.ADD_FRIEND,{[s.FRIEND_USER_OBJECT_ID]:d});let w=await r.server.awaitPacket([s.ADD_FRIEND,s.YOUR_FRIENDSHIP_LIST_FULL]);if(w[s.TYPE]==s.YOUR_FRIENDSHIP_LIST_FULL){M(`\u0421\u043F\u0438\u0441\u043E\u043A \u0432\u0430\u0448\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439 \u043F\u043E\u043B\u043E\u043D. \u0412\u044B \u0443\u0436\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u043B\u0438 ${w[s.FRIENDSHIP_LIST_LIMIT]} \u0434\u0440\u0443\u0437\u0435\u0439 \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0434\u0440\u0443\u0437\u0435\u0439

\u0412\u044B \u0441\u043C\u043E\u0436\u0435\u0442\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C 200 \u0434\u0440\u0443\u0437\u0435\u0439, \u0435\u0441\u043B\u0438 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0438\u0442\u0435 VIP

\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043E\u0441\u0432\u043E\u0431\u043E\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0432\u0430\u0448\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439`);return}w[s.TYPE]==s.ADD_FRIEND&&(t.destroy(),j(d))}}):a.friendFlag==1&&b("\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C \u0437\u0430\u043F\u0440\u043E\u0441",async()=>{await ie("\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C \u0437\u0430\u043F\u0440\u043E\u0441 \u0434\u0440\u0443\u0436\u0431\u044B?",{title:"\u041E\u0422\u041C\u0415\u041D\u0418\u0422\u042C \u0417\u0410\u041F\u0420\u041E\u0421"})&&(r.server.send(s.REMOVE_FRIEND,{[s.FRIEND_USER_OBJECT_ID]:d}),(await r.server.awaitPacket([s.REMOVE_FRIEND]))[s.TYPE]==s.REMOVE_FRIEND&&(t.destroy(),j(d)))}):b("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0434\u0440\u0443\u0437\u044C\u044F",async()=>{if(await ie("\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0437\u0430\u044F\u0432\u043A\u0443 \u043D\u0430 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0434\u0430\u043D\u043D\u043E\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0432 \u0434\u0440\u0443\u0437\u044C\u044F?",{title:"\u0414\u041E\u0411\u0410\u0412\u0418\u0422\u042C \u0412 \u0414\u0420\u0423\u0417\u042C\u042F"})){r.server.send(s.ADD_FRIEND,{[s.FRIEND_USER_OBJECT_ID]:d});let w=await r.server.awaitPacket([s.ADD_FRIEND,s.YOUR_FRIENDSHIP_LIST_FULL]);if(w[s.TYPE]==s.YOUR_FRIENDSHIP_LIST_FULL){M(`\u0421\u043F\u0438\u0441\u043E\u043A \u0432\u0430\u0448\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439 \u043F\u043E\u043B\u043E\u043D. \u0412\u044B \u0443\u0436\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u043B\u0438 ${w[s.FRIENDSHIP_LIST_LIMIT]} \u0434\u0440\u0443\u0437\u0435\u0439 \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0434\u0440\u0443\u0437\u0435\u0439

\u0412\u044B \u0441\u043C\u043E\u0436\u0435\u0442\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C 200 \u0434\u0440\u0443\u0437\u0435\u0439, \u0435\u0441\u043B\u0438 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0438\u0442\u0435 VIP

\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043E\u0441\u0432\u043E\u0431\u043E\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0432\u0430\u0448\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439`);return}w[s.TYPE]==s.ADD_FRIEND&&(t.destroy(),j(d))}}),a.friendFlag==3&&(b("\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C \u0434\u0440\u0443\u0436\u0431\u0443",async()=>{await ie("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u043E\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0438\u0437 \u0434\u0440\u0443\u0437\u0435\u0439? \u0412\u0441\u0435 \u043B\u0438\u0447\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u0442\u0430\u043A-\u0436\u0435 \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B.",{title:"\u0423\u0414\u0410\u041B\u0418\u0422\u042C \u0418\u0417 \u0414\u0420\u0423\u0417\u0415\u0419",height:175})&&(r.server.send(s.REMOVE_FRIEND,{[s.FRIEND_USER_OBJECT_ID]:d}),(await r.server.awaitPacket([s.REMOVE_FRIEND]))[s.TYPE]==s.REMOVE_FRIEND&&(t.destroy(),j(d)))}),b("\u041B\u0438\u0447\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F",async()=>{t.destroy(),r.screen=new ce(a.friend,d,c)}))),o){o[s.SAME_ROOM]&&!E&&b("\u0412\u044B\u0433\u043D\u0430\u0442\u044C",async()=>{await ie("\u0415\u0441\u043B\u0438 \u0432\u0441\u0435 \u043F\u0440\u043E\u0433\u043E\u043B\u043E\u0441\u0443\u044E\u0442 \u0437\u0430 \u0438\u0441\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u0438\u0433\u0440\u043E\u043A\u0430 \u0438\u0437 \u043A\u043E\u043C\u043D\u0430\u0442\u044B, \u044D\u0442\u043E \u0431\u0443\u0434\u0435\u0442 \u0441\u0442\u043E\u0438\u0442\u044C \u0432\u0430\u043C 200 \u0441\u0435\u0440\u0435\u0431\u0440\u044F\u043D\u044B\u0445 \u043C\u043E\u043D\u0435\u0442",{title:"\u0412\u042B\u0413\u041D\u0410\u0422\u042C \u0418\u0413\u0420\u041E\u041A\u0410",height:180})&&(r.server.send(s.KICK_USER,{[s.ROOM_OBJECT_ID]:o[s.OBJECT_ID],[s.USER_OBJECT_ID]:d}),t.destroy())}),_("\u0421\u0435\u0439\u0447\u0430\u0441 \u0438\u0433\u0440\u0430\u0435\u0442 \u0432 \u043A\u043E\u043C\u043D\u0430\u0442\u0435");let v=J.getRoomElement(o);v.addEventListener("click",()=>t.close()),v.style.width="90%",u.appendChild(v)}E||b("\u041F\u043E\u0434\u0430\u0442\u044C \u0436\u0430\u043B\u043E\u0431\u0443"),_("\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0430");let S=document.createElement("div");S.style.display="flex",S.style.flexDirection="column",S.style.alignItems="stretch",S.style.width="95%",u.appendChild(S);function R(v,w,x){let F=document.createElement("div");F.style.color="black",F.style.background="rgb(189 184 184)",F.style.padding="5px",F.style.margin="1px",F.style.borderRadius="5px";let Y=document.createElement("span");Y.textContent=`${w}:`;let l=document.createElement("span");l.textContent=x,l.style.float="right",l.style.userSelect="text",F.appendChild(Y),F.appendChild(l),v.appendChild(F)}let A=ft(a);R(S,"\u0421\u0435\u0440\u0435\u0431\u0440\u043E",a.sliver),typeof a.gold=="number"&&R(S,"\u0417\u043E\u043B\u043E\u0442\u043E",a.gold),R(S,"\u0421\u044B\u0433\u0440\u0430\u043D\u043E \u0438\u0433\u0440",a.playedGames),R(S,"\u0421\u044B\u0433\u0440\u0430\u043D\u043E \u0438\u0433\u0440 \u0437\u0430 \u041C\u0430\u0444\u0438\u044E",A.gamesAsMafia),R(S,"\u0421\u044B\u0433\u0440\u0430\u043D\u043E \u0438\u0433\u0440 \u0437\u0430 \u041C\u0438\u0440\u043D\u044B\u0445",A.gamesAsPeaceful),R(S,"\u0412\u0441\u0435\u0433\u043E \u043F\u043E\u0431\u0435\u0434",A.totalWins),R(S,"\u041F\u043E\u0431\u0435\u0434 \u0437\u0430 \u041C\u0430\u0444\u0438\u044E",A.winsAsMafia),R(S,"\u041F\u043E\u0431\u0435\u0434 \u0437\u0430 \u041C\u0438\u0440\u043D\u044B\u0445",A.winsAsPeaceful),R(S,"M/M",(Number(a.winsAsPeaceful)/Number(a.winsAsMafia)).toFixed(2)),_("\u0421\u044B\u0433\u0440\u0430\u043D\u043D\u044B\u0435 \u0440\u043E\u043B\u0438");let O=document.createElement("div");O.style.display="flex",O.style.flexDirection="row",O.style.flexWrap="wrap",O.style.alignItems="stretch",O.style.justifyContent="center",O.style.width="95%";function U(v){let w=document.createElement("div");w.style.color="black",w.style.background="rgb(189 184 184)",w.style.padding="5px",w.style.margin="1px",w.style.borderRadius="5px";let x=document.createElement("img");k.loadImageAsDataURL(`${r.config.path}/assets/textures/roles/${v}.png`).then(Y=>x.src=Y),x.width=50,x.height=70,x.onmousedown=Y=>Y.preventDefault();let F=document.createElement("div");F.textContent=a.roleStats[v],F.style.textAlign="center",w.appendChild(x),w.appendChild(F),O.appendChild(w)}u.appendChild(O);for(let v=1;v<11;v++)U(v);_("\u041F\u043E\u0434\u0440\u043E\u0431\u043D\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F");let H=document.createElement("div");return H.style.display="flex",H.style.flexDirection="column",H.style.alignItems="stretch",H.style.width="95%",R(H,"ID \u041E\u0431\u044A\u0435\u043A\u0442\u0430",d),R(H,"\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0439 \u0432\u0445\u043E\u0434",Ee(a.updated)),R(H,"\u0421\u0435\u0440\u0432\u0435\u0440",a.serverLanguage),u.appendChild(H),t.content.appendChild(u),await t.wait("destroy")}var Se=class extends G{playersListElem;messagesElem;input;constructor(){super("GlobalChat"),r.title="\u041E\u0431\u0449\u0438\u0439 \u0447\u0430\u0442",(async()=>this.element.style.background=`url(${await K("day3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("button");t.className="back",t.onclick=()=>this.emit("back"),e.appendChild(t);let i=document.createElement("img");i.width=24,B("ui/Jb.png").then(o=>i.src=o),t.appendChild(i);let n=document.createElement("label");n.textContent="\u041E\u0431\u0449\u0438\u0439 \u0447\u0430\u0442",e.appendChild(n),this.init()}async init(){r.server.send(s.ADD_CLIENT_TO_CHAT,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token}),this.playersListElem=document.createElement("div"),this.playersListElem.style.height="155px",this.playersListElem.style.overflow="overlay",this.playersListElem.style.margin="10px",this.playersListElem.style.outline="2px solid #c0c0c0",this.playersListElem.style.borderRadius="3px",this.playersListElem.style.background="rgba(255,255,255,.5)",this.playersListElem.style.display="flex",this.playersListElem.style.flexWrap="wrap",this.playersListElem.style.flexDirection="column",this.element.appendChild(this.playersListElem),this.messagesElem=document.createElement("div"),this.messagesElem.style.height=r.height-(N()?270:250)+"px",this.messagesElem.style.textAlign="center",this.messagesElem.style.overflowX="hidden",this.messagesElem.style.overflowY="overlay",this.messagesElem.style.margin="10px 10px 5px 10px",this.messagesElem.style.outline="2px solid #c0c0c0",this.messagesElem.style.borderRadius="3px",this.messagesElem.style.background="rgba(255,255,255,.5)",this.messagesElem.style.display="flex",this.messagesElem.style.flexDirection="column",this.messagesElem.style.justifyContent="flex-start",this.element.appendChild(this.messagesElem);let e=await r.server.awaitPacket(s.MESSAGES);for(let i of e[s.MESSAGES])this.addMessage(i,!1);this.messagesElem.scrollTop=this.messagesElem.scrollHeight;let t=document.createElement("div");t.style.width="100%",this.element.appendChild(t),this.input=document.createElement("input"),this.input.className="input-chat",this.input.type="text",this.input.placeholder="\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435",this.input.addEventListener("keydown",i=>{if(i.key=="Enter"&&this.input.value!=""){let n=this.input.value;this.input.value="",this.sendMessage(n)}}),N()&&(this.input.addEventListener("focus",()=>{r.width=innerWidth,r.height=innerHeight-1}),this.input.addEventListener("blur",()=>{r.width=innerWidth,r.height=innerHeight-2})),this.on("keydown",i=>i.key=="Enter"&&this.input.focus()),t.appendChild(this.input),this.on("message",i=>{i[s.TYPE]==s.MESSAGE?this.addMessage(i[s.MESSAGE]):i[s.TYPE]==s.USERS&&this.updateUsers(i[s.USERS])}),this.on("resize",()=>{this.messagesElem.style.height=r.height-(N()?270:250)+"px"}),this.on("back",()=>{r.screen=new W})}joinLeaveMessages={};lastMessage;addMessage(e,t=!0){let i=e[s.TEXT],n=e[s.MESSAGE_TYPE],o=e[s.MESSAGE_STICKER],c=e[s.USER],a=c?c[s.OBJECT_ID]:"";if(c)if(this.lastMessage&&this.lastMessage.divM&&this.lastMessage.user[s.USERNAME]==c[s.USERNAME]){let E=document.createElement("span");he[a]=="dev"?E.innerHTML=i:E.innerHTML=P(i),E.className="black",E.style.userSelect="text",this.lastMessage.divM.appendChild(E)}else{let E=document.createElement("div");E.style.display="flex",E.style.textAlign="left";let m=document.createElement("div");m.style.display="flex",m.style.flexDirection="column",m.style.justifyContent="center",m.style.wordBreak="auto-phrase";let u=document.createElement("img");Z(c).then(_=>u.src=_),u.style.borderRadius="100%",u.width=35,u.height=35,u.style.margin="5px",u.onmousedown=_=>_.preventDefault(),u.onclick=()=>j(c[s.OBJECT_ID]);let f=document.createElement("span");f.textContent=P(c[s.USERNAME]),f.className="black",f.onclick=()=>this.addNickToInput(c[s.USERNAME]);let y=document.createElement("span");he[a]=="dev"?y.innerHTML=i:y.innerHTML=P(i),y.style.color=n==9?"#186400":n==11?"gray":n==17?"#113B81":n==27?"#940000":"black",y.style.userSelect="text",E.appendChild(u),E.appendChild(m),m.appendChild(f),m.appendChild(y),this.messagesElem.appendChild(E),this.lastMessage={user:c,divM:m}}else{let E=document.createElement("div");E.textContent=P(n==2?`\u0418\u0433\u0440\u043E\u043A ${i} \u0432\u043E\u0448\u0451\u043B`:n==3?`\u0418\u0433\u0440\u043E\u043A ${i} \u0432\u044B\u0448\u0435\u043B`:i),E.style.color=n==2?"#22640A":n==3?"#940000":"black",E.style.userSelect="text",E.style.margin="3px",this.messagesElem.appendChild(E),this.lastMessage={user:void 0,divM:void 0},(n==2||n==3)&&(this.joinLeaveMessages[i]&&this.messagesElem.removeChild(this.joinLeaveMessages[i]),this.joinLeaveMessages[i]=E)}this.messagesElem.scrollHeight-r.height-this.messagesElem.scrollTop<75&&this.messagesElem.scroll({top:this.messagesElem.scrollHeight,behavior:"smooth"}),t&&this.messagesElem.firstElementChild&&this.messagesElem.removeChild(this.messagesElem.firstElementChild)}addNickToInput(e){let t=document.activeElement==this.input;if(this.input.value.includes(`[${e}]`)){let i=this.input.value.indexOf(`[${e}]`);this.input.value.lastIndexOf(`[${e}]`)==0?this.input.value=this.input.value.replace(`[${e}] `,""):this.input.value.substring(0,i).endsWith(" ")?this.input.value=this.input.value.replace(` [${e}] `,""):this.input.value=this.input.value.replace(`[${e}]`,"")}else[""," "].includes(this.input.value.substring((this.input.selectionStart??1)-1))?ne(this.input,`[${e}] `):ne(this.input,` [${e}] `);N()&&this.input.focus()}sendMessage(e,t={}){if(e.startsWith(r.settings.data.game.barmanEffect)){let i="?!&@#%^~<>*";e=Array.from({length:[...e].length-1},()=>i[Math.random()*i.length|0]).join("")}r.server.send(s.CHAT_MESSAGE_CREATE,{[s.MESSAGE]:{[s.MESSAGE_STYLE]:t.messageStyle??0,[s.MESSAGE_STICKER]:t.messageSticker??!1,[s.TEXT]:e}})}updateUsers(e){this.playersListElem.innerHTML="";for(let t=0;t<e.length;t++){let i=e[t],n=document.createElement("div");n.style.display="flex",n.style.textAlign="left",n.style.alignItems="center";let o=document.createElement("img");Z(i).then(a=>o.src=a),o.style.borderRadius="100%",o.width=o.height=25,o.style.margin="5px",o.onmousedown=a=>a.preventDefault(),o.onclick=()=>j(i[s.OBJECT_ID]);let c=document.createElement("span");c.textContent=P(i[s.USERNAME]),c.className="black",c.onclick=()=>this.addNickToInput(i[s.USERNAME]),n.appendChild(o),n.appendChild(c),this.playersListElem.appendChild(n)}}};var Re=class extends G{constructor(){super("Settings"),this.element.style.overflow="hidden",r.title="\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",(async()=>this.element.style.background=`url(${await K("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("button");t.className="back",t.onclick=()=>this.emit("back"),e.appendChild(t);let i=document.createElement("img");i.width=24,B("ui/Jb.png").then(o=>i.src=o),t.appendChild(i);let n=document.createElement("label");n.textContent="\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",e.appendChild(n),this.on("back",()=>{r.screen=new W}),this.init()}init(){let e=document.createElement("div");e.style.display="flex",e.style.padding="5px",e.style.flexDirection="column";function t(a,E,m=!1){let u=document.createElement("div");u.style.borderRadius="10px",u.style.background="gray",u.style.height="30px",u.style.padding="5px",u.style.margin="2px",u.style.display="flex",u.style.alignItems="center",u.style.justifyContent="space-between",e.appendChild(u);let f=document.createElement("span");f.className="black",f.style.marginLeft="10px",f.textContent=a,u.appendChild(f);let y=document.createElement("input");y.type="checkbox",y.checked=m,y.style.zoom="1.5",y.onchange=()=>E(y.checked),u.appendChild(y)}function i(a,E,m="",u=""){let f=document.createElement("div");f.style.borderRadius="10px",f.style.background="gray",f.style.height="30px",f.style.padding="5px",f.style.margin="2px",f.style.display="flex",f.style.alignItems="center",f.style.justifyContent="space-between",e.appendChild(f);let y=document.createElement("span");y.className="black",y.style.marginLeft="10px",y.textContent=a,f.appendChild(y);let _=document.createElement("input");_.value=m,_.placeholder=u,_.onchange=()=>E(_.value),f.appendChild(_)}function n(a,E,m=1,u=10,f=1,y=1){let _=document.createElement("div");_.style.borderRadius="10px",_.style.background="gray",_.style.height="30px",_.style.padding="5px",_.style.margin="2px",_.style.display="flex",_.style.alignItems="center",_.style.justifyContent="space-between",e.appendChild(_);let I=document.createElement("span");I.className="black",I.style.marginLeft="10px",I.textContent=a,_.appendChild(I);let b=document.createElement("input");b.type="range",b.min=m+"",b.max=u+"",b.step=y+"",b.value=f+"",b.onchange=()=>E(Number(b.value)),_.appendChild(b)}function o(a,E,m){}function c(a,E,m){let u=document.createElement("div");u.style.borderRadius="10px",u.style.background="gray",u.style.height="30px",u.style.padding="5px",u.style.margin="2px",u.style.display="flex",u.style.alignItems="center",u.style.justifyContent="space-between",e.appendChild(u);let f=document.createElement("span");f.className="black",f.style.marginLeft="10px",f.textContent=a,u.appendChild(f);let y=document.createElement("button");y.textContent=E,y.onclick=m,u.appendChild(y)}c("\u0422\u0435\u043C\u0430","\u041D\u0430\u0441\u0442\u0440\u043E\u0438\u0442\u044C",()=>M("\u0421\u043A\u043E\u0440\u043E..")),n("\u041C\u0430\u0441\u0448\u0442\u0430\u0431",a=>{r.settings.data.window.zoom=a,r.element.style.zoom=a+""},N()?.4:.3,N()?.9:1.5,r.settings.data.window.zoom,.1),i("\u041E\u043F\u044C\u044F\u043D\u0435\u043D\u0438\u0435 \u0441",a=>{r.settings.data.game.barmanEffect=a},r.settings.data.game.barmanEffect),t('\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435 "\u0412\u044B \u0443\u043C\u0435\u0440\u043B\u0438"?',a=>{r.settings.data.game.showYouDiedMessage=a},r.settings.data.game.showYouDiedMessage),t(`\u0414\u043B\u044F \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A\u043E\u0432

\u042D\u0442\u043E \u0443\u0434\u043E\u0431\u043D\u043E \u0434\u043B\u044F \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u043C\u043E\u0434\u0430 \u0438 \u0442.\u0434.`,a=>{r.settings.data.developer=a},r.settings.data.developer),this.element.appendChild(e)}};function yt(d,e=.9){return new Promise((t,i)=>{if(d.type!="image/png"){i(new Error("\u0424\u0430\u0439\u043B \u043D\u0435 PNG"));return}let n=new Image,o=new FileReader;o.onload=()=>{n.src=o.result},n.onload=()=>{let c=document.createElement("canvas");c.width=n.width,c.height=n.height;let a=c.getContext("2d");if(!a){i(new Error("Canvas \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D"));return}a.fillStyle="#ffffff",a.fillRect(0,0,c.width,c.height),a.drawImage(n,0,0);let E=c.toDataURL("image/jpeg",e);t(E)},n.onerror=()=>i(new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F")),o.onerror=()=>i(new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u0430")),o.readAsDataURL(d)})}var W=class d extends G{constructor(){super("Dashboard"),r.title="\u041C\u0435\u043D\u044E",(async()=>this.element.style.background=`url(${await K("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("label");t.textContent="\u0411\u0430\u0444\u0438\u044F \u043E\u043D\u043B\u0430\u0439\u043D",e.appendChild(t),this.on("back",()=>r.destroy()),this.init()}async init(){let e=document.createElement("div");e.style.textAlign="center",this.element.appendChild(e);let t=document.createElement("img"),i=document.createElement("span");t.style.borderRadius="100%",t.width=t.height=100,t.style.margin="5px",t.onclick=async()=>{r.server.send(s.USER_GET_DEFAULT_PHOTOS,{});let R=(await r.server.awaitPacket(s.USER_DEFAULT_PHOTOS))[s.USER_DEFAULT_PHOTOS][s.USER_DEFAULT_PHOTOS_IDS];R.sort((w,x)=>{let[F,Y]=[w[0],Number(w.slice(1))],[l,p]=[x[0],Number(x.slice(1))];return F!==l?F==="m"?-1:1:Y-p});let A=new V({title:"\u0424\u041E\u0422\u041E \u041F\u0420\u041E\u0424\u0418\u041B\u042F",width:325,height:240,canCloseAnywhere:!0}),O=document.createElement("div");O.style.display="flex",O.style.padding="5px",O.style.alignItems="center",O.style.flexDirection="column",A.content.appendChild(O);let U=document.createElement("button");U.textContent="\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",U.onclick=()=>{let w=document.createElement("input");w.type="file",w.accept="image/png, image/jpeg",w.style.display="none",w.onchange=async()=>{let x=w.files?.[0];if(!x)return;if(!["image/png","image/jpeg"].includes(x.type)){M("\u0414\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B \u0442\u043E\u043B\u044C\u043A\u043E PNG \u0438 JPG");return}let F;try{x.type=="image/png"?F=(await yt(x)).split(",")[1]:F=await new Promise((l,p)=>{let g=new FileReader;g.onload=()=>l(g.result.split(",")[1]),g.onerror=()=>p(),g.readAsDataURL(x)})}catch{M("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F");return}if(r.server.send(s.UPLOAD_PHOTO,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token,[s.FILE]:F}),(await r.server.awaitPacket([s.DASHBOARD,s.WRONG_FILE_TYPE]))[s.TYPE]==s.WRONG_FILE_TYPE){M("\u0414\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B \u0442\u043E\u043B\u044C\u043A\u043E PNG \u0438 JPG");return}delete r.resources[`avatars_${r.user.objectId}`],r.user.photo="1",await A.close(),r.screen=new d},document.body.appendChild(w),w.click(),w.remove()},O.appendChild(U);let H=document.createElement("span");H.textContent="\u0438\u043B\u0438 \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430:",H.style.padding="10px",H.style.color="black",O.appendChild(H);let v=document.createElement("div");v.style.display="flex",v.style.flexWrap="wrap",v.style.width="300px",v.style.height="100px",v.style.background="#969696",v.style.borderRadius="10px",v.style.overflowY="overlay",v.style.padding="5px";for(let w of R){let x=document.createElement("img");x.src=`https://dottap.com/mafia/profile_photo/default/${w}.jpg`,x.width=x.height=50,x.style.borderRadius="100%",x.style.padding="2px",x.onmousedown=F=>F.preventDefault(),x.onclick=async()=>{r.server.send("ussdph",{[s.PHOTO]:w,[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token}),await r.server.awaitPacket("ussdph"),delete r.resources[`avatars_${r.user.objectId}`],r.user.photo=w,t.src=x.src},v.appendChild(x)}O.appendChild(v),await A.wait("destroy")},t.onmousedown=S=>S.preventDefault(),Z({[s.OBJECT_ID]:r.user.objectId,[s.PHOTO]:r.user.photo}).then(S=>t.src=S),i.textContent=r.user.username,e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(i);let n=document.createElement("div");n.innerHTML="\u0414\u043E\u0431\u0440\u043E \u043F\u043E\u0436\u0430\u043B\u043E\u0432\u0430\u0442\u044C \u0432 \u0411\u0430\u0444\u0438\u044E \u043E\u043D\u043B\u0430\u0439\u043D".replaceAll(`
`,"<br/>"),n.style.padding="10px",e.appendChild(n);let o=document.createElement("button");o.textContent="\u041A\u043E\u043C\u043D\u0430\u0442\u044B",o.style.width="60%",o.style.margin="3px",o.onclick=()=>r.screen=new J,e.appendChild(o),e.appendChild(document.createElement("br"));let c=document.createElement("button");c.textContent="\u0421\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0439",c.style.width="60%",c.style.margin="3px",c.disabled=!0,e.appendChild(c),e.appendChild(document.createElement("br"));let a=document.createElement("button");a.textContent="\u0427\u0430\u0442",a.style.width="60%",a.style.margin="3px",a.onclick=()=>r.screen=new Se,e.appendChild(a),e.appendChild(document.createElement("br"));let E=document.createElement("button");E.textContent="\u0414\u0440\u0443\u0437\u044C\u044F",E.style.width="60%",E.style.margin="3px",E.onclick=()=>r.screen=new le,e.appendChild(E),e.appendChild(document.createElement("br"));let m=document.createElement("button");m.textContent="\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",m.style.width="60%",m.style.margin="3px",m.onclick=()=>r.screen=new Re,e.appendChild(m),e.appendChild(document.createElement("br"));let u=document.createElement("button");if(u.textContent="\u041F\u0440\u043E\u0444\u0438\u043B\u044C",u.style.width="60%",u.style.margin="3px",u.onclick=()=>j(r.user.objectId),e.appendChild(u),e.appendChild(document.createElement("br")),N()){let S=document.createElement("button");S.textContent="\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C",S.style.width="60%",S.style.margin="3px",S.onclick=async()=>{let A=document.body,O=document.fullscreenElement??document.webkitFullscreenElement??document.mozFullScreenElement??document.msFullscreenElement;if(!A.requestFullscreen){M("\u041F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C \u0432 \u044D\u0442\u043E\u043C \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435 \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442, \u0443\u0432\u044B.."),S.disabled=!0;return}try{O?await document.exitFullscreen():await A.requestFullscreen(),O?S.textContent="\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C":S.textContent="\u0412\u044B\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C"}catch(U){M(`\u041E\u0448\u0438\u0431\u043A\u0430: ${U}`)}},e.appendChild(S);let R=document.createElement("button");R.textContent="\u0417\u0430\u043A\u0440\u044B\u0442\u044C \u0438\u0433\u0440\u0443",R.style.width="60%",R.style.margin="3px",R.onclick=()=>r.win.close(),e.appendChild(R)}r.server.send(s.ADD_CLIENT_TO_DASHBOARD,{[s.USER_OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token});let y=(await r.server.awaitPacket(s.DASHBOARD))[s.DASHBOARD],_=y[s.DASHBOARD_USER];r.user.update(_),r.user.goldCoins=y[s.USER_ACCOUNT_COINS][s.GOLD_COINS],r.user.sliverCoins=y[s.USER_ACCOUNT_COINS][s.SILVER_COINS],i.textContent=_[s.USERNAME],_[s.USERNAME]==""&&(async()=>{async function S(){let R=await ve("\u0414\u043B\u044F \u0438\u0433\u0440\u044B \u0438 \u043E\u0431\u0449\u0435\u043D\u0438\u044F \u0441 \u0434\u0440\u0443\u0433\u0438\u043C\u0438 \u0438\u0433\u0440\u043E\u043A\u0430\u043C\u0438 \u0443 \u0432\u0430\u0441 \u0434\u043E\u043B\u0436\u0435\u043D \u0431\u044B\u0442\u044C \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D \u041D\u0438\u043A\u043D\u044D\u0439\u043C");r.server.send(s.USERNAME_SET,{[s.OBJECT_ID]:r.user.objectId,[s.TOKEN]:r.user.token,[s.USERNAME]:R})}this.on("message",async R=>{if(R[s.TYPE]==s.USERNAME_HAS_WRONG_SYMBOLS)await M("\u0414\u043B\u044F \u043D\u0438\u043A\u043D\u0435\u0439\u043C\u0430 \u0432\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u0442\u043E\u043B\u044C\u043A\u043E 0-9 \u0430-\u042F a-Z \u0441\u0438\u043C\u0432\u043E\u043B\u044B"),S();else if(R[s.TYPE]==s.USERNAME_IS_EXISTS)await M("\u0414\u0430\u043D\u043D\u044B\u0439 \u043D\u0438\u043A\u043D\u0435\u0439\u043C \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u043D"),await S();else if(R[s.TYPE]==s.USERNAME_IS_OUT_OF_BOUNDS)await M(`\u041D\u0438\u043A\u043D\u0435\u0439\u043C \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u043A\u043E\u0440\u043E\u0442\u043A\u0438\u0439 \u0438\u043B\u0438 \u0434\u043B\u0438\u043D\u043D\u044B\u0439.
\u041D\u0438\u043A\u043D\u0435\u0439\u043C \u0434\u043E\u043B\u0436\u0435\u043D \u0441\u043E\u0441\u0442\u043E\u044F\u0442\u044C \u0438\u0437 3-12 \u0441\u0438\u043C\u0432\u043E\u043B\u044B`),await S();else if(R[s.TYPE]==s.USERNAME_IS_EMPTY)await M("\u041D\u0438\u043A\u043D\u0435\u0439\u043C \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C"),await S();else if(R[s.TYPE]==s.USERNAME_SET){let A=JSON.parse(await k.readFile(r.getPathProfiles())),O=A.find(U=>U.name=="");if(!O){alert(`\u041E\u0448\u0438\u0431\u043A\u0430... \u041E\u0442\u043F\u0440\u0430\u0432\u044C \u044D\u0442\u0443 \u043E\u0448\u0438\u0431\u043A\u0443 \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A\u0443

 ${JSON.stringify(A)}`);return}O.name=R[s.USERNAME],await k.writeFile(r.getPathProfiles(),JSON.stringify(A)),r.screen=new d}}),S()})();let I=Number(y[s.FRIENDSHIP_REQUESTS]),b=Number(y[s.NEW_MESSAGES]);if(b>0||I>0){E.innerHTML="";let S=document.createElement("div");S.textContent="\u0414\u0440\u0443\u0437\u044C\u044F",E.appendChild(S);{let R=document.createElement("div");if(R.style.display="flex",R.style.alignItems="center",R.textContent=b>0?b+"":"",b>0){let A=document.createElement("img");A.width=18,A.height=14,A.style.marginLeft="5px",B("ui/0Y.png").then(O=>A.src=O),R.appendChild(A)}E.appendChild(R);{let A=document.createElement("div");if(A.style.display="flex",A.style.alignItems="center",A.style.justifyContent="flex-end",A.textContent=I>0?I+"":"",I>0){let O=document.createElement("img");O.width=18,O.height=18,O.style.marginLeft="5px",B("ui/-8.png").then(U=>O.src=U),A.appendChild(O)}R.appendChild(A)}}}}};function Ze(d=32){let e="0123456789abcdef",t="";for(let i=0;i<d;i++)t+=e[Math.floor(Math.random()*e.length)];return t}function ke(d){let e=new Uint8Array(d);return crypto.getRandomValues(e),[...e].map(t=>t.toString(16).padStart(2,"0")).join("")}var Te=class{constructor(e){this.server=e}lastAuth;async addProfile({name:e,email:t,password:i,token:n,userId:o}){let c=JSON.parse(await k.readFile(r.getPathProfiles()));return c.find(a=>a.email==t||a.token==n||a.userId==o)?!1:(c.push({name:e??"",email:t,password:i,token:n,userId:o}),await k.writeFile(r.getPathProfiles(),JSON.stringify(c)),!0)}async auth(e){if(e||(e=r.config.auth),r.screen.name=="Loading"&&(r.screen.title="\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F.."),e){let t=await this.signIn(e.email,e.password,e.token,e.userId);if(t[s.TYPE]==s.SIGN_IN_ERROR){let i=t[s.ERROR];i==-7?await M(`\u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435
\u041A\u043E\u0434 \u043E\u0448\u0438\u0431\u043A\u0438: -7`,{title:"\u041E\u0428\u0418\u0411\u041A\u0410"}):i==-4?await M(`\u0421\u0435\u0441\u0441\u0438\u044F \u043D\u0435\u0430\u043A\u0442\u0438\u0432\u043D\u0430
\u041A\u043E\u0434 \u043E\u0448\u0438\u0431\u043A\u0438: -4`,{title:"\u041E\u0428\u0418\u0411\u041A\u0410"}):i==-3?await M(`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u043F\u0430\u0440\u043E\u043B\u044C
\u041A\u043E\u0434 \u043E\u0448\u0438\u0431\u043A\u0438: -3`,{title:"\u041E\u0428\u0418\u0411\u041A\u0410"}):i==-1&&await M(`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u043F\u043E\u0447\u0442\u0430
\u041A\u043E\u0434 \u043E\u0448\u0438\u0431\u043A\u0438: -1`,{title:"\u041E\u0428\u0418\u0411\u041A\u0410"}),r.screen=new oe}else if(t[s.TYPE]==s.USER_SIGN_IN){let i=e.token??t[s.USER][s.TOKEN],n=e.userId??t[s.USER][s.OBJECT_ID],o=this.lastAuth&&this.lastAuth.userId==n;return this.lastAuth={token:i,userId:n},this.addProfile({email:e.email,password:e.password,token:i,userId:n}),r.user.update(t[s.USER]),r.user.bToken=Ze(),o?r.screen.reconnect():r.screen=new W,!0}}else await M("\u0423 \u0442\u0435\u0431\u044F \u043D\u0435\u0442 \u043F\u0440\u043E\u0444\u0438\u043B\u0438");return!1}async signIn(e,t,i,n){return e&&t?this.server.send(s.SIGN_IN,{[s.EMAIL]:e,[s.PASSWORD]:te(t),[s.DEVICE_ID]:ke(8)}):n&&i&&this.server.send(s.SIGN_IN,{[s.OBJECT_ID]:n,[s.TOKEN]:i,[s.DEVICE_ID]:ke(8)}),await this.server.awaitPacket([s.USER_SIGN_IN,s.SIGN_IN_ERROR])}async signUp({email:e,password:t}){if(!e||!t)return;let n=await(await fetch("https://api.mafia.dottap.com/user/sign_up",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({email:e,username:"",password:te(t),deviceId:ke(8),lang:"RUS"})})).json();if(n.error){n.error=="USING_TEMP_EMAIL"?await M(`\u0417\u0430\u043F\u0440\u0435\u0449\u0435\u043D\u043E \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u0441\u0435\u0440\u0432\u0438\u0441\u044B \u0434\u043B\u044F \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 email.
\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u043F\u043E\u043F\u0443\u043B\u044F\u0440\u043D\u044B\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u044B, \u043D\u0430\u043F\u0440\u0438\u043C\u0435\u0440 Gmail, Mail.Ru, Yandex, Yahoo \u0438 \u0442\u0434.`):n.error=="EMAIL_EXISTS"&&await M("\u0414\u0430\u043D\u043D\u044B\u0439 email \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u043D");return}if(n[s.OBJECT_ID]){let o=n[s.OBJECT_ID],c=n[s.TOKEN];this.addProfile({name:"",email:e,password:t,token:c,userId:o}),r.user.bToken=Ze(),r.screen=new W}}};var Ae=class extends q{webSocket;auth=new Te(this);config={CONNECTION_CHECKER_PERIOD:2e3,CONNECTION_INACTIVE_TIMEOUT:6e3,KICK_USER_PRICE:200,PRICE_USERNAME_SET:5e3,SERVER_LANGUAGE_CHANGE_TIME:216e5,SERVER_ROOM_PASSWORD_MINIMAL_LEVEL:0,SERVER_ROOM_TITLE_MINIMAL_LEVEL:3,SET_PROFILE_PHOTO_MINIMAL_LEVEL:3,SHOW_PASSWORD_ROOM_INFO_BUTTON:!0,mmguiqik:-1};constructor(){super(),this.on("close",async()=>{console.log("Connection is closed.. Reconnecting in 1 second.."),await $(50),this.#e()}),this.#e()}#e(){console.log(`Connecting to server.. ${r.config.uriServer}`),this.webSocket=new WebSocket(r.config.uriServer),this.webSocket.addEventListener("open",this.#t.bind(this)),this.webSocket.addEventListener("error",i=>console.error(i)),this.webSocket.addEventListener("close",()=>this.emit("close"));let e=Object.fromEntries(Object.entries(s).map(([i,n])=>[n,i]));function t(i){if(i===null||typeof i!="object")return i;if(Array.isArray(i))return i.map(t);let n={};for(let o in i){let c=e[o]??o;n[c]=t(i[o])}return n}this.webSocket.addEventListener("message",i=>{let n=JSON.parse(i.data);this.call("message",n),r.settings.data.debug&&console.log(n,t(n))})}async#t(){this.call("connect"),console.log("Connected to server"),r.config.auth?await this.auth.auth():r.screen=new oe,this.on("message",async e=>{if(e[s.TYPE]==s.USER_BLOCKED){let t=e[s.REASON],i=e[s.TIME_SEC_REMAINING];r.screen=new W,M(`\u0412\u044B \u0431\u044B\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u043F\u043E \u043F\u0440\u0438\u0447\u0438\u043D\u0435 [${t}]

\u041E\u0441\u0442\u0430\u0432\u0448\u0435\u0435\u0441\u044F \u0432\u0440\u0435\u043C\u044F \u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u043A\u0438:
${Pe(i,"genitive")}`,{height:200})}else if(e[s.TYPE]==s.USER_INACTIVE_BLOCKED){r.screen=new W;let t=e[s.TIME_SEC_REMAINING];M(`\u0412\u044B \u0431\u044B\u043B\u0438 \u043D\u0435\u0430\u043A\u0442\u0438\u0432\u043D\u044B

\u041E\u0441\u0442\u0430\u0432\u0448\u0435\u0435\u0441\u044F \u0432\u0440\u0435\u043C\u044F \u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u043A\u0438:
${Pe(t,"genitive")}`,{height:200})}else if(e[s.TYPE]==s.SIGN_IN_ERROR)e[s.ERROR]==-4&&(await M("\u0421\u0435\u0441\u0441\u0438\u044F \u043D\u0435 \u0432\u0430\u043B\u0438\u0434\u043D\u0430. \u0418\u0433\u0440\u0430 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043A\u0440\u044B\u0442\u0430"),r.destroy());else if(e[s.TYPE]==s.EMAIL_NOT_VERIFIED){r.screen=new W;let t=await ie(`\u0412\u044B \u043D\u0435 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u043B\u0438 \u0432\u0430\u0448 email.
\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0432\u0430\u0448\u0443 \u044D\u043B\u043E\u043A\u0442\u0440\u043E\u043D\u043D\u0443\u044E \u043F\u043E\u0447\u0442\u0443 \u0438 \u0441\u043B\u0435\u0434\u0443\u0439\u0442\u0435 \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u0438 \u0432 \u043F\u0438\u0441\u044C\u043C\u0435.

\u0422\u0430\u043A \u0436\u0435 \u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043F\u0430\u043F\u043A\u0443 \u0421\u041F\u0410\u041C. \u0412\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043F\u0438\u0441\u044C\u043C\u043E \u043F\u043E\u043F\u0430\u043B\u043E \u0442\u0443\u0434\u0430

\u0415\u0441\u043B\u0438 \u0432\u0430\u043C \u043D\u0430 email \u043D\u0435 \u043F\u0440\u0438\u0448\u043B\u043E \u043F\u0438\u0441\u044C\u043C\u043E \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F \u0432\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0435\u0433\u043E \u0441\u043D\u043E\u0432\u0430

\u0415\u0441\u043B\u0438 \u0432\u044B \u043D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E \u0443\u043A\u0430\u0437\u0430\u043B\u0438 email \u043F\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0432\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u043D\u043E\u0432\u044B\u0439`,{title:"\u041F\u041E\u0414\u0422\u0412\u0415\u0420\u0416\u0414\u0415\u041D\u0418\u0415",btnYes:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C",btnNo:"\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C email",height:410});if(t==!0)try{let i=await(await fetch("https://api.mafia.dottap.com/user/email/verify",{method:"POST",headers:{Authorization:btoa(`${r.user.objectId}=:=${r.user.bToken}`)},body:new URLSearchParams({lang:"RUS"})})).json();i.error=="TOO_MANY_REQUESTS"&&M(`\u0412\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0437\u0430\u043F\u0440\u043E\u0441\u0438\u0442\u044C \u043F\u0438\u0441\u044C\u043C\u043E \u0434\u043B\u044F \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F email \u0447\u0435\u0440\u0435\u0437 ${i.data} \u0441\u0435\u043A\u0443\u043D\u0434`)}catch(i){M(`\u041E\u0448\u0438\u0431\u043A\u0430.. ${i}`)}else if(t==!1){let i=prompt("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u043E\u0432\u044B\u0439 email")}}})}send(e,t){typeof e=="object"?this.webSocket.send(JSON.stringify(e)):this.webSocket.send(JSON.stringify({[s.TYPE]:e,...t}))}async awaitPacket(e,t=1e7){return new Promise((i,n)=>{let o=setTimeout(()=>{this.off("message",c),n(new Error(`awaitPacket timeout: ${e}`))},t),c=a=>{(typeof e=="string"?a[s.TYPE]==e:e.includes(a[s.TYPE]))&&(clearTimeout(o),this.off("message",c),i(a))};this.on("message",c)})}destroy(){this.removeAllEvents(),this.webSocket.close()}};function qe(d){for(let e in d){let t=d[e];typeof t=="string"?t=="@main-color"?d[e]="#d03a41":t=="@main-text-color"?d[e]="#e1dcdc":t=="@black-text-color"&&(d[e]="#121212"):typeof t=="object"&&t!==null&&qe(t)}}async function _t(d){let e=JSON.parse(await k.readFile(d));return e[`#${r.element.id}`]=e["&"],delete e["&"],qe(e),e}async function Ue(d){let e=await _t(d),t=document.createElement("style");return t.innerHTML=Ye(e),t}var be=class{data={version:4,debug:!1,developer:!1,window:{zoom:N()?.6:1},game:{widthPL:130,zoomPL:1,showYouDiedMessage:!0,barmanEffect:"!"},roomCreate:{title:"",dayTime:0,minPlayers:5,maxPlayers:8,minLevel:1,selectedRoles:[6,9,11,2,5,7,8,10],password:"",vip:!1}};#e=!1;#t(e){for(let t in e)e.hasOwnProperty(t)&&(typeof e[t]=="object"&&e[t]!==null&&!Array.isArray(e[t])&&this.#t(e[t]),re(e,t,()=>this.#e&&this.write()))}async init(){this.#e||(this.#e=!0,await this.read())}async write(){await k.writeFile(`${r.config.path}/settings.json`,JSON.stringify(this.data))}async read(){if(!await k.existsFile(`${r.config.path}/settings.json`)){await this.write();return}let e=JSON.parse(await k.readFile(`${r.config.path}/settings.json`)),t=this.#s(e);Object.assign(this.data,t),console.log("Settings:",this.data),this.#t(this.data)}#s(e){let t=e.version||1,i=this.data.version;if(t>=i)return e;let n={...e};return me(t).case(1,()=>i>=2&&void(typeof n.settings>"u"&&(n.settings={title:"",dayTime:0,minPlayers:5,maxPlayers:8,minLevel:1,selectedRoles:[6,9,11,2,5,7,8,10],password:"",vip:!1}),n.version=2)).case(3,()=>i>=4&&void(n.game.showYouDiedMessage=!0,n.version=4)),n}};var Qe={launcher:"Alpha 1.2.2",vanilla:"Alpha 1.2.2"};var Fe=class extends q{version=Qe.vanilla;isAlive=!0;element;config;win;screen;server;settings=new be;user=new fe;title="";width=0;height=0;resources={};boxs=[];components=[];#e=!1;#t={popState:e=>this.emit("popstate",e),focusOut:e=>{N()&&je()&&setTimeout(()=>{window.scrollTo(0,0),document.body.style.transform="translateZ(0)",setTimeout(()=>{document.body.style.transform=""},50)},100)}};constructor(){super(),re(this,"title",t=>this.win.title=`${t} - \u0411\u0430\u0444\u0438\u044F \u043E\u043D\u043B\u0430\u0439\u043D (vanilla ${this.version})`),re(this,"screen",t=>{this.call("screenChange",t),this.screen?.destroy(),this.element.appendChild(t.element),history.pushState({screen:t.name},t.name,"")});let e=0;setInterval(()=>{this.tick(e),e++},50)}async init(){this.#e||(this.#e=!0,await this.settings.init(),N()&&(this.settings.data.window.zoom>.9&&(this.settings.data.window.zoom=.6),this.settings.data.game.widthPL!=130&&(this.settings.data.game.widthPL=130),this.settings.data.game.zoomPL!=1&&(this.settings.data.game.zoomPL=1)),this.element.tabIndex=0,this.element.style.zoom=this.settings.data.window.zoom+"",this.element.appendChild(await Ue(`${this.config.path}/assets/styles/main.json`)),N()&&this.element.appendChild(await Ue(`${this.config.path}/assets/styles/mobile.json`)),this.width=this.element.clientWidth,this.height=this.element.clientHeight,this.server=new Ae,this.screen=new ge("\u041F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u043A \u0441\u0435\u0440\u0432\u0435\u0440\u0443.."),this.#s(),this.#i())}async#s(){for(let e=1;e<11;e++)this.resources[`role_${e}`]=await k.loadImageAsDataURL(`${this.config.path}/assets/textures/roles/${e}.png`);this.resources.unknownChat=await k.loadImageAsDataURL(`${this.config.path}/assets/textures/roles/unknown_chat.png`)}#i(){this.element.addEventListener("focus",e=>this.emit("focus",e),!0),this.element.addEventListener("blur",e=>this.emit("unfocus",e),!0),this.element.addEventListener("click",e=>this.emit("click",e),!0),this.element.addEventListener("contextmenu",e=>this.emit("contextmenu",e),!0),this.element.addEventListener("keydown",e=>this.emit("keydown",e),!0),this.element.addEventListener("keyup",e=>this.emit("keyup",e),!0),this.element.addEventListener("wheel",e=>this.emit("wheel",e),!0),window.addEventListener("popstate",this.#t.popState,!0),window.addEventListener("focusout",this.#t.focusOut,!0),this.on("wheel",e=>{if(e.ctrlKey){let t=parseFloat(this.element.style.zoom),i=t;if(e.deltaY<0){if(t>2.5)return;t+=.1}else{if(t<.2)return;t-=.1}t!=i&&(this.settings.data.window.zoom=t,this.element.style.zoom=t+""),e.preventDefault()}}),this.on("keydown",e=>{if(e.ctrlKey){let t=parseFloat(this.element.style.zoom),i=t;if(e.key=="="||e.key=="+"){if(e.preventDefault(),t>2.5)return;t+=.1}else if(e.key=="-"){if(e.preventDefault(),t<.2)return;t-=.1}t!=i&&(this.settings.data.window.zoom=t,this.element.style.zoom=t+"")}}),this.win.on("close",()=>this.destroy()),this.on("popstate",()=>{this.screen.emit("preBack"),history.pushState({back:!0},"back","")})}tick(e){if(this.emit("tick",e),this.width!=this.element.clientWidth||this.height!=this.element.clientHeight){let t=this.width,i=this.height;this.width=this.element.clientWidth,this.height=this.element.clientHeight,this.emit("resize",{oldWidth:t,oldHeight:i})}this.screen?.tick(e)}getPathProfiles(){return"/profiles.json"}get zoom(){return this.settings.data.window.zoom}#n(){this.removeAllEvents(),window.removeEventListener("popstate",this.#t.popState),window.removeEventListener("focusout",this.#t.focusOut)}destroy(){this.isAlive&&(this.isAlive=!1,this.win.close(),this.resources={},this.components.forEach(e=>e.destroy()),this.boxs.forEach(e=>e.destroy()),this.element.remove(),this.#n(),this.server.destroy())}},r=new Fe;var et="wss://dottap.com:7091";var tt={path:"",version:1,auth:null,debug:!1,uriServer:et,userAgent:null},Be=tt;function ue(d){return Be[d]==null?tt[d]:Be[d]}function st(d){return d&&(Be=d),{path:ue("path"),version:ue("version"),auth:ue("auth"),debug:ue("debug"),uriServer:ue("uriServer"),userAgent:ue("userAgent")}}window.main=async function(d,e,t){window.apps||(window.apps=[]),window.apps.push(r),delete window.main,r.config=st(d),r.win=e,r.element=t,await k.init("Indexeddb"),await r.init()};})();
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.8.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2023
 * @license MIT
 */
//!root.JS_MD5_NO_NODE_JS && typeof process === 'object' && process.versions && process.versions.node;
