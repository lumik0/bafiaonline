(()=>{var Xe=Object.create;var ke=Object.defineProperty;var Ze=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var Qe=Object.getPrototypeOf,et=Object.prototype.hasOwnProperty;var tt=(E,e)=>()=>(e||E((e={exports:{}}).exports,e),e.exports);var st=(E,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of qe(e))!et.call(E,n)&&n!==t&&ke(E,n,{get:()=>e[n],enumerable:!(i=Ze(e,n))||i.enumerable});return E};var it=(E,e,t)=>(t=E!=null?Xe(Qe(E)):{},st(e||!E||!E.__esModule?ke(t,"default",{value:E,enumerable:!0}):t,E));var Ke=tt((Gs,Te)=>{(function(){"use strict";var E="input is invalid type",e="finalize already called",t=typeof window=="object",i=t?window:{};i.JS_MD5_NO_WINDOW&&(t=!1);var n=!t&&typeof self=="object",a=!1;a?i=global:n&&(i=self);var l=!i.JS_MD5_NO_COMMON_JS&&typeof Te=="object"&&Te.exports,c=typeof define=="function"&&define.amd,g=!i.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",h="0123456789abcdef".split(""),p=[128,32768,8388608,-2147483648],y=[0,8,16,24],f=["hex","array","digest","buffer","arrayBuffer","base64"],R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),I=[],T;if(g){var A=new ArrayBuffer(68);T=new Uint8Array(A),I=new Uint32Array(A)}var D=Array.isArray;(i.JS_MD5_NO_NODE_JS||!D)&&(D=function(r){return Object.prototype.toString.call(r)==="[object Array]"});var b=ArrayBuffer.isView;g&&(i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!b)&&(b=function(r){return typeof r=="object"&&r.buffer&&r.buffer.constructor===ArrayBuffer});var P=function(r){var d=typeof r;if(d==="string")return[r,!0];if(d!=="object"||r===null)throw new Error(E);if(g&&r.constructor===ArrayBuffer)return[new Uint8Array(r),!1];if(!D(r)&&!b(r))throw new Error(E);return[r,!1]},k=function(r){return function(d){return new x(!0).update(d)[r]()}},B=function(){var r=k("hex");a&&(r=nodeWrap(r)),r.create=function(){return new x},r.update=function(m){return r.create().update(m)};for(var d=0;d<f.length;++d){var u=f[d];r[u]=k(u)}return r},v=function(r){return function(d,u){return new U(d,!0).update(u)[r]()}},L=function(){var r=v("hex");r.create=function(m){return new U(m)},r.update=function(m,C){return r.create(m).update(C)};for(var d=0;d<f.length;++d){var u=f[d];r[u]=v(u)}return r};function x(r){if(r)I[0]=I[16]=I[1]=I[2]=I[3]=I[4]=I[5]=I[6]=I[7]=I[8]=I[9]=I[10]=I[11]=I[12]=I[13]=I[14]=I[15]=0,this.blocks=I,this.buffer8=T;else if(g){var d=new ArrayBuffer(68);this.buffer8=new Uint8Array(d),this.blocks=new Uint32Array(d)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}x.prototype.update=function(r){if(this.finalized)throw new Error(e);var d=P(r);r=d[0];for(var u=d[1],m,C=0,S,_=r.length,O=this.blocks,j=this.buffer8;C<_;){if(this.hashed&&(this.hashed=!1,O[0]=O[16],O[16]=O[1]=O[2]=O[3]=O[4]=O[5]=O[6]=O[7]=O[8]=O[9]=O[10]=O[11]=O[12]=O[13]=O[14]=O[15]=0),u)if(g)for(S=this.start;C<_&&S<64;++C)m=r.charCodeAt(C),m<128?j[S++]=m:m<2048?(j[S++]=192|m>>>6,j[S++]=128|m&63):m<55296||m>=57344?(j[S++]=224|m>>>12,j[S++]=128|m>>>6&63,j[S++]=128|m&63):(m=65536+((m&1023)<<10|r.charCodeAt(++C)&1023),j[S++]=240|m>>>18,j[S++]=128|m>>>12&63,j[S++]=128|m>>>6&63,j[S++]=128|m&63);else for(S=this.start;C<_&&S<64;++C)m=r.charCodeAt(C),m<128?O[S>>>2]|=m<<y[S++&3]:m<2048?(O[S>>>2]|=(192|m>>>6)<<y[S++&3],O[S>>>2]|=(128|m&63)<<y[S++&3]):m<55296||m>=57344?(O[S>>>2]|=(224|m>>>12)<<y[S++&3],O[S>>>2]|=(128|m>>>6&63)<<y[S++&3],O[S>>>2]|=(128|m&63)<<y[S++&3]):(m=65536+((m&1023)<<10|r.charCodeAt(++C)&1023),O[S>>>2]|=(240|m>>>18)<<y[S++&3],O[S>>>2]|=(128|m>>>12&63)<<y[S++&3],O[S>>>2]|=(128|m>>>6&63)<<y[S++&3],O[S>>>2]|=(128|m&63)<<y[S++&3]);else if(g)for(S=this.start;C<_&&S<64;++C)j[S++]=r[C];else for(S=this.start;C<_&&S<64;++C)O[S>>>2]|=r[C]<<y[S++&3];this.lastByteIndex=S,this.bytes+=S-this.start,S>=64?(this.start=S-64,this.hash(),this.hashed=!0):this.start=S}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},x.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,d=this.lastByteIndex;r[d>>>2]|=p[d&3],d>=56&&(this.hashed||this.hash(),r[0]=r[16],r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.bytes<<3,r[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},x.prototype.hash=function(){var r,d,u,m,C,S,_=this.blocks;this.first?(r=_[0]-680876937,r=(r<<7|r>>>25)-271733879<<0,m=(-1732584194^r&2004318071)+_[1]-117830708,m=(m<<12|m>>>20)+r<<0,u=(-271733879^m&(r^-271733879))+_[2]-1126478375,u=(u<<17|u>>>15)+m<<0,d=(r^u&(m^r))+_[3]-1316259209,d=(d<<22|d>>>10)+u<<0):(r=this.h0,d=this.h1,u=this.h2,m=this.h3,r+=(m^d&(u^m))+_[0]-680876936,r=(r<<7|r>>>25)+d<<0,m+=(u^r&(d^u))+_[1]-389564586,m=(m<<12|m>>>20)+r<<0,u+=(d^m&(r^d))+_[2]+606105819,u=(u<<17|u>>>15)+m<<0,d+=(r^u&(m^r))+_[3]-1044525330,d=(d<<22|d>>>10)+u<<0),r+=(m^d&(u^m))+_[4]-176418897,r=(r<<7|r>>>25)+d<<0,m+=(u^r&(d^u))+_[5]+1200080426,m=(m<<12|m>>>20)+r<<0,u+=(d^m&(r^d))+_[6]-1473231341,u=(u<<17|u>>>15)+m<<0,d+=(r^u&(m^r))+_[7]-45705983,d=(d<<22|d>>>10)+u<<0,r+=(m^d&(u^m))+_[8]+1770035416,r=(r<<7|r>>>25)+d<<0,m+=(u^r&(d^u))+_[9]-1958414417,m=(m<<12|m>>>20)+r<<0,u+=(d^m&(r^d))+_[10]-42063,u=(u<<17|u>>>15)+m<<0,d+=(r^u&(m^r))+_[11]-1990404162,d=(d<<22|d>>>10)+u<<0,r+=(m^d&(u^m))+_[12]+1804603682,r=(r<<7|r>>>25)+d<<0,m+=(u^r&(d^u))+_[13]-40341101,m=(m<<12|m>>>20)+r<<0,u+=(d^m&(r^d))+_[14]-1502002290,u=(u<<17|u>>>15)+m<<0,d+=(r^u&(m^r))+_[15]+1236535329,d=(d<<22|d>>>10)+u<<0,r+=(u^m&(d^u))+_[1]-165796510,r=(r<<5|r>>>27)+d<<0,m+=(d^u&(r^d))+_[6]-1069501632,m=(m<<9|m>>>23)+r<<0,u+=(r^d&(m^r))+_[11]+643717713,u=(u<<14|u>>>18)+m<<0,d+=(m^r&(u^m))+_[0]-373897302,d=(d<<20|d>>>12)+u<<0,r+=(u^m&(d^u))+_[5]-701558691,r=(r<<5|r>>>27)+d<<0,m+=(d^u&(r^d))+_[10]+38016083,m=(m<<9|m>>>23)+r<<0,u+=(r^d&(m^r))+_[15]-660478335,u=(u<<14|u>>>18)+m<<0,d+=(m^r&(u^m))+_[4]-405537848,d=(d<<20|d>>>12)+u<<0,r+=(u^m&(d^u))+_[9]+568446438,r=(r<<5|r>>>27)+d<<0,m+=(d^u&(r^d))+_[14]-1019803690,m=(m<<9|m>>>23)+r<<0,u+=(r^d&(m^r))+_[3]-187363961,u=(u<<14|u>>>18)+m<<0,d+=(m^r&(u^m))+_[8]+1163531501,d=(d<<20|d>>>12)+u<<0,r+=(u^m&(d^u))+_[13]-1444681467,r=(r<<5|r>>>27)+d<<0,m+=(d^u&(r^d))+_[2]-51403784,m=(m<<9|m>>>23)+r<<0,u+=(r^d&(m^r))+_[7]+1735328473,u=(u<<14|u>>>18)+m<<0,d+=(m^r&(u^m))+_[12]-1926607734,d=(d<<20|d>>>12)+u<<0,C=d^u,r+=(C^m)+_[5]-378558,r=(r<<4|r>>>28)+d<<0,m+=(C^r)+_[8]-2022574463,m=(m<<11|m>>>21)+r<<0,S=m^r,u+=(S^d)+_[11]+1839030562,u=(u<<16|u>>>16)+m<<0,d+=(S^u)+_[14]-35309556,d=(d<<23|d>>>9)+u<<0,C=d^u,r+=(C^m)+_[1]-1530992060,r=(r<<4|r>>>28)+d<<0,m+=(C^r)+_[4]+1272893353,m=(m<<11|m>>>21)+r<<0,S=m^r,u+=(S^d)+_[7]-155497632,u=(u<<16|u>>>16)+m<<0,d+=(S^u)+_[10]-1094730640,d=(d<<23|d>>>9)+u<<0,C=d^u,r+=(C^m)+_[13]+681279174,r=(r<<4|r>>>28)+d<<0,m+=(C^r)+_[0]-358537222,m=(m<<11|m>>>21)+r<<0,S=m^r,u+=(S^d)+_[3]-722521979,u=(u<<16|u>>>16)+m<<0,d+=(S^u)+_[6]+76029189,d=(d<<23|d>>>9)+u<<0,C=d^u,r+=(C^m)+_[9]-640364487,r=(r<<4|r>>>28)+d<<0,m+=(C^r)+_[12]-421815835,m=(m<<11|m>>>21)+r<<0,S=m^r,u+=(S^d)+_[15]+530742520,u=(u<<16|u>>>16)+m<<0,d+=(S^u)+_[2]-995338651,d=(d<<23|d>>>9)+u<<0,r+=(u^(d|~m))+_[0]-198630844,r=(r<<6|r>>>26)+d<<0,m+=(d^(r|~u))+_[7]+1126891415,m=(m<<10|m>>>22)+r<<0,u+=(r^(m|~d))+_[14]-1416354905,u=(u<<15|u>>>17)+m<<0,d+=(m^(u|~r))+_[5]-57434055,d=(d<<21|d>>>11)+u<<0,r+=(u^(d|~m))+_[12]+1700485571,r=(r<<6|r>>>26)+d<<0,m+=(d^(r|~u))+_[3]-1894986606,m=(m<<10|m>>>22)+r<<0,u+=(r^(m|~d))+_[10]-1051523,u=(u<<15|u>>>17)+m<<0,d+=(m^(u|~r))+_[1]-2054922799,d=(d<<21|d>>>11)+u<<0,r+=(u^(d|~m))+_[8]+1873313359,r=(r<<6|r>>>26)+d<<0,m+=(d^(r|~u))+_[15]-30611744,m=(m<<10|m>>>22)+r<<0,u+=(r^(m|~d))+_[6]-1560198380,u=(u<<15|u>>>17)+m<<0,d+=(m^(u|~r))+_[13]+1309151649,d=(d<<21|d>>>11)+u<<0,r+=(u^(d|~m))+_[4]-145523070,r=(r<<6|r>>>26)+d<<0,m+=(d^(r|~u))+_[11]-1120210379,m=(m<<10|m>>>22)+r<<0,u+=(r^(m|~d))+_[2]+718787259,u=(u<<15|u>>>17)+m<<0,d+=(m^(u|~r))+_[9]-343485551,d=(d<<21|d>>>11)+u<<0,this.first?(this.h0=r+1732584193<<0,this.h1=d-271733879<<0,this.h2=u-1732584194<<0,this.h3=m+271733878<<0,this.first=!1):(this.h0=this.h0+r<<0,this.h1=this.h1+d<<0,this.h2=this.h2+u<<0,this.h3=this.h3+m<<0)},x.prototype.hex=function(){this.finalize();var r=this.h0,d=this.h1,u=this.h2,m=this.h3;return h[r>>>4&15]+h[r&15]+h[r>>>12&15]+h[r>>>8&15]+h[r>>>20&15]+h[r>>>16&15]+h[r>>>28&15]+h[r>>>24&15]+h[d>>>4&15]+h[d&15]+h[d>>>12&15]+h[d>>>8&15]+h[d>>>20&15]+h[d>>>16&15]+h[d>>>28&15]+h[d>>>24&15]+h[u>>>4&15]+h[u&15]+h[u>>>12&15]+h[u>>>8&15]+h[u>>>20&15]+h[u>>>16&15]+h[u>>>28&15]+h[u>>>24&15]+h[m>>>4&15]+h[m&15]+h[m>>>12&15]+h[m>>>8&15]+h[m>>>20&15]+h[m>>>16&15]+h[m>>>28&15]+h[m>>>24&15]},x.prototype.toString=x.prototype.hex,x.prototype.digest=function(){this.finalize();var r=this.h0,d=this.h1,u=this.h2,m=this.h3;return[r&255,r>>>8&255,r>>>16&255,r>>>24&255,d&255,d>>>8&255,d>>>16&255,d>>>24&255,u&255,u>>>8&255,u>>>16&255,u>>>24&255,m&255,m>>>8&255,m>>>16&255,m>>>24&255]},x.prototype.array=x.prototype.digest,x.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(16),d=new Uint32Array(r);return d[0]=this.h0,d[1]=this.h1,d[2]=this.h2,d[3]=this.h3,r},x.prototype.buffer=x.prototype.arrayBuffer,x.prototype.base64=function(){for(var r,d,u,m="",C=this.array(),S=0;S<15;)r=C[S++],d=C[S++],u=C[S++],m+=R[r>>>2]+R[(r<<4|d>>>4)&63]+R[(d<<2|u>>>6)&63]+R[u&63];return r=C[S],m+=R[r>>>2]+R[r<<4&63]+"==",m};function U(r,d){var u,m=P(r);if(r=m[0],m[1]){var C=[],S=r.length,_=0,O;for(u=0;u<S;++u)O=r.charCodeAt(u),O<128?C[_++]=O:O<2048?(C[_++]=192|O>>>6,C[_++]=128|O&63):O<55296||O>=57344?(C[_++]=224|O>>>12,C[_++]=128|O>>>6&63,C[_++]=128|O&63):(O=65536+((O&1023)<<10|r.charCodeAt(++u)&1023),C[_++]=240|O>>>18,C[_++]=128|O>>>12&63,C[_++]=128|O>>>6&63,C[_++]=128|O&63);r=C}r.length>64&&(r=new x(!0).update(r).array());var j=[],Ne=[];for(u=0;u<64;++u){var Pe=r[u]||0;j[u]=92^Pe,Ne[u]=54^Pe}x.call(this,d),this.update(Ne),this.oKeyPad=j,this.inner=!0,this.sharedMemory=d}U.prototype=new x,U.prototype.finalize=function(){if(x.prototype.finalize.call(this),this.inner){this.inner=!1;var r=this.array();x.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(r),x.prototype.finalize.call(this)}};var z=B();z.md5=z,z.md5.hmac=L(),l?Te.exports=z:(i.md5=z,c&&define(function(){return z}))})()});var Oe=class{constructor(e,t,i,n=2){this.event=e;this.callback=t;this.owner=i;this.priorityName=n}keyName;key(e){return this.keyName=e,this}getKey(){return this.keyName}priority(e){return this.priorityName=e,this}getPriority(){return this.priorityName}remove(){this.owner._removeHandle(this)}},J=class{customListeners={};on(e,t,i=2){let n=new Oe(e,t,this,i),a=this.customListeners[e];a||(a=[],this.customListeners[e]=a);let l=a.findIndex(c=>c.getPriority()>i);return l===-1?a.push(n):a.splice(l,0,n),n}once(e,t,i=2){let n=((...a)=>{t(...a),this.off(e,n)});return this.on(e,n,i)}off(e,t){let i=this.customListeners[e];if(!i)return!1;let n=i.length;return this.customListeners[e]=i.filter(a=>a.callback!==t),i.length<n}async call(e,t=void 0){let i=this.customListeners[e];if(!i)return t;for(let n of i){let a=n.callback(t);a instanceof Promise&&await a}return t}emit(e,...t){let i=this.customListeners[e];if(!i)return!1;for(let n of i)n.callback(...t);return i.length>0}async emitR(e,...t){let i=this.customListeners[e];if(!i)return[];let n=[];for(let a of i){let l=a.callback(...t);n.push(l instanceof Promise?await l:l)}return n}async wait(e,t=1e7){return new Promise((i,n)=>{let a=setTimeout(()=>{this.off(e,l)},t),l=(...c)=>{clearTimeout(a),this.off("message",l),i(c)};this.on(e,l)})}removeByKey(e){let t=!1;for(let i in this.customListeners){let n=this.customListeners[i];if(!n)continue;let a=n.length;this.customListeners[i]=n.filter(l=>l.getKey()!==e),this.customListeners[i].length<a&&(t=!0)}return t}_removeHandle(e){let t=this.customListeners[e.event];t&&(this.customListeners[e.event]=t.filter(i=>i!==e))}removeAllEvents(){this.customListeners={}}};var ae=window;function Q(){let E=ae.getComputedStyle(document.body),e=E.transform,t=ae.parseFloat(E.zoom||"1");if(e&&e!="none"){let i=e.match(/matrix\(([\d.]+),/);if(i)return ae.parseFloat(i[1])}return ae.isNaN(t)?1:t}function $(E=0){return new Promise(e=>setTimeout(e,E))}function Ue(E){let e="";for(let t in E){let i=t.replace(/[A-Z]{1}/g,n=>"-"+n.toLowerCase());if(i=="this"&&(i="&"),typeof E[t]=="object")if(ae.Array.isArray(E[t]))for(let n of E[t])e+=`${i}:${n};`;else e+=`${i}{${Ue(E[t])}}`;else e+=`${i}:${E[t]};`}return e}function Fe(E){let e="";for(let t in E){let i=E[t];e+=t+"{"+Ue(i)+"}"}return e}function w(E){return String(E).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/gi,"/")}var F=class extends J{constructor(t="Screen"){super();this.name=t;this.element=document.createElement("div"),this.element.tabIndex=1,this.element.style.width="100%",this.element.style.height="100%",$(50).then(()=>{o.on("resize",i=>this.emit("resize",i)).key(`screen_${t}`),o.on("keydown",i=>this.emit("keydown",i)).key(`screen_${t}`),o.on("keyup",i=>this.emit("keyup",i)).key(`screen_${t}`),o.on("click",i=>this.emit("click",i)).key(`screen_${t}`),o.server.on("message",i=>this.emit("message",i)).key(`screen_${t}`),this.element.focus()}),this.on("keydown",i=>{i.key=="Escape"&&(o.boxs.length>0?o.boxs[0].close():this.emit("back"))})}element;tick(t){this.emit("tick",t)}destroy(){this.removeAllEvents(),o.removeByKey(`screen_${this.name}`),o.server.removeByKey(`screen_${this.name}`),o.element.removeChild(this.element)}};var xe=class{constructor(e){this.value=e}matched=!1;case(e,t){return!this.matched&&this.value===e&&(t(),this.matched=!0),this}else(e){return typeof e=="function"?e():e}};function Ie(E){return new xe(E)}function ie(E,e,t,i){let n=E[e];Object.defineProperty(E,e,{get:()=>i?i():n,set:a=>{t?.(a),n=a},enumerable:!0})}var Re=class{constructor(e="Macintosh HD"){this.dbName=e}db;objectStore="Storage";logDebug=!1;log(...e){this.logDebug&&console.log(...e)}init(){return new Promise((e,t)=>{let i=indexedDB.open(this.dbName,1);i.onupgradeneeded=()=>{i.result.createObjectStore(this.objectStore)},i.onsuccess=()=>{this.db=i.result,e()},i.onerror=()=>t(i.error)})}transaction(){return this.db.transaction([this.objectStore],"readwrite").objectStore(this.objectStore)}getPath(e){return e=String(e),e.startsWith("/")||(e="/"+e),e}async createFile(e){e=this.getPath(e),await this.writeFile(e,"")}async writeFile(e,t){e=this.getPath(e);let i=this.transaction();return new Promise((n,a)=>{let c={type:"file",content:t instanceof Blob?t:new Blob([t instanceof Uint8Array?t:String(t)])},g=i.put(c,e);g.onsuccess=()=>{this.log(`Writed file [${e}] = ${t instanceof Uint8Array?`${t.length} length of uint8array`:t instanceof Blob?`${t.size} length of blob`:typeof t=="object"?"":`${t.length} length of string`}`),n()},g.onerror=()=>{this.log(`Can't write file [${e}]`),a(g.error)}})}async readFile(e){e=this.getPath(e);let t=await this.readFileBytes(e);return new TextDecoder().decode(t)}async readFileBytes(e){e=this.getPath(e);let t=this.transaction();return new Promise((i,n)=>{let a=t.get(e);a.onsuccess=()=>{let l=a.result;l&&l.type=="file"?l.content instanceof Blob?l.content.arrayBuffer().then(c=>i(new Uint8Array(c))):n(new Error("Unsupported file content type")):n("File not found or not a file "+e)},a.onerror=()=>n(a.error)})}async readFileB64(e){e=this.getPath(e);let t=this.transaction();return new Promise((i,n)=>{let a=t.get(e);a.onsuccess=()=>{let l=a.result;l?.type==="file"?l.content.arrayBuffer().then(c=>{let g=new Uint8Array(c),h="";g.forEach(p=>h+=String.fromCharCode(p)),i(`data:${l.content.type||"application/octet-stream"};base64,${btoa(h)}`)}):n("File not found or not a file")},a.onerror=()=>n(a.error)})}async createDir(e){if(e=this.getPath(e),await this.existsDir(e))return;let t=this.transaction();return new Promise((i,n)=>{let a={type:"dir"},l=t.put(a,e);l.onsuccess=()=>{this.log(`Created directory ${e}`),i()},l.onerror=()=>{this.log("Can't create directory"),n(l.error)}})}async existsDir(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result!==void 0&&n.result.type=="dir"),n.onerror=()=>i(!1)})}async existsFile(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result!==void 0&&n.result.type=="file"),n.onerror=()=>i(!1)})}async exists(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result!==void 0),n.onerror=()=>i(!1)})}async isFile(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result?.type==="file"),n.onerror=()=>i(!1)})}async isDirectory(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.get(e);n.onsuccess=()=>i(n.result?.type==="dir"),n.onerror=()=>i(!1)})}async deleteFile(e){e=this.getPath(e);let t=this.transaction();return new Promise(i=>{let n=t.delete(e);n.onsuccess=()=>{this.log(`Deleted file ${e}`),i(!0)},n.onerror=()=>{this.log(`Can't delete file ${e}`),i(!1)}})}async deleteDirectory(e,t=!1){e=this.getPath(e);let i=this.transaction(),n=e.endsWith("/")?e:e+"/",a=[];return new Promise(l=>{let c=i.openCursor();c.onsuccess=()=>{let g=c.result;if(!g){let p=this.transaction();if(p.delete(e),t)for(let y of a)p.delete(y);this.log(`Deleted directory ${e} - ${t}`),l(!0);return}let h=g.key;t&&h.startsWith(n)&&a.push(h),g.continue()},c.onerror=()=>{this.log(`Can't delete directory ${e} - ${t}`),l(!1)}})}async listDir(e){e=this.getPath(e);let t=this.db.transaction("files","readonly").objectStore("files"),i=new Set,n=e.endsWith("/")?e:e+"/";return new Promise((a,l)=>{let c=t.openCursor();c.onsuccess=()=>{let g=c.result;if(!g)return a([...i]);let h=g.key;if(h.startsWith(n)){let p=h.slice(n.length).split("/")[0];i.add(p)}g.continue()},c.onerror=()=>l(c.error)})}async rename(e,t){e=this.getPath(e),t=this.getPath(t);let i=await this.readFileBytes(e);return await this.writeFile(t,i),this.log(`Rename ${e} - ${t}`),this.deleteFile(e)}async copyFile(e,t){e=this.getPath(e),t=this.getPath(t);let i=await this.readFileBytes(e);return await this.writeFile(t,i),this.log(`Copy ${e} - ${t}`),!0}async move(e,t){return e=this.getPath(e),t=this.getPath(t),await this.copyFile(e,t)?(this.log(`Move ${e} - ${t}`),this.deleteFile(e)):(this.log(`Can't move ${e} - ${t}`),!1)}async loadImage(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=new Blob([t]),n=URL.createObjectURL(i);return new Promise((a,l)=>{let c=new Image;c.onload=()=>{URL.revokeObjectURL(n),a(c)},c.onerror=()=>{URL.revokeObjectURL(n),l("Image load failed")},c.src=n})}cacheImagesAsDataURL={};async loadImageAsDataURL(e){e=this.getPath(e);let t=await this.getSHA1(e);if(this.cacheImagesAsDataURL[e]&&this.cacheImagesAsDataURL[e].sha1==t)return this.cacheImagesAsDataURL[e].result;let i=await this.readFileBytes(e),n=btoa(String.fromCharCode(...new Uint8Array(i))),l=`data:${M.getMimeType(e)};base64,${n}`;return this.cacheImagesAsDataURL[e]={sha1:t,result:l},l}async erase(){let e=this.transaction();return new Promise((t,i)=>{let n=e.openCursor();n.onsuccess=a=>{let l=a.target.result,c=this.db.transaction(Array.from(l.objectStoreNames),"readwrite"),g=Array.from(l.objectStoreNames);for(let h of g){let y=c.objectStore(h).clear();y.onsuccess=()=>{},y.onerror=f=>{new Error(`Error deleting store "${h}":`,f.target.error),t(!1)}}c.oncomplete=()=>{l.close(),t(!0)}},n.onerror=a=>{new Error("Error opening db",a.target.error),t(!1)}})}async getSHA1(e){e=this.getPath(e);let t=await this.readFileBytes(e);if(typeof crypto.subtle>"u")return Math.random().toString();let i=await crypto.subtle.digest("SHA-1",t);return Array.from(new Uint8Array(i)).map(a=>a.toString(16).padStart(2,"0")).join("")}};var Se=class{constructor(e){this.root=e}type="OPFS";logDebug=!1;log(...e){this.logDebug&&console.log(...e)}getPath(e){return e.startsWith("/")||(e="/"+e),e}async getPathParts(e){return e.replace(/^\/+/,"").split("/").filter(global.Boolean)}async getParentDirHandle(e,t=!1){e=this.getPath(e);let i=await this.getPathParts(e);i.pop();let n=this.root;for(let a of i)n=await n.getDirectoryHandle(a,{create:t});return n}async getFileHandle(e,t=!1){e=this.getPath(e);let n=(await this.getPathParts(e)).pop();return(await this.getParentDirHandle(e,t)).getFileHandle(n,{create:t})}async getDirectoryHandle(e,t=!1){e=this.getPath(e);let i=await this.getPathParts(e),n=this.root;for(let a of i)n=await n.getDirectoryHandle(a,{create:t});return n}async createFile(e){e=this.getPath(e),await this.getFileHandle(e,!0),this.log(`Created file [${e}]`)}async writeFile(e,t){e=this.getPath(e);let n=await(await this.getFileHandle(e,!0)).createWritable();t instanceof global.Uint8Array?await n.write(new global.Blob([t])):await n.write(t),await n.close(),this.log(`Writed file [${e}] = ${t instanceof global.Uint8Array?`${t.length} length of uint8array`:t instanceof global.Blob?"":`${t.length} length of string`}`)}async readFile(e){e=this.getPath(e);try{return await(await(await this.getFileHandle(e)).getFile()).text()}catch{throw error(`Can't read file [${e}]`)}}async readFileBytes(e){e=this.getPath(e);try{let n=await(await(await this.getFileHandle(e)).getFile()).arrayBuffer();return new global.Uint8Array(n)}catch{throw error(`Can't read file [${e}]`)}}async readFileB64(e){e=this.getPath(e);try{let t="",n=await(await this.getFileHandle(e)).getFile(),a=await n.arrayBuffer();return new global.Uint8Array(a).forEach(c=>t+=global.String.fromCharCode(c)),`data:${n.type||"application/octet-stream"};base64,${global.btoa(t)}`}catch{throw error(`Can't read file [${e}]`)}}async loadImage(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=new global.Blob([t]),n=global.URL.createObjectURL(i);return new Promise((a,l)=>{let c=new global.Image;c.onload=()=>{global.URL.revokeObjectURL(n),a(c)},c.onerror=g=>{global.URL.revokeObjectURL(n),l(`Failed to load image: ${g}`)},c.src=n})}async loadImageAsDataURL(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=global.btoa(global.String.fromCharCode(...new global.Uint8Array(t)));return`data:${M.getMimeType(e)};base64,${i}`}async createDir(e){e=this.getPath(e),!await this.existsDir(e)&&(await this.getDirectoryHandle(e,!0),this.log(`Created directory [${e}]`))}async exists(e){e=this.getPath(e);let t=!1,i=!1;try{await this.getFileHandle(e),t=!0}catch{}try{await this.getDirectoryHandle(e),i=!0}catch{}return t||i}async existsFile(e){e=this.getPath(e);try{return await this.getFileHandle(e),!0}catch{}return!1}async existsDir(e){e=this.getPath(e);try{return await this.getDirectoryHandle(e),!0}catch{}return!1}async isFile(e){e=this.getPath(e);try{return await this.getFileHandle(e),!0}catch{return!1}}async isDirectory(e){e=this.getPath(e);try{return await this.getDirectoryHandle(e),!0}catch{return!1}}async deleteFile(e){if(e=this.getPath(e),!await this.existsFile(e))return this.log(`Can't delete file [${e}] - not exists`),!1;try{let i=(await this.getPathParts(e)).pop();return await(await this.getParentDirHandle(e)).removeEntry(i),this.log(`Deleted file [${e}]`),!0}catch(t){return this.log(`Can't delete file [${e}] - ${t}`),!1}}async deleteDirectory(e,t=!1){if(e=this.getPath(e),!await this.existsDir(e))return this.log(`Can't delete directory [${e}] - not exists`),!1;try{let n=(await this.getPathParts(e)).pop();return await(await this.getParentDirHandle(e)).removeEntry(n,{recursive:t}),this.log(`Deleted directory [${e}]`),!0}catch(i){return this.log(`Can't delete directory [${e}] - ${i}`),!1}}async listDir(e){e=this.getPath(e);try{let t=await this.getDirectoryHandle(e),i=[];for await(let[n]of t.entries())i.unshift(n);return i}catch{return[]}}async rename(e,t){e=this.getPath(e),t=this.getPath(t);try{let i=await this.readFileBytes(e);await this.writeFile(t,i);let n=await this.deleteFile(e);return n?this.log(`Renamed file ${e} - ${t}`):this.log("Failed to delete original file during rename"),n}catch{return this.log(`Can't rename file ${e} - ${t}`),!1}}async copyFile(e,t){e=this.getPath(e),t=this.getPath(t);try{let i=await this.readFileBytes(e);return await this.writeFile(t,i),this.log(`Copy ${e} - ${t}`),!0}catch{return this.log(`Can't copy ${e} - ${t}`),!1}}async move(e,t){return e=this.getPath(e),t=this.getPath(t),await this.copyFile(e,t)?(this.log(`Move ${e} - ${t}`),await this.deleteFile(e)):(this.log(`Can't move ${e} - ${t}`),!1)}async erase(){async function e(t){for await(let[i,n]of t.entries())n.kind=="file"?await t.removeEntry(i):n.kind=="directory"&&(await e(n),await t.removeEntry(i,{recursive:!0}))}return await e(this.root),!0}async getSHA1(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=await global.crypto.subtle.digest("SHA-1",t);return global.Array.from(new global.Uint8Array(i)).map(a=>a.toString(16).padStart(2,"0")).join("")}};var Ae=class{type="InMemory";logDebug=!1;data={};log(...e){this.logDebug&&console.log(...e)}getPath(e){return e.startsWith("/")||(e="/"+e),e}async createFile(e){this.data[this.getPath(e)]={content:new Uint8Array,isDir:!1},this.log(`Created file [${e}]`)}async writeFile(e,t){e=this.getPath(e);let i;if(typeof t=="string")i=new TextEncoder().encode(t);else if(t instanceof Blob){let n=await t.arrayBuffer();i=new Uint8Array(n)}else if(t instanceof Uint8Array)i=t;else if(typeof t=="object")i=new TextEncoder().encode(JSON.stringify(t));else throw error("Unsupported data type");this.data[e]={content:i,isDir:!1},this.log(`Wrote to file [${e}]`)}async readFile(e){e=this.getPath(e);let t=this.data[e];if(!t||t.isDir)throw error(`File not found: ${e}`);return new global.TextDecoder().decode(t.content)}async readFileBytes(e){e=this.getPath(e);let t=this.data[e];if(!t||t.isDir)throw error(`File not found: ${e}`);return t.content}async readFileB64(e){e=this.getPath(e);let t=await this.readFileBytes(e);return global.btoa(global.String.fromCharCode.apply(null,t))}async loadImage(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=new global.Blob([t]),n=global.URL.createObjectURL(i);return new Promise((a,l)=>{let c=new global.Image;c.onload=()=>{global.URL.revokeObjectURL(n),a(c)},c.onerror=g=>{global.URL.revokeObjectURL(n),l(`Failed to load image: ${g}`)},c.src=n})}async loadImageAsDataURL(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=global.btoa(global.String.fromCharCode(...new global.Uint8Array(t)));return`data:${M.getMimeType(e)};base64,${i}`}async createDir(e){e=this.getPath(e),!await this.existsDir(e)&&(this.data[e]={content:new Uint8Array(0),isDir:!0},this.log(`Created directory [${e}]`))}async exists(e){return e=this.getPath(e),!!this.data[e]}async existsFile(e){e=this.getPath(e);let t=this.data[e];return!!(t&&!t.isDir)}async existsDir(e){e=this.getPath(e);let t=this.data[e];return!!(t&&t.isDir)}async isFile(e){e=this.getPath(e);let t=this.data[e];return!!(t&&!t.isDir)}async isDirectory(e){e=this.getPath(e);let t=this.data[e];return!!(t&&t.isDir)}async deleteFile(e){return e=this.getPath(e),await this.existsFile(e)?(delete this.data[e],this.log(`Deleted file [${e}]`),!0):(this.log(`Can't delete file [${e}] - not exists`),!1)}async deleteDirectory(e,t=!1){if(e=this.getPath(e),!await this.existsDir(e))return this.log(`Can't delete directory [${e}] - not exists`),!1;if(!t){for(let n in this.data)if(n!=e&&n.startsWith(e+"/"))return this.log(`Directory not empty: ${e}`),!1}let i=Object.keys(this.data).filter(n=>n==e||n.startsWith(e+"/"));for(let n of i)delete this.data[n];return this.log(`Deleted directory [${e}]`),!0}async listDir(e){if(e=this.getPath(e),!await this.existsDir(e))throw error(`Directory not found: ${e}`);let t=new Set;for(let i in this.data)if(i!=e&&i.startsWith(e+"/")){let n=i.substring(e.length+1),a=n.indexOf("/"),l=a==-1?n:n.substring(0,a);t.add(l)}return Array.from(t)}async rename(e,t){if(e=this.getPath(e),t=this.getPath(t),!await this.exists(e))return this.log(`Rename failed: source [${e}] does not exist`),!1;if(await this.exists(t))return this.log(`Rename failed: target [${t}] already exists`),!1;let i=await this.isDirectory(e),n=this.data[e];if(i){let a=Object.keys(this.data).filter(l=>l.startsWith(e+"/"));for(let l of a){let c=l.substring(e.length);this.data[t+c]=this.data[l],delete this.data[l]}}else this.data[t]=n,delete this.data[e];return this.log(`Renamed [${e}] \u2192 [${t}]`),!0}async copyFile(e,t){if(e=this.getPath(e),t=this.getPath(t),!await this.existsFile(e))return this.log(`Copy failed: source file [${e}] does not exist`),!1;if(await this.exists(t))return this.log(`Copy failed: target file [${t}] already exists`),!1;let i=this.data[e].content;return this.data[t]={content:i,isDir:!1},this.log(`Copied [${e}] \u2192 [${t}]`),!0}async move(e,t){return e=this.getPath(e),t=this.getPath(t),await this.copyFile(e,t)?(this.log(`Move ${e} - ${t}`),await this.deleteFile(e)):(this.log(`Can't move ${e} - ${t}`),!1)}async erase(){return this.data={},!0}async getSHA1(e){e=this.getPath(e);let t=await this.readFileBytes(e),i=await global.crypto.subtle.digest("SHA-1",t);return global.Array.from(new global.Uint8Array(i)).map(a=>a.toString(16).padStart(2,"0")).join("")}};var ve=class E{logDebug=!1;backend;type="OPFS";async init(e="auto",t){e=="auto"&&(e="InMemory","Indexeddb"in window&&(e="Indexeddb"),typeof navigator.storage<"u"&&(e="OPFS")),this.type=e,await this.changeBackend(e,t,!0),console.log("Filesystem initialized")}async changeBackend(e="InMemory",t,i=!1){let n=e.toLowerCase();if(!(this.type==e&&!i)){if(n=="opfs"){if(location.protocol=="file:")throw new Error("OPFS doesn't work on protocol file://");(!t||!(t instanceof FileSystemDirectoryHandle))&&(t=await navigator.storage.getDirectory()),this.backend=new Se(t)}else if(n=="indexeddb"){let a=new Re(typeof t=="string"?t:"BafiaOnline");await a.init(),this.backend=a}else if(n=="inmemory")this.backend=new Ae;else throw new Error("No backend");this.type=e,console.log("FS Type: "+e),this.backend.logDebug=!1}}static async get(e="InMemory",t){return await new E().init(e,t)}getMimeType(e){let t=e.toLowerCase().split(".").pop()||"";return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",webp:"image/webp",svg:"image/svg+xml",ico:"image/x-icon",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",m4a:"audio/mp4",mp4:"video/mp4",webm:"video/webm",mov:"video/quicktime",txt:"text/plain",html:"text/html",htm:"text/html",css:"text/css",js:"application/javascript",json:"application/json",xml:"application/xml",pdf:"application/pdf",zip:"application/zip",rar:"application/x-rar-compressed","7z":"application/x-7z-compressed",tar:"application/x-tar",gz:"application/gzip",bin:"application/octet-stream",exe:"application/octet-stream",dll:"application/octet-stream"}[t]||"application/octet-stream"}createFile(e){return this.backend.createFile(e)}writeFile(e,t){return this.backend.writeFile(e,t)}readFile(e){return this.backend.readFile(e)}readFileBytes(e){return this.backend.readFileBytes(e)}readFileB64(e){return this.backend.readFileB64(e)}createDir(e){return this.backend.createDir(e)}existsDir(e){return this.backend.existsDir(e)}existsFile(e){return this.backend.existsFile(e)}exists(e){return this.backend.exists(e)}isFile(e){return this.backend.isFile(e)}isDirectory(e){return this.backend.isDirectory(e)}deleteFile(e){return this.backend.deleteFile(e)}deleteDirectory(e,t){return this.backend.deleteDirectory(e,t)}listDir(e){return this.backend.listDir(e)}rename(e,t){return this.backend.rename(e,t)}copyFile(e,t){return this.backend.copyFile(e,t)}move(e,t){return this.backend.move(e,t)}loadImage(e){return this.backend.loadImage(e)}loadImageAsDataURL(e){return this.backend.loadImageAsDataURL(e)}erase(){return this.backend.erase()}getSHA1(e){return this.backend.getSHA1(e)}},M=new ve;var nt={ACCEPTED:"a",ACCEPT_MESSAGES:"ac",ACTIVE:"ac",ACTIVITY:"ac",ADD_CLIENT_TO_CHAT:"acc",ADD_CLIENT_TO_DASHBOARD:"acd",ADD_CLIENT_TO_FRIENDSHIP_LIST:"acfl",ADD_CLIENT_TO_PRIVATE_CHAT:"acpc",ADD_CLIENT_TO_ROOMS_LIST:"acrl",ADD_FRIEND:"af",ADD:"add",ADD_PLAYER:"ap",ADMIN_BLOCK_USER:"abu",ADMIN_CONTROL_USER:"acu",ADMIN:"adm",ADMIN_KICK_USER:"aku",ADMIN_UNBLOCK_USER:"auu",AFFECTED_BY_ROLES:"abr",ALIVE:"a",APP_LANGUAGE:"alc",ASPIRIN:"a",BACKPACK:"bp",BILLING_APP_PACKAGE:"bapckg",BILLING_PRODUCT_ID:"bpid",BILLING_PURCHASE_PENDING:"bppndng",BILLING_PURCHASE_TOKEN:"bptkn",BLOCKED_USERS:"bus",BLOCK_DEVICE:"bdv",BLOCK_IP:"bi",BONUSES_ENABLED:"bns",BONUS_PRICE:"bp",BRIBE:"b",BUY_BILLING_MARKET_ITEM:"mrktgg",BUY_BILLING_MARKET_SUCCESS_ITEM:"bbmrktis",BUY_MARKET_ITEM:"bmrkti",BUY_MARKET_ITEM_SUCCESS:"bmrktis",CHAT_MESSAGE_CREATE:"cmc",CHECK_PLAYER_IS_IN_ROOM:"cpir",CIVILIAN_ALIVE:"c",CIVILIAN_ALL:"ca",CLEAN_VOTES_HISTORY:"cv",CLOUD_MESSAGING_TOKEN_IS_SAVED:"cmts",COMPLAINTS:"cmps",COMPLAINT:"cmp",CONDOM:"cm",CONFESSION:"cn",CONNECTION_CHECKER_PERIOD:"ccp",CONNECTION_INACTIVE_TIMEOUT:"cit",CREATED:"c",CREATE_PLAYER:"cp",CREATOR_BLOCKED:"crb",DATA:"data",DAYTIME:"d",DESCRIPTION:"dsc",DEVICE_ID:"d",EMAIL:"e",EMAIL_NOT_VERIFIED:"env",EMAIL_NOT_VERIFIED_MESSAGE_CREATE_TIMEOUT:"envmct",ERROR_FLOOD_DETECTED:"erfd",ERROR:"e",ERROR_OCCUR:"ero",EXPERIENCE:"ex",FILE:"f",FIRST_AID_KIT:"f",FIRST_NAME:"fn",FRIENDSHIP_FLAG:"fpf",FRIENDSHIP:"fp",FRIENDSHIP_LIST:"frl",FRIENDSHIP_LIST_LIMIT:"fll",FRIENDSHIP_LIST_LIMIT_FOR_VIP:"fllfv",FRIENDSHIP_REQUESTS:"fr",FRIENDS_IN_INVITE_LIST:"fiil",FRIEND_IN_ROOM:"fir",FRIEND_IS_INVITED:"fiinvtd",FRIEND:"ff",FRIEND_USER_OBJECT_ID:"f",GAME_DAYTIME:"gd",GAME_FINISHED:"gf",GAME_STARTED:"gsd",GAME_STATUS_IN_ROOMS_LIST:"gsrl",GAME_STATUS:"gs",GET_BLOCKED_USERS:"gbus",GET_COMPLAINTS:"gcmps",GET_FRIENDS_IN_INVITE_LIST:"gfiil",GET_PLAYERS:"gp",GET_RATING:"gr",GET_SENT_FRIEND_REQUESTS_LIST:"gsfrl",GET_USER_PROFILE:"gup",GET_MATCH_MAKING_USERS_IN_QUEUE_INTERVAL:"mmguiabk",GIVE_UP:"agu",GIFT_MARKET_ITEMS:"gmrkti",GOLD:"g",GOOGLE_SIGN_IN:"gsin",GOOGLE_TOKEN:"gt",GOOGLE_USER_ID:"gui",HIS_FRIENDSHIP_LIST_FULL:"hflf",INFO_MESSAGE:"imsg",INVITATION_SENDER_USERNAME:"isun",IP_ADDRESS:"ip",IS_BILLING_ITEM:"ibi",IS_DAY_ACTION_USED:"idau",IS_INVITED:"iinvtd",IS_NIGHT_ACTION_ALTERNATIVE:"inaa",IS_NIGHT_ACTION_USED:"inau",IS_ONLINE:"on",ITEM_PRICE_TEXT:"iprct",KICK_TIMER:"kt",KICK_USER_AUTHORITY_LESS_THAN_USER:"kualtu",KICK_USER_GAME_STARTED:"kugs",KICK_USER:"ku",KICK_USER_NOT_IN_ROOM:"kunir",KICK_USER_OBJECT_ID:"k",KICK_USER_PRICE:"kup",KICK_USER_RANK:"kur",KICK_USER_STARTED:"kus",KICK_USER_VOTE:"kuv",LAST_NAME:"ln",LEVEL:"l",LIE_DETECTOR:"l",MAFIA_ALIVE:"m",MAFIA_ALL:"ma",MAKE_COMPLAINT:"mc",MATCH_MAKING_MATCH_STATUS:"mmms",MATCH_MAKING_BASE_PLAYERS_AMOUNT:"mmbpa",MATCH_MAKING_GET_STATUS:"mmgsk",MATH_MAKING_ADD_USER:"mmauk",MARKET_ITEMS:"mrkti",MAXIMUM_PLAYERS:"mxmp",MAX_PLAYERS:"mxp",MESSAGES:"ms",MESSAGE:"m",MESSAGE_STYLE:"mstl",MESSAGE_TYPE:"t",MESSAGE_STICKER:"mstk",MIN_LEVEL:"mnl",MIN_PLAYERS:"mnp",MONEY:"mo",NEW_CLOUD_MESSAGING_TOKEN:"ncmt",NEW_MESSAGES:"nm",NEXT_LEVEL_EXPERIENCE:"nle",NOT_ENOUGH_AUTHORITY_ERROR:"neae",NO_CHANGES:"noch",NUM:"n",NUM_MAFIA:"m",NUM_PLAYERS:"p",OBJECT_ID:"o",PASSWORD:"pw",PHOTO:"ph",PLAYED_GAMES:"pg",PLAYERS_IN_ROOM:"pin",PLAYERS:"pls",PLAYERS_NUM:"pn",PLAYERS_STAT:"ps",PLAYER:"p",PLAYER_ROLE_STATISTICS:"prst",PREVIOUS_LEVEL_EXPERIENCE:"ple",PRICE_USERNAME_SET:"pus",PRIVATE_CHAT_MESSAGE_CREATE:"pmc",RANKS:"r",RATING:"rtg",RATING_MODE:"rmd",RATING_TYPE:"rt",RATING_USERS_LIST:"rul",RATING_VALUE:"rv",REASON:"r",REMOVE_COMPLAINT:"rcmp",REMOVE_FRIEND:"rf",REMOVE_INVITATION_TO_ROOM:"ritr",REMOVE:"rm",REMOVE_MESSAGES:"rmm",REMOVE_PHOTO:"rph",REMOVE_PLAYER:"rp",REMOVE_USER:"rmu",ROLES:"roles",ROLE_ACTION:"ra",ROLE:"r",ROOMS:"rs",ROOM_CREATED:"rcd",ROOM_CREATE:"rc",ROOM_ENTER:"re",ROOM_MODEL_TYPE:"rmt",ROOM_STATISTICS:"rst",ROOM_IN_LOBBY_STATE:"rils",ROOM:"rr",ROOM_MESSAGE_CREATE:"rmc",ROOM_OBJECT_ID:"ro",ROOM_PASSWORD_IS_WRONG_ERROR:"rpiw",ROOM_PASS:"psw",ROOM_STATUS:"rs",SCORE:"sc",SCREENSHOT:"sc",SEARCH_TEXT:"st",SEARCH_USER:"su",SELECTED_ROLES:"sr",SEND_FRIEND_INVITE_TO_ROOM:"sfitr",SERVER_CONFIG:"scfg",SERVER_LANGUAGE_CHANGE_TIME:"slct",SERVER_LANGUAGE:"slc",SERVER_ROOM_TITLE_MINIMAL_LEVEL:"srtml",SERVER_ROOM_PASSWORD_MINIMAL_LEVEL:"srpml",SET_ROOM_PASSWORD_MIN_AUTHORITY:"srpma",SET_PROFILE_PHOTO_MINIMAL_LEVEL:"sppml",SET_SERVER_LANGUAGE_TIME_ERROR:"sslte",SEX:"s",SHOW_PASSWORD_ROOM_INFO_BUTTON:"sprib",SIGN_IN_ERROR:"siner",SIGN_IN:"sin",SIGN_OUT_USER:"soutu",STATUS:"s",TEAM:"t",TEXT:"tx",TIMER:"t",TIME:"t",TIME_SEC_REMAINING:"tsr",TIME_UNTIL:"tu",TITLE:"tt",TOKEN:"t",TYPE_ERROR:"err",TYPE:"ty",UPDATED:"up",UPLOAD_PHOTO:"upp",UPLOAD_SCREENSHOT:"ups",USED_LAST_MESSAGE:"um",USERNAME_HAS_WRONG_SYMBOLS:"unws",USERNAME_IS_EMPTY:"unie",USERNAME_IS_EXISTS:"unex",USERNAME_IS_OUT_OF_BOUNDS:"unob",USERNAME:"u",USERNAME_SET:"uns",USERNAME_TRANSLIT:"ut",USERS:"u",USER_BLOCKED:"ublk",USER_CHANGE_SEX:"ucs",USER_DASHBOARD:"uud",USER_DATA:"ud",USER_INACTIVE_BLOCKED:"uib",USER_IN_ANOTHER_ROOM:"uiar",USER_IN_A_ROOM:"uir",USER_IS_NOT_VIP:"uinv",USER_IS_NOT_VIP_TO_INVITE_FRIENDS_IN_ROOM:"uinvtifr",USER:"uu",USER_KICKED:"ukd",USER_LEVEL_NOT_ENOUGH:"ulne",USER_NOT_IN_A_ROOM:"unir",USER_OBJECT_ID:"uo",USER_PROFILE:"uup",USER_RANK_FOR_KICK:"ur",USER_RANK:"r",USER_RECEIVER:"ur",USER_ROLE_ERROR:"ure",USER_SENDER:"us",USER_SENDER_OBJECT_ID:"uso",USER_SET_SERVER_LANGUAGE:"usls",USER_SET_USERNAME_ERROR:"ueue",USER_ENERGY:"ue",USER_SIGN_IN:"usi",USER_USING_DOUBLE_ACCOUNT:"uuda",VEST:"v",VIP_ENABLED:"venb",VIP:"v",VIP_ACCOUNT:"vip_account",VIP_UPDATED:"vupd",VOTES:"v",VOTE:"v",WHO_WON:"w",WINS_AS_KILLER:"wik",WINS_AS_MAFIA:"wim",WINS_AS_PEACEFUL:"wip",WRONG_FILE_SIZE:"wfs",WRONG_FILE_TYPE:"wft",YOUR_FRIENDSHIP_LIST_FULL:"yflf",ID:"i",MATCH_MAKING_SCORE:"mmscr",MATCH_MAKING_ADD_USER:"mmauk",MATCH_MAKING_REMOVE_USER:"mmruk",MATCH_MAKING_LIST_KEY:"mmblk",MATCH_MAKING_USER_IN_ROOM:"mmuir",MATCH_MAKING_BUCKET_RESPONSE_PLAYERS_AMOUNT:"mmbpa",VOTE_PLAYER_LIST:"vpl",PRIVATE_CHAT_LIST_MESSAGES:"pclms",PROFILE_USER_DATA:"pud",USER_ACCOUNT_COINS:"uac",SILVER_COINS:"scns",GOLD_COINS:"gcns",DECORATIONS:"dcrs",SAME_ROOM:"isr",BLOCKED_USER_INFO:"bui",DECORATION_ID:"did",DECORATION_TYPE:"dt",DECORAION_PARARAMETER:"dp",USER_CURRENET_ENERGY_AMOUNT:"ucea",USER_MAX_FREE_ENERGY_AMOUNT:"umfea",USER_ENERGY_AMOUNT_FIRST_TIMER:"ueaft",USER_ENERGY_AMOUNT_NEXT_TIMERS:"ueant",CREATOR_OBJECT_ID:"rco",VIP_REMANING_MILLISECONDS:"vrms",DASHBOARD_USER:"du",BACKPACK_SIZE:"bps",BACKPACK_VIP_SIZE:"bpsv",AVAILABLE_DECORATIONS:"bids",ACTIVATED_DECORATIONS:"aids",BACKPACK_ITEM_ID:"bio",WHO_BLOCKED_USER_ID:"wbuo",IS_USER_ID_MATCHED:"iuoim",IS_DEVICE_ID_MATHED:"idim",IS_IP_ADDRESS_MATCHED:"iipam",ACTIVATED_ITEM_OBJECT_ID:"aio",ITEM_EXPIRE_AFTER:"iea",MARKET_PRODUCT_ID:"mpid",MARKET_OFFER_COIN_TYPE:"moct",MARKET_OFFER_PRICE:"mop",MARKET_OFFER_DURATION:"mod",MARKET_COINS_AMOUNT:"mca",MARKET_COIN_TYPE:"mct",PAYMENT_URL:"puk",ITEM_PRISE_TESXT:"iprct",BILLING_PURCHASE_ACCOUNT_ID:"bpaid",MARKET_ITEM_DECORATION:"mid",MARKET_ITEM_OFFERS:"mio",PHOTO_FILENAME:"ph",MARKET_ITEM_DECORATIONS:"mids",MARKET_BILLING_ITEM:"mbi",MARKET_VIP_ITEMS:"mivs",MARKET_SILVER_COIN_ITEMS:"misc",MARKET_OFFER_ID:"moid",SELECTED_PARAMETERS_IDS:"dp",CACHE_KEY:"cchk",USER_DEFAULT_PHOTOS_IDS:"usdphi",IS_MATCH_MAKING_ENABLED:"is_match_making_enabled",IS_BACKPACK_ENABLED:"is_backpack_enabled",MATCH_MAKING_MINIMUM_LEVEL:"match_making_minimum_level",PUBLIC_CHAT_MINIMUM_LEVEL:"public_chat_minimum_level",PLAYERS_DATA:"data",VERSION_CODE:"vc",MATCH_MAKING_FINDED_USERS_NUMBER:"mmfun",PRIVATE_CHAT_LAST_MESSAGE:"pclm",USER_GET_DEFAULT_PHOTOS:"usgdph",USER_DEFAULT_PHOTOS:"usdph",DASHBOARD:"db",BACKPACK_GET:"bpg",MARKET_BILLING_TYPE:"mbt",MARKET_GET:"mrktg",MARKET:"mr",BUY_BILLING_VIP_ITEM:"bbvi",BUY_SILVER_COINS_ITEM:"bsci",BUY_DECORATION:"bd",BUY_DECORATION_REQUEST:"bdr",MATCH_MAKING_ADD_GAME:"mmag",MATCH_MAKING_USER_ADD_GAME:"mmcuag",MATCH_MAKING_USER_SELECT_ROLE:"mmusr",MATCH_MAKING_COUNT_USER_SELECTED_ROLES:"mmcusr",MATCH_MAKING_ROOM:"mmrr",MATCH_MAKING_ROLES_COUNT:"mmrc",NEED_MINIMUM_LEVEL_CHAT:"nelfpc",NEED_MINIMUM_LEVEL_MM:"nelfmm",USER_CHANGE_EMAIL:"uche"},s=nt;async function X(E){if(!E)return o.resources.unknownChat;let e=E[s.PHOTO],t=E[s.OBJECT_ID];if(o.resources[`avatars_${t}`])return o.resources[`avatars_${t}`];let i=async()=>{let l=await rt(e);return o.resources[`avatars_${t}`]=l,l},n=`https://dottap.com/mafia/profile_photo/${t}.jpg`;return new Promise(l=>{let c=new Image,g=!1;c.onload=()=>{g=!0,o.resources[`avatars_${t}`]=n,l(n)},c.onerror=async()=>{g||(g=!0,l(await i()))},c.src=n,setTimeout(async()=>{g||(g=!0,l(await i()))},1e4)})}async function rt(E=""){return o.resources[`defaultAvatars_${E}`]?o.resources[`defaultAvatars_${E}`]:(o.resources[`defaultAvatars_${E}`]=await M.loadImageAsDataURL(`${o.config.path}/assets/textures/logo/avatar.jpg`),o.resources[`defaultAvatars_${E}`])}async function K(E){return o.resources[`role_${E}`]?o.resources[`role_${E}`]:(o.resources[`role_${E}`]=await M.loadImageAsDataURL(`${o.config.path}/assets/textures/roles/${E}.png`),o.resources[`role_${E}`])}async function H(E){return o.resources[`background_${E}`]?o.resources[`background_${E}`]:(o.resources[`background_${E}`]=await M.loadImageAsDataURL(`${o.config.path}/assets/textures/backgrounds/${E}.png`),o.resources[`background_${E}`])}async function ee(E){return o.resources["assets/textures/"+E]?o.resources["assets/textures/"+E]:(o.resources["assets/textures/"+E]=await M.loadImageAsDataURL(`${o.config.path}/assets/textures/${E}`),o.resources["assets/textures/"+E])}var le=class extends F{constructor(t){super("Loading");this.title=t;o.title="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430",(async()=>this.element.style.background=`url(${await H("menu3")}) 0% 0% / cover`)();let i=document.createElement("div");i.className="header",this.element.appendChild(i);let n=document.createElement("label");n.innerHTML="\u0411\u0430\u0444\u0438\u044F \u043E\u043D\u043B\u0430\u0439\u043D",i.appendChild(n);let a=document.createElement("div");a.style.textAlign="center",this.element.appendChild(a);let l=document.createElement("p");l.innerHTML=t,a.appendChild(l),ie(this,"title",c=>l.innerHTML=c),(async()=>(this.loadingElem=document.createElement("img"),this.loadingElem.src=await ee("loading/2f.png"),a.appendChild(this.loadingElem)))()}loadingElem;rotation=0;tick(t){t%2<1||(this.loadingElem&&(this.loadingElem.style.transform=`rotateZ(${this.rotation%360}deg)`),this.rotation+=30)}};var Z={CIVILIAN:1,DOCTOR:2,SHERIFF:3,MAFIA:4,LOVER:5,TERRORIST:6,JOURNALIST:7,BODYGUARD:8,BARMAN:9,SPY:10,INFORMER:11},Be=["","\u041E\u0432\u043E\u0449","\u0414\u043E\u043A\u0442\u043E\u0440","\u0428\u0435\u0440\u0438\u0444","\u041C\u0430\u0444\u0438\u044F","\u041B\u044E\u0431\u043E\u0432\u043D\u0438\u0446\u0430","\u0422\u0435\u0440\u0440\u043E\u0440\u0438\u0441\u0442","\u0416\u0443\u0440\u043D\u0430\u043B\u0438\u0441\u0442","\u0422\u0435\u043B\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435\u043B\u044C","\u0411\u0430\u0440\u043C\u0435\u043D","\u0428\u043F\u0438\u043E\u043D","\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0442\u043E\u0440"];var ce=class{username="User";objectId="";token="";bToken="";serverLanguage="";status=0;level=0;experience=0;nextLevelExperience=0;previousLevelExperience=0;isOnline=!0;matchMakingScore=0;photo="";playedGames=0;playerRoleStatistics={[Z.CIVILIAN]:0,[Z.DOCTOR]:0,[Z.SHERIFF]:0,[Z.MAFIA]:0,[Z.LOVER]:0,[Z.TERRORIST]:0,[Z.JOURNALIST]:0,[Z.BODYGUARD]:0,[Z.BARMAN]:0,[Z.SPY]:0,[Z.INFORMER]:0};updated=0;userRank=0;vipUpdated=0;vip=!1;winsAsKiller=0;winsAsMafia=0;winsAsPeaceful=0;goldCoins=0;sliverCoins=0;update(e){this.objectId=e[s.OBJECT_ID],this.username=e[s.USERNAME],this.photo=e[s.PHOTO],this.status=e[s.STATUS],this.token=e[s.TOKEN],this.experience=e[s.EXPERIENCE],this.nextLevelExperience=e[s.NEXT_LEVEL_EXPERIENCE],this.previousLevelExperience=e[s.PREVIOUS_LEVEL_EXPERIENCE],this.level=e[s.LEVEL],this.userRank=e[s.USER_RANK],this.playedGames=e[s.PLAYED_GAMES],this.playerRoleStatistics=e[s.PLAYER_ROLE_STATISTICS],this.serverLanguage=e[s.SERVER_LANGUAGE],this.updated=e[s.UPDATED],this.vip=!!e[s.VIP],this.winsAsKiller=e[s.WINS_AS_KILLER],this.winsAsMafia=e[s.WINS_AS_MAFIA],this.winsAsPeaceful=e[s.WINS_AS_PEACEFUL]}};function q(){return window.navigator.maxTouchPoints||"ontouchstart"in document}var se=class extends F{constructor(){super("Auth"),o.title="\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F",(async()=>this.element.style.background=`url(${await H("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("label");t.textContent="\u0411\u0430\u0444\u0438\u044F \u043E\u043D\u043B\u0430\u0439\u043D",e.appendChild(t);let i=document.createElement("div");i.style.textAlign="center",i.style.padding="10px",this.element.appendChild(i);let n=document.createElement("h3");n.textContent="\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F",i.appendChild(n);let a=document.createElement("input");a.placeholder="e-mail \u0438\u043B\u0438 \u043D\u0438\u043A",i.appendChild(a),i.appendChild(document.createElement("br"));let l=document.createElement("input");l.placeholder="\u041F\u0430\u0440\u043E\u043B\u044C",l.style.marginTop="5px",i.appendChild(l),i.appendChild(document.createElement("br"));let c=document.createElement("p");c.textContent="\u0438\u043B\u0438",c.style.margin="5px",i.appendChild(c);let g=document.createElement("input");g.placeholder="\u0422\u043E\u043A\u0435\u043D",i.appendChild(g),i.appendChild(document.createElement("br"));let h=document.createElement("input");h.placeholder="ID \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",h.style.marginTop="5px",i.appendChild(h),i.appendChild(document.createElement("br")),i.appendChild(document.createElement("br"));let p=document.createElement("button");p.textContent="\u0412\u043E\u0439\u0442\u0438",p.addEventListener("click",async()=>{await o.server.auth.auth({email:a.value,password:l.value,token:g.value,userId:h.value})}),i.appendChild(p);let y=document.createElement("button");y.textContent="\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F",y.disabled=!0,i.appendChild(y);let f=document.createElement("p");if(f.innerHTML=`
\u041C\u044B \u043D\u0435 \u0441\u043E\u0431\u0438\u0440\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u043E\u0432.<br/>
\u041D\u0430\u0448 \u0438\u0441\u0445\u043E\u0434\u043D\u044B\u0439 \u043A\u043E\u0434 \u043E\u0442\u043A\u0440\u044B\u0442 <a href="https://github.com/lumik0/bafiaonline">Github</a><br/>
<br/>
\u042D\u0442\u043E \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F: \u043F\u043E\u0441\u043B\u0435 \u0437\u0430\u043A\u0440\u044B\u0442\u0438\u044F \u0438\u0433\u0440\u044B \u043F\u0440\u0438\u0434\u0451\u0442\u0441\u044F \u0432\u043E\u0439\u0442\u0438 \u0441\u043D\u043E\u0432\u0430<br/>
\u0427\u0442\u043E\u0431\u044B \u044D\u0442\u043E\u0433\u043E \u0438\u0437\u0431\u0435\u0436\u0430\u0442\u044C, \u0441\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043F\u0440\u043E\u0444\u0438\u043B\u044C \u0432 \u043B\u0430\u0443\u043D\u0447\u0435\u0440\u0435 \u2014 \u0443 \u043D\u0435\u0433\u043E \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438\u0439 \u0432\u0445\u043E\u0434 \u0435\u0441\u0442\u044C<br/>
<br/>
\u0415\u0441\u043B\u0438 \u0432\u0430\u043C \u043D\u0443\u0436\u043D\u043E \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C\u0441\u044F, \u0442\u043E \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u043B\u0430\u0443\u043D\u0447\u0435\u0440\u0435 \u043B\u0438\u0431\u043E \u0432 \u041C\u0430\u0444\u0438\u0438 \u043E\u043D\u043B\u0430\u0439\u043D \u0441 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430
`,i.appendChild(f),q()){let R=document.createElement("button");R.textContent="\u0417\u0430\u043A\u0440\u044B\u0442\u044C \u0438\u0433\u0440\u0443",R.addEventListener("click",()=>o.win.close()),i.appendChild(R)}}};var Y=class extends J{constructor(t={},i=document.createElement("div")){super();this.element=i;let n=this;this.id=o.boxs.length,o.boxs.push(this),o.screen.element.style.pointerEvents="none",this.element.style.transition=".2s",this.element.style.width=t.width??"300px",this.element.style.height=t.height??"150px",this.element.style.position="absolute",this.element.style.top="50%",this.element.style.left="50%",this.element.style.opacity="0",this.element.style.transform="translate(-50%, -45%)",this.background=document.createElement("div"),this.background.style.background="black",this.background.style.position="fixed",this.background.style.transition="opacity .5s",this.background.style.opacity="0",this.background.style.width="100%",this.background.style.height="100%",this.background.style.left="0",this.background.style.top="0",o.element.appendChild(this.background);let a=document.createElement("div");a.style.background="#D1343C",a.style.width="100%",a.style.borderRadius="10px",this.element.appendChild(a);let l=document.createElement("div");l.style.width="100%",l.style.height="35px",l.style.display="flex",l.style.justifyContent="center",l.style.alignItems="center",l.textContent=t.title??"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F",a.appendChild(l);let c=document.createElement("div");c.style.width="100%",c.style.height="100%",c.style.display="flex",c.style.justifyContent="center",a.appendChild(c),this.content=document.createElement("div"),this.content.style.background="#B4AEAC",this.content.style.margin="0 5px 5px 5px",this.content.style.width="100%",this.content.style.height=t.height?parseInt(t.height.replace("px",""))-40+"px":"calc(150px - 40px)",this.content.style.borderRadius="10px",c.appendChild(this.content),o.element.appendChild(this.element),t.canCloseAnywhere&&this.background.addEventListener("click",g=>{n.close()}),$(50).then(()=>{this.background.style.opacity=".6",this.element.style.transform="translate(-50%, -50%)",this.element.style.opacity="1"}),this.loop=o.on("tick",g=>this.emit("tick",g))}content;background;loop;id=-1;async close(){(await this.call("close",{isCancelled:!1})).isCancelled||(this.background.style.opacity="0",this.element.style.transform="translate(-50%, -55%)",this.element.style.opacity="0",$(200).then(()=>this.destroy()))}destroy(){this.emit("destroy"),o.boxs.splice(this.id,1),o.boxs.length==0&&(o.screen.element.style.pointerEvents="all");try{o.element.removeChild(this.element)}catch{}try{o.element.removeChild(this.background)}catch{}this.element.remove(),this.background.remove()}};async function N(E,e={}){let t=new Y({title:e.title,height:e.height}),i=document.createElement("div");i.innerHTML=E.replaceAll(`
`,"<br/>"),i.style.color="black",i.style.textAlign="center",i.style.padding="15px 5px",t.content.appendChild(i);let n=document.createElement("div");n.style.width="100%",n.style.position="absolute",n.style.bottom="15px",n.style.display="flex",n.style.justifyContent="center",n.style.left="0",t.content.appendChild(n);let a=document.createElement("button");return a.textContent=e.btnText??"OK",a.style.width="80%",a.addEventListener("click",()=>t.close()),n.appendChild(a),await t.wait("destroy")}async function He(E,e={}){let t=new Y({title:e.title,height:e.height??"175px"}),i=document.createElement("div");i.innerHTML=E.replaceAll(`
`,"<br/>"),i.style.color="black",i.style.textAlign="center",i.style.padding="15px 5px",t.content.appendChild(i);let n=document.createElement("div");n.style.width="100%",n.style.position="absolute",n.style.bottom="15px",n.style.display="flex",n.style.justifyContent="column",n.style.flexDirection="column",n.style.alignItems="center",n.style.left="0",t.content.appendChild(n);let a=document.createElement("input");a.style.width="80%",a.style.marginBottom="10px",a.placeholder=e.placeholder??"",n.appendChild(a);let l=document.createElement("button");return l.textContent=e.btnText??"OK",l.style.width="80%",l.addEventListener("click",()=>t.close()),n.appendChild(l),a.focus(),await t.wait("destroy"),a.value}function re(E,e){if(document.selection){E.focus();let t=document.selection.createRange();t.text=e,E.focus()}else if(E.selectionStart||E.selectionStart===0){let t=E.selectionStart,i=E.selectionEnd,n=E.scrollTop;E.value=E.value.substring(0,t)+e+E.value.substring(i,E.value.length),E.focus(),E.selectionStart=t+e.length,E.selectionEnd=t+e.length,E.scrollTop=n}else E.value+=e,E.focus()}function me(E){return[4,9,6,11].includes(E)}var te=class extends F{constructor(t,i={}){super("Room");this.roomObjectId=t;this.options=i;typeof i.sendRoomEnter!="boolean"&&(i.sendRoomEnter=!0),o.title="\u041A\u043E\u043C\u043D\u0430\u0442\u0430",this.oldAppSettingsData=JSON.parse(JSON.stringify(o.settings.data)),(async()=>this.element.style.background=`url(${await H("day3")}) 0% 0% / cover`)(),this.headerElem=document.createElement("div"),this.headerElem.className="header",this.element.appendChild(this.headerElem);let n=document.createElement("button");n.className="back",n.textContent="<",n.onclick=()=>this.emit("back"),this.headerElem.appendChild(n),this.titleElem=document.createElement("label"),this.titleElem.textContent="",this.titleElem.style.width="300px",this.titleElem.style.userSelect="text",this.headerElem.appendChild(this.titleElem),this.loadingDivElem=document.createElement("div"),this.loadingDivElem.style.display="flex",this.loadingDivElem.style.justifyContent="center",this.loadingDivElem.style.margin="15px",this.element.appendChild(this.loadingDivElem),this.loadingElem=document.createElement("img"),this.loadingElem.style.textAlign="center",ee("loading/2f.png").then(a=>this.loadingElem.src=a),this.loadingDivElem.appendChild(this.loadingElem),this.on("back",()=>{o.screen=new G}),this.init()}headerElem;loadingDivElem;loadingElem;rotation=0;titleElem;gameInfoElem;playersListElem;rangeZoomElem;gamePlayersListElem;resizablePLElem;messagesElem;infoElem;input;meElem;yourRoleElem;deadImgElem;myVoteElem;affectedByRolesElem;localAffectedByRoles=[];clearMessages=!0;modelType=0;title="\u041A\u043E\u043C\u043D\u0430\u0442\u0430";maxPlayers=8;minPlayers=1;minLevel=1;isVipEnabled=!1;selectedRoles=[];status=0;get isGame(){return this.status==2}gameDayTime=0;timer=0;playersStat;oldAppSettingsData;usersWaiting=[];playersData={};players=[];joinLeaveMessages={};lastMessage;tick(t){t%2<1||(this.loadingElem&&(this.loadingElem.style.transform=`rotateZ(${this.rotation%360}deg)`),this.rotation+=30)}async init(){this.options.sendRoomEnter&&o.server.send(s.ROOM_ENTER,{[s.ROOM_PASS]:this.options.password,[s.ROOM_OBJECT_ID]:this.roomObjectId});let t=await o.server.awaitPacket([s.ROOM_ENTER,s.ROOM_PASSWORD_IS_WRONG_ERROR,s.GAME_STARTED,s.USER_IN_ANOTHER_ROOM,s.USER_USING_DOUBLE_ACCOUNT,s.USER_LEVEL_NOT_ENOUGH,s.USER_KICKED,s.ROOM_CREATED],2e3);if(t[s.TYPE]==s.ROOM_PASSWORD_IS_WRONG_ERROR){o.screen=new G,N("\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043F\u0430\u0440\u043E\u043B\u044C!");return}else if(t[s.TYPE]==s.GAME_STARTED){o.screen=new G,N("\u0418\u0433\u0440\u0430 \u0443\u0436\u0435 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C");return}else if(t[s.TYPE]==s.USER_IN_ANOTHER_ROOM){o.screen=new G,N("\u041D\u0435\u043B\u044C\u0437\u044F \u0437\u0430\u0439\u0442\u0438");return}else if(t[s.TYPE]==s.USER_USING_DOUBLE_ACCOUNT){o.screen=new G,N(`\u0412 \u0434\u0430\u043D\u043D\u043E\u0439 \u043A\u043E\u043C\u043D\u0430\u0442\u0435 \u0443\u0436\u0435 \u0435\u0441\u0442\u044C \u0438\u0433\u0440\u043E\u043A, \u043A\u043E\u0442\u043E\u0440\u044B\u0439 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D \u043A \u0442\u043E\u043C\u0443 \u0436\u0435 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044E, \u0447\u0442\u043E \u0438 \u0432\u044B

\u0412\u0435\u0440\u043E\u044F\u0442\u043D\u043E \u0432\u044B \u0438 \u044D\u0442\u043E\u0442 \u0438\u0433\u0440\u043E\u043A \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0435 \u043E\u0431\u0449\u0443\u044E \u0442\u043E\u0447\u043A\u0443 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0441\u0435\u0442\u0438 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442

\u0415\u0441\u043B\u0438 \u0432\u044B \u0445\u043E\u0442\u0438\u0442\u0435 \u0438\u0433\u0440\u0430\u0442\u044C \u0441 \u0434\u0430\u043D\u043D\u044B\u043C \u0438\u0433\u0440\u043E\u043A\u043E\u043C \u0432 \u043E\u0434\u043D\u043E\u0439 \u043A\u043E\u043C\u043D\u0430\u0442\u0435 - \u0441\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043A\u043E\u043C\u043D\u0430\u0442\u0443 \u0441 \u043F\u0430\u0440\u043E\u043B\u0435\u043C \u0438\u043B\u0438 \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044C, \u0447\u0442\u043E \u0432\u044B \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043A\u0430\u0436\u0434\u044B\u0439 \u043A \u0441\u0432\u043E\u0435\u0439 \u0442\u043E\u0447\u043A\u0435 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u0438\u043B\u0438 \u043C\u043E\u0431\u0438\u043B\u044C\u043D\u044B\u043C \u0434\u0430\u043D\u043D\u044B\u043C`,{height:"360px"});return}else if(t[s.TYPE]==s.USER_LEVEL_NOT_ENOUGH){o.screen=new G,N("\u0412\u0430\u0448 \u0443\u0440\u043E\u0432\u0435\u043D\u044C \u043C\u0430\u043B\u0435\u043D\u044C\u043A\u0438\u0439");return}else if(t[s.TYPE]==s.USER_KICKED){o.screen=new G,N("\u0412\u0430\u0441 \u0432\u044B\u0433\u043D\u0430\u043B\u0438");return}let i=t[s.ROOM];this.roomObjectId=i[s.OBJECT_ID],this.modelType=i[s.ROOM_MODEL_TYPE],this.title=i[s.TITLE],this.maxPlayers=i[s.MAX_PLAYERS],this.minPlayers=i[s.MIN_PLAYERS],this.minLevel=i[s.MIN_LEVEL],this.isVipEnabled=i[s.VIP_ENABLED],this.selectedRoles=i[s.SELECTED_ROLES],this.status=i[s.STATUS],this.gameDayTime=i[s.DAYTIME],o.server.send(s.CREATE_PLAYER,{[s.USER_OBJECT_ID]:o.user.objectId,[s.TOKEN]:o.user.token,[s.ROOM_OBJECT_ID]:this.roomObjectId,[s.ROOM_MODEL_TYPE]:0});let n=await o.server.awaitPacket(s.ROOM_STATISTICS);this.loadingDivElem.remove(),this.on("message",p=>{if(p[s.TYPE]==s.MESSAGE)this.addMessage(p[s.MESSAGE]);else if(p[s.TYPE]==s.USERS&&!this.isGame)this.updatePlayersWaiting(p[s.USERS]);else if(p[s.TYPE]==s.ADD_PLAYER&&!this.isGame)this.players.push(p[s.PLAYER]),this.updatePlayersWaiting(this.players);else if(p[s.TYPE]==s.REMOVE_PLAYER&&!this.isGame)this.players.splice(this.players.findIndex(y=>y[s.USER][s.USER_OBJECT_ID]==p[s.USER_OBJECT_ID]),1),this.updatePlayersWaiting(this.players);else if(typeof p[s.TIMER]=="number"&&!this.isGame)this.infoElem.textContent=w(`\u0418\u0433\u0440\u0430 \u043D\u0430\u0447\u043D\u0451\u0442\u0441\u044F \u0447\u0435\u0440\u0435\u0437 ${p[s.TIMER]}`);else if(p[s.TYPE]==s.PLAYERS_STAT)this.playersStat=p;else if(p[s.TYPE]==s.ROOM_STATISTICS){if(p[s.ROOM_STATISTICS][s.PLAYERS]){let y=0;for(let f of p[s.ROOM_STATISTICS][s.PLAYERS]){let R=f[s.USER],I=R[s.OBJECT_ID],T=R[s.USERNAME];this.playersData[I]||(this.playersData[I]={}),this.playersData[I].index=y,this.playersData[I].username=T,y++}}if(p[s.ROOM_STATISTICS][s.PLAYERS_DATA]){for(let y of p[s.ROOM_STATISTICS][s.PLAYERS_DATA]){let f=y[s.USER_OBJECT_ID];this.playersData[f]||(this.playersData[f]={}),this.playersData[f].affectedByRoles=y[s.AFFECTED_BY_ROLES],typeof y[s.ALIVE]=="boolean"&&(this.playersData[f].alive=y[s.ALIVE]),this.playersData[f].isDayActionUsed=y[s.IS_DAY_ACTION_USED],this.playersData[f].isNightActionAlternative=y[s.IS_NIGHT_ACTION_ALTERNATIVE],this.playersData[f].isNightActionUsed=y[s.IS_NIGHT_ACTION_USED],typeof y[s.ROLE]=="number"&&(this.playersData[f].role=y[s.ROLE]),typeof y[s.VOTE]=="number"&&(this.playersData[f].vote=y[s.VOTE]),this.playersData[f].userObjectId=f}this.updatePlayersGame()}if(this.status=p[s.ROOM_STATISTICS][s.GAME_STATUS][s.STATUS],this.timer=p[s.ROOM_STATISTICS][s.GAME_STATUS][s.TIMER],this.isGame){this.clearMessages&&(this.lastMessage={},this.messagesElem.innerHTML="");for(let y of p[s.ROOM_STATISTICS][s.MESSAGES])this.addMessage(y,!1);this.initGame(),this.status==3&&this.updatePlayersGame()}}else if(p[s.TYPE]==s.ROLES){for(let y of p[s.ROLES]){let f=y[s.USER_OBJECT_ID],R=y[s.ROLE];this.playersData[f]?this.playersData[f].role=R:this.playersData[f]={role:R}}this.updatePlayersGame()}});let a=document.createElement("div");a.style.display="flex",a.style.width="100%",a.style.marginRight="10px",a.style.flexDirection="row-reverse",a.style.alignItems="center";for(let p of this.selectedRoles){let y=document.createElement("img");y.src=await K(p),y.width=25,y.height=35,y.onmousedown=f=>f.preventDefault(),a.appendChild(y)}this.headerElem.appendChild(a),o.title=`\u041A\u043E\u043C\u043D\u0430\u0442\u0430: ${this.title}`,this.titleElem.innerHTML=w(this.title),this.infoElem=document.createElement("div"),this.infoElem.style.textAlign="center",this.infoElem.style.color="black",this.infoElem.style.margin="5px 0",this.infoElem.innerHTML="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043A\u043E\u043C\u043D\u0430\u0442\u044B..",this.element.appendChild(this.infoElem),this.playersListElem=document.createElement("div"),this.playersListElem.style.overflow="overlay",this.playersListElem.style.margin="5px 1px",this.playersListElem.style.outline="2px solid #c0c0c0",this.playersListElem.style.borderRadius="3px",this.playersListElem.style.background="rgba(255,255,255,.5)",this.element.appendChild(this.playersListElem);let l=document.createElement("div");l.style.width="100%";let c=!1;this.rangeZoomElem=document.createElement("input"),this.rangeZoomElem.style.display="none",this.rangeZoomElem.style.width="100%",this.rangeZoomElem.type="range",this.rangeZoomElem.min="25",this.rangeZoomElem.max="50",this.rangeZoomElem.value=this.oldAppSettingsData.game.zoomPL*25+"",this.rangeZoomElem.onmousedown=()=>c=!0,this.rangeZoomElem.onmouseup=()=>c=!1,this.rangeZoomElem.onmousemove=()=>{if(!c)return;let p=parseInt(this.rangeZoomElem.value)/25;o.settings.data.game.zoomPL=p,this.gamePlayersListElem.style.zoom=p+""},l.appendChild(this.rangeZoomElem),this.playersListElem.appendChild(l),this.gamePlayersListElem=document.createElement("div"),this.gamePlayersListElem.style.height="155px",this.gamePlayersListElem.style.display="flex",this.gamePlayersListElem.style.flexWrap="wrap",this.gamePlayersListElem.style.flexDirection="column",this.gamePlayersListElem.style.zoom="1",this.playersListElem.appendChild(this.gamePlayersListElem),this.resizablePLElem=document.createElement("div"),this.resizablePLElem.style.margin="2px",this.resizablePLElem.style.cursor="e-resize",this.resizablePLElem.style.float="right",this.resizablePLElem.style.width="5px",this.resizablePLElem.style.display="none",this.resizablePLElem.onmousedown=p=>{let y=this.playersListElem,f=Q(),R=p.clientX/f,I=y.clientWidth,T=5;function A(b){let P=b.clientX/f,k=I;k=Math.max(T,I-(P-R)),b.stopPropagation?.(),b.preventDefault?.(),y.style.width=k+"px"}function D(b){console.log("updated"),o.settings.data.game.widthPL=parseInt(y.style.width.replace("px","")),document.removeEventListener("mousemove",A,!0),document.removeEventListener("mouseup",D,!0),b.stopPropagation?.()}document.addEventListener("mousemove",A,!0),document.addEventListener("mouseup",D,!0),p.stopPropagation?.(),p.preventDefault?.()},this.element.appendChild(this.resizablePLElem),this.gameInfoElem=document.createElement("div"),this.gameInfoElem.style.height="125px",this.gameInfoElem.style.margin="5px 10px",this.gameInfoElem.style.outline="2px solid #c0c0c0",this.gameInfoElem.style.borderRadius="3px",this.gameInfoElem.style.background="rgba(255,255,255,.5)",this.gameInfoElem.style.display="none",this.element.appendChild(this.gameInfoElem),this.messagesElem=document.createElement("div"),this.messagesElem.style.height=o.height-265+"px",this.messagesElem.style.textAlign="center",this.messagesElem.style.overflowX="hidden",this.messagesElem.style.overflowY="overlay",this.messagesElem.style.margin="10px",this.messagesElem.style.outline="2px solid #c0c0c0",this.messagesElem.style.borderRadius="3px",this.messagesElem.style.background="rgba(255,255,255,.5)",this.messagesElem.style.display="flex",this.messagesElem.style.flexDirection="column",this.messagesElem.style.justifyContent="flexEnd",this.element.appendChild(this.messagesElem);let g=n[s.ROOM_STATISTICS];for(let p of g[s.MESSAGES])this.addMessage(p,!1);if(this.players=g[s.PLAYERS],this.titleElem.textContent=`${this.title} (${this.players.length}/${this.maxPlayers})`,g[s.GAME_STATUS]){if(this.infoElem.innerHTML="\u0417\u0430\u043F\u0443\u0441\u043A \u0438\u0433\u0440\u044B..",this.status=g[s.GAME_STATUS][s.STATUS],this.gameDayTime=g[s.GAME_STATUS][s.DAYTIME],this.timer=g[s.GAME_STATUS][s.TIMER],g[s.PLAYERS_DATA]){let p=0;for(let y of g[s.PLAYERS_DATA])this.playersData[y[s.USER_OBJECT_ID]]={index:p,alive:y[s.ALIVE],affectedByRoles:y[s.AFFECTED_BY_ROLES],isDayActionUsed:y[s.IS_DAY_ACTION_USED],isNightActionAlternative:y[s.IS_NIGHT_ACTION_ALTERNATIVE],isNightActionUsed:y[s.IS_NIGHT_ACTION_USED],userObjectId:y[s.USER_OBJECT_ID],role:y[s.ROLE],vote:y[s.VOTE]},p++}if(g[s.PLAYERS])for(let p of g[s.PLAYERS]){let y=p[s.USER],f=y[s.OBJECT_ID],R=y[s.USERNAME];this.playersData[f]||(this.playersData[f]={}),this.playersData[f].username=R}}else this.infoElem.innerHTML="\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F",this.updatePlayersWaiting(g[s.PLAYERS]);let h=document.createElement("div");h.style.position="absolute",h.style.width="100%",h.style.bottom="2px",this.element.appendChild(h),this.input=document.createElement("input"),this.input.className="input-chat",this.input.type="text",this.input.placeholder="\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435",this.input.addEventListener("keydown",p=>{if(p.key=="Enter"&&this.input.value!=""){let y=this.input.value;this.input.value="",this.sendMessage(y)}}),q()&&(this.input.addEventListener("focus",()=>{this.messagesElem.scrollTop=this.messagesElem.scrollHeight}),this.input.addEventListener("blur",()=>{})),this.on("keydown",p=>p.key=="Enter"&&this.input.focus()),h.appendChild(this.input),this.on("resize",()=>{this.messagesElem.style.height=o.height-265+"px"}).key("waiting"),this.isGame&&this.initGame(),this.messagesElem.scrollTop=this.messagesElem.scrollHeight}async initGame(){this.element.removeChild(this.infoElem),this.removeByKey("waiting"),this.playersListElem.style.float="right",this.playersListElem.style.flexFlow="column wrap",this.playersListElem.style.overflowX="hidden",this.playersListElem.style.overflowY="overlay",this.playersListElem.style.width=(q()?115:this.oldAppSettingsData.game.widthPL)+"px",this.playersListElem.style.height=o.height-80+"px",this.gamePlayersListElem.style.flexDirection="row",this.gamePlayersListElem.style.alignContent="flex-start",this.gamePlayersListElem.style.justifyContent="center",this.gamePlayersListElem.style.zoom=this.oldAppSettingsData.game.zoomPL+"",this.gamePlayersListElem.innerHTML="",q()||(this.rangeZoomElem.style.display="block"),this.resizablePLElem.style.display="block",this.resizablePLElem.style.height=o.height-80+"px",this.messagesElem.style.height=o.height-215+"px",this.changeDayTime(),this.on("resize",()=>{this.playersListElem.style.height=o.height-80+"px",this.resizablePLElem.style.height=o.height-80+"px",this.messagesElem.style.height=o.height-215+"px"});let t=`\u0412\u044B<br/>${Be[this.playersData[o.user.objectId].role??0]}`,i,n,a,l;{this.gameInfoElem.style.display="flex";{let c=document.createElement("span"),g=document.createElement("img");this.deadImgElem=document.createElement("img"),this.deadImgElem.src=await ee("roles/dead.png"),this.deadImgElem.width=50,this.deadImgElem.height=70,this.deadImgElem.style.display="none",this.deadImgElem.style.position="absolute",this.deadImgElem.style.top="56px",this.deadImgElem.onmousedown=h=>h.preventDefault(),this.myVoteElem=document.createElement("div"),this.myVoteElem.style.background="red",this.myVoteElem.style.color="white",this.myVoteElem.style.padding="3px",this.myVoteElem.style.position="absolute",this.myVoteElem.style.right="5px",this.myVoteElem.style.bottom="20px",this.myVoteElem.style.borderRadius="3px",this.myVoteElem.style.display="none",this.affectedByRolesElem=document.createElement("div"),this.affectedByRolesElem.style.width="125px",this.affectedByRolesElem.style.height="100%",this.affectedByRolesElem.style.marginLeft="5px",this.affectedByRolesElem.style.display="flex",this.affectedByRolesElem.style.alignItems="center",this.affectedByRolesElem.style.justifyContent="flex-start",this.affectedByRolesElem.style.flexWrap="wrap",this.affectedByRolesElem.style.alignContent="center",this.meElem=document.createElement("div"),this.meElem.style.position="relative",this.meElem.style.display="flex",this.meElem.style.flexDirection="column",this.meElem.style.justifyContent="center",this.meElem.style.alignItems="center",this.meElem.style.padding="0 5px",this.yourRoleElem=document.createElement("span"),this.yourRoleElem.innerHTML=t,this.yourRoleElem.style.fontSize="smaller",this.yourRoleElem.style.textAlign="center",this.yourRoleElem.style.color="black",this.yourRoleElem.style.padding="1px",c.textContent=w(o.user.username),c.style.fontSize="smaller",c.style.textAlign="center",c.style.color="black",c.style.padding="1px",g.src=await K(this.playersData[o.user.objectId].role??1),g.width=50,g.height=70,g.onmousedown=h=>h.preventDefault(),this.meElem.appendChild(this.yourRoleElem),this.meElem.appendChild(g),this.meElem.appendChild(this.deadImgElem),this.meElem.appendChild(this.myVoteElem),this.meElem.appendChild(c),this.gameInfoElem.appendChild(this.meElem),this.gameInfoElem.appendChild(this.affectedByRolesElem)}{let c=this.playersStat??{},g=document.createElement("div");g.style.display="flex",g.style.alignItems="flex-end",g.style.flexDirection="column",g.style.padding="8px",g.style.width="100%",n=document.createElement("div"),n.textContent=w(`\u041C\u0430\u0444\u0438\u044F: ${c[s.MAFIA_ALL]} | ${c[s.MAFIA_ALIVE]}`),n.style.color="#7D080E",a=document.createElement("div"),a.textContent=w(`\u041C\u0438\u0440\u043D\u044B\u0435: ${c[s.CIVILIAN_ALL]} | ${c[s.CIVILIAN_ALIVE]}`),a.style.color="#22640A",i=document.createElement("div"),i.textContent=w(this.timer+""),i.style.color="black",i.style.float="right",i.style.fontSize="35px",i.style.fontWeight="bold",i.style.marginTop="15px",i.style.padding="5px",l=document.createElement("button"),l.textContent="\u0421\u0434\u0430\u0442\u044C\u0441\u044F",l.style.marginTop="-5px",l.style.display="none";{let h=this.playersData[o.user.objectId].role??1;this.playersData[o.user.objectId].alive&&(c[s.MAFIA_ALIVE]==1&&me(h)||c[s.CIVILIAN_ALIVE]==1&&!me(h))&&(i.style.marginTop="0",l.style.display="block")}l.onclick=()=>o.server.send(s.GIVE_UP,{[s.ROOM_OBJECT_ID]:this.roomObjectId}),g.appendChild(n),g.appendChild(a),g.appendChild(i),g.appendChild(l),this.gameInfoElem.appendChild(g)}}this.playersData[o.user.objectId].alive||(this.deadImgElem.style.top=this.yourRoleElem.clientHeight+1+"px",this.deadImgElem.style.display="flex"),this.on("message",c=>{if(this.isGame){if(c[s.TYPE]==s.GAME_DAYTIME)this.gameDayTime=c[s.DAYTIME],i.textContent=w(c[s.TIMER]),this.changeDayTime(),this.updatePlayersGame();else if(typeof c[s.TIMER]=="number")this.timer=c[s.TIMER],i.textContent=w(c[s.TIMER]);else if(c[s.TYPE]==s.PLAYERS_STAT){n.textContent=w(`\u041C\u0430\u0444\u0438\u044F: ${c[s.MAFIA_ALL]} | ${c[s.MAFIA_ALIVE]}`),a.textContent=w(`\u041C\u0438\u0440\u043D\u044B\u0435: ${c[s.CIVILIAN_ALL]} | ${c[s.CIVILIAN_ALIVE]}`);let g=this.playersData[o.user.objectId].role??1;this.playersData[o.user.objectId].alive&&(c[s.MAFIA_ALIVE]==1&&me(g)||c[s.CIVILIAN_ALIVE]==1&&!me(g))&&(l.style.display="block",i.style.marginTop="0")}else if(c[s.TYPE]==s.USER_DATA){for(let g in c[s.PLAYERS_DATA]){let h=c[s.PLAYERS_DATA][g],p=h[s.USER_OBJECT_ID];h[s.AFFECTED_BY_ROLES]&&(this.playersData[p].affectedByRoles=h[s.AFFECTED_BY_ROLES]),typeof h[s.ALIVE]=="boolean"&&(this.playersData[p].alive=h[s.ALIVE]),typeof h[s.IS_DAY_ACTION_USED]=="boolean"&&(this.playersData[p].isDayActionUsed=h[s.IS_DAY_ACTION_USED]),typeof h[s.IS_NIGHT_ACTION_ALTERNATIVE]=="boolean"&&(this.playersData[p].isNightActionAlternative=h[s.IS_NIGHT_ACTION_ALTERNATIVE]),typeof h[s.IS_NIGHT_ACTION_USED]=="boolean"&&(this.playersData[p].isNightActionUsed=h[s.IS_NIGHT_ACTION_USED]),typeof h[s.ROLE]=="number"&&(this.playersData[p].role=h[s.ROLE]),typeof h[s.VOTE]=="number"&&(this.playersData[p].vote=h[s.VOTE]),c[s.PLAYERS_DATA].length==1&&p!=o.user.objectId&&typeof h[s.VOTE]!="number"&&(this.playersData[p].vote=(this.playersData[p].vote??0)+1)}this.updatePlayersGame()}}}),this.updatePlayersGame()}async changeDayTime(){this.gameDayTime<2?(this.element.style.background=`url(${await H("night")}) 0% 0% / cover`,this.playersListElem.style.outline="2px solid rgb(128 128 128)",this.playersListElem.style.background="rgb(255 255 255 / 50%)",this.gameInfoElem.style.outline="2px solid rgb(128 128 128)",this.gameInfoElem.style.background="rgb(255 255 255 / 50%)",this.messagesElem.style.outline="2px solid rgb(128 128 128)",this.messagesElem.style.background="rgb(255 255 255 / 50%)"):(this.element.style.background=`url(${await H("day3")}) 0% 0% / cover`,this.playersListElem.style.outline="2px solid #c0c0c0",this.playersListElem.style.background="rgba(255,255,255,.5)",this.gameInfoElem.style.outline="2px solid #c0c0c0",this.gameInfoElem.style.background="rgba(255,255,255,.5)",this.messagesElem.style.outline="2px solid #c0c0c0",this.messagesElem.style.background="rgba(255,255,255,.5)")}updatePlayersGame(){this.gamePlayersListElem.innerHTML="";let t=Object.entries(this.playersData).sort(([,i],[,n])=>(i.index??0)-(n.index??0));for(let[i,n]of t){if(o.user.objectId==n.userObjectId){if(this.deadImgElem&&this.deadImgElem.style.display=="none"&&this.yourRoleElem&&n.alive==!1&&(this.deadImgElem.style.top=this.yourRoleElem.clientHeight+1+"px",this.deadImgElem.style.display="flex",N("\u0412\u044B \u0443\u043C\u0435\u0440\u043B\u0438")),this.myVoteElem&&(typeof this.playersData[i].vote=="number"&&this.playersData[i].vote>0?(this.myVoteElem.style.display="block",this.myVoteElem.textContent=w(this.playersData[i].vote+"")):this.myVoteElem.style.display="none"),this.affectedByRolesElem){let y=this.playersData[i].affectedByRoles??[];if(!(this.localAffectedByRoles.length==y.length&&this.localAffectedByRoles.every((R,I)=>R==y[I]))){this.localAffectedByRoles=y,this.affectedByRolesElem.innerHTML="";for(let R of y){let I=document.createElement("img");K(R).then(T=>I.src=T),I.width=28,I.height=40,I.style.opacity="0",I.style.animation="1s opacity linear alternate infinite",I.style.margin="1px",I.onmousedown=T=>T.preventDefault(),this.affectedByRolesElem.appendChild(I)}}}continue}let a=this.playersData[i].username??"?",l=document.createElement("div"),c=document.createElement("img"),g=document.createElement("div");if(g.textContent=w(a),g.style.color="black",g.style.wordBreak="break-all",g.style.textAlign="center",g.style.fontSize="12px",g.style.marginTop="-2px",l.style.margin="2px",l.style.width="50px",l.style.textAlign="center",l.style.position="relative",l.style.height="100px",K(n.role??0).then(y=>c.src=y),c.width=50,c.height=70,c.onmousedown=y=>y.preventDefault(),l.appendChild(c),!n.alive){let y=document.createElement("img");ee("roles/dead.png").then(f=>y.src=f),y.width=50,y.height=70,y.style.position="absolute",y.style.left="0",y.onmousedown=f=>f.preventDefault(),y.onclick=()=>this.addNickToInput(a),l.appendChild(y)}if(typeof this.playersData[i].vote=="number"&&this.playersData[i].vote>0){let y=this.playersData[i].vote,f=document.createElement("div");f.style.background="red",f.style.color="white",f.style.padding="3px",f.style.position="absolute",f.style.right="0",f.style.bottom="30px",f.style.borderRadius="3px",f.textContent=w(y+""),l.appendChild(f)}let h="",p=this.gameDayTime<2?this.playersData[o.user.objectId].isNightActionUsed:this.playersData[o.user.objectId].isDayActionUsed;if(Ie(this.playersData[o.user.objectId].role).case(2,()=>this.gameDayTime==1&&void(h="_2")).case(3,()=>this.gameDayTime==1&&void(h="check",this.playersData[i].affectedByRoles?.includes(3)&&(h=""))).case(4,()=>this.gameDayTime==1&&void(h="kill",me(this.playersData[i].role??1)&&(h=""))).case(5,()=>this.gameDayTime==0&&void(h="_5")).case(6,()=>this.gameDayTime==3&&void(h="_6")).case(7,()=>this.gameDayTime==1&&void(this.playersData[i].affectedByRoles?.includes(7)||(h="_7"))).case(8,()=>this.gameDayTime==2&&void(h="_8",p||(p=!0))).case(9,()=>this.gameDayTime==1&&void(h="_9")).case(11,()=>this.gameDayTime==1&&void(h="check",this.playersData[i].affectedByRoles?.includes(11)&&(h=""))),h==""&&this.gameDayTime==3&&(h="kill"),this.gameDayTime==1&&this.playersData[o.user.objectId].affectedByRoles?.includes(9)&&p&&(p=!0),h!=""&&this.status!=3&&!p&&this.playersData[o.user.objectId].alive&&this.playersData[i].alive){let y=document.createElement("img");ee(`roles/${h}.png`).then(f=>y.src=f),y.width=50,y.height=70,y.style.position="absolute",y.style.left="0",y.style.transform="scale(0)",y.style.animation=".7s zoom-in-zoom-out alternate infinite",y.style.animationDelay=".3s",y.onmousedown=f=>f.preventDefault(),y.onclick=c.onclick=()=>{o.server.send(s.ROLE_ACTION,{[s.USER_OBJECT_ID]:i,[s.ROOM_OBJECT_ID]:this.roomObjectId,[s.ROOM_MODEL_TYPE]:this.modelType}),this.updatePlayersGame()},l.appendChild(y)}else c.onclick=()=>this.addNickToInput(a);l.appendChild(g),this.gamePlayersListElem.appendChild(l)}}addMessage(t,i=!1){let n=t[s.TEXT],a=t[s.MESSAGE_TYPE],l=t[s.MESSAGE_STICKER],c=t[s.USER];if(c||a==10||a==25||a==26){let g=c?c[s.USERNAME]:a==25||a==26?"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0442\u043E\u0440":a==10?"\u041C\u0430\u0444\u0438\u044F":"???",h=n,p="black";if(a==9||a==13||a==26?(h=`\u0413\u043E\u043B\u043E\u0441\u0443\u0435\u0442 \u0437\u0430 [${n}]`,p="#22640A"):a==11?p="#ABABAB":a==17?p="#1D3E67":a==18?(h=`\u0412\u0417\u041E\u0420\u0412\u0410\u041B \u0438\u0433\u0440\u043E\u043A\u0430 [${n}]`,p="#7D080E"):a==21?(h=`\u0412\u0417\u041E\u0420\u0412\u0410\u041B \u0438\u0433\u0440\u043E\u043A\u0430 [${n}], \u043D\u043E \u0438\u0433\u0440\u043E\u043A \u0431\u044B\u043B \u043F\u043E\u0434 \u0437\u0430\u0449\u0438\u0442\u043E\u0439 \u0442\u0435\u043B\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435\u043B\u044F \u0438 \u043E\u0441\u0442\u0430\u043B\u0441\u044F \u0436\u0438\u0432!`,p="#7D080E"):a==27&&(h="\u0421\u0434\u0430\u043B\u0441\u044F",p="#7D080E"),this.lastMessage&&this.lastMessage.divM&&this.lastMessage.username==g){let y=document.createElement("span");y.textContent=w(h),y.style.color=p,y.style.userSelect="text",this.lastMessage.divM.appendChild(y)}else{let y=document.createElement("div"),f=document.createElement("img"),R=document.createElement("div"),I=document.createElement("span"),T=document.createElement("span");X(c).then(A=>f.src=A),f.onerror=()=>console.error(`\u0418\u0433\u0440\u043E\u043A ${g} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0430\u0432\u0430\u0442\u0430\u0440\u043A\u0443 - ${c[s.PHOTO]}`),f.style.borderRadius="100%",f.width=35,f.height=35,f.style.margin="5px",f.onmousedown=A=>A.preventDefault(),f.onclick=()=>W(c[s.OBJECT_ID]),I.textContent=w(g),I.style.color=a==17?"#1D3E67":a==11?"#ABABAB":"black",I.onclick=()=>this.addNickToInput(g),T.textContent=w(h),T.style.color=p,T.style.userSelect="text",R.style.display="flex",R.style.flexDirection="column",R.style.justifyContent="center",R.style.wordBreak="auto-phrase",y.style.display="flex",y.style.textAlign="left",y.appendChild(f),y.appendChild(R),R.appendChild(I),R.appendChild(T),this.messagesElem.appendChild(y),this.lastMessage={username:g,divM:R}}}else{let g=document.createElement("div"),h=n,p="black";a==2?(h=`\u0418\u0433\u0440\u043E\u043A ${n} \u0432\u043E\u0448\u0451\u043B`,p="#22640A"):a==3?(h=`\u0418\u0433\u0440\u043E\u043A ${n} \u0432\u044B\u0448\u0435\u043B`,p="#7D080E"):a==4?h="\u0418\u0433\u0440\u0430 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C":a==5?(h="\u041D\u0430\u0441\u0442\u0443\u043F\u0438\u043B\u0430 \u043D\u043E\u0447\u044C [\u041C\u0410\u0424\u0418\u042F \u0432 \u0447\u0430\u0442\u0435]",p="#1D3E67"):a==6?(h="[\u041C\u0410\u0424\u0418\u042F \u0432\u044B\u0431\u0438\u0440\u0430\u0435\u0442 \u0436\u0435\u0440\u0442\u0432\u0443]",p="#1D3E67"):a==7?(h="\u041D\u0430\u0441\u0442\u0443\u043F\u0438\u043B \u0434\u0435\u043D\u044C [\u0412\u0441\u0435 \u043E\u0431\u0449\u0430\u044E\u0442\u0441\u044F \u0432 \u0447\u0430\u0442\u0435]",p="#BA843E"):a==8?(h="[\u0412\u0441\u0435 \u0433\u043E\u043B\u043E\u0441\u0443\u044E\u0442] \u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0433\u0440\u043E\u043A\u0430, \u043A\u043E\u0442\u043E\u0440\u043E\u0433\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u043A\u0430\u0437\u043D\u0438\u0442\u044C",p="#BA843E"):a==12?(h=`\u0418\u0433\u0440\u043E\u043A [${n}] \u0423\u0411\u0418\u0422!`,p="#7D080E"):a==14?(h="\u0412\u0421\u0415 \u043E\u0441\u0442\u0430\u043B\u0438\u0441\u044C \u0436\u0438\u0432\u044B. \u041D\u0438\u043A\u043E\u0433\u043E \u043D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0431\u0438\u0442\u044C!",p="#22640A"):a==15?(h="\u0418\u0433\u0440\u0430 \u043E\u043A\u043E\u043D\u0447\u0435\u043D\u0430! \u041C\u0418\u0420\u041D\u042B\u0415 \u0416\u0418\u0422\u0415\u041B\u0418 \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0438!",p="#22640A"):a==16?(h="\u0418\u0433\u0440\u0430 \u043E\u043A\u043E\u043D\u0447\u0435\u043D\u0430! \u041C\u0410\u0424\u0418\u042F \u043F\u043E\u0431\u0435\u0434\u0438\u043B\u0430!",p="#22640A"):a==19?(h=`\u0421\u0420\u041E\u0427\u041D\u0410\u042F \u041D\u041E\u0412\u041E\u0421\u0422\u042C!
\u0416\u0443\u0440\u043D\u0430\u043B\u0438\u0441\u0442 \u043F\u0440\u043E\u0432\u0435\u043B \u0440\u0430\u0441\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u043D\u0438\u0435 \u0438 \u043A\u0430\u043A \u043E\u043A\u0430\u0437\u0430\u043B\u043E\u0441\u044C \u0438\u0433\u0440\u043E\u043A\u0438 [${n.split("#")[0]}] \u0438 [${n.split("#")[2]}] \u0438\u0433\u0440\u0430\u044E\u0442 \u0432 \u043E\u0434\u043D\u043E\u0439 \u043A\u043E\u043C\u0430\u043D\u0434\u0435`,p="#7D080E"):a==20?(h=`\u0421\u0420\u041E\u0427\u041D\u0410\u042F \u041D\u041E\u0412\u041E\u0421\u0422\u042C!
\u0416\u0443\u0440\u043D\u0430\u043B\u0438\u0441\u0442 \u043F\u0440\u043E\u0432\u0435\u043B \u0440\u0430\u0441\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u043D\u0438\u0435 \u0438 \u043A\u0430\u043A \u043E\u043A\u0430\u0437\u0430\u043B\u043E\u0441\u044C \u0438\u0433\u0440\u043E\u043A\u0438 [${n.split("#")[0]}] \u0438 [${n.split("#")[2]}] \u0438\u0433\u0440\u0430\u044E\u0442 \u0432 \u0440\u0430\u0437\u043D\u044B\u0445 \u043A\u043E\u043C\u0430\u043D\u0434\u0430\u0445`,p="#7D080E"):a==22?h="\u043D\u0438\u0447\u044C\u044F":a==23?h=`\u043A\u0438\u043A\u0430\u0435\u0442 \u0447\u0435\u043B\u0430 ${n}`:a==24&&(h=`\u0433\u0441 \u0437\u0430\u043A\u043E\u043D\u0447\u0438\u043B\u043E\u0441\u044C \u043A\u0438\u043A ${n}`),g.innerHTML=w(h).replaceAll(`
`,"<br/>"),g.style.color=p,g.style.userSelect="text",g.style.margin="3px",this.messagesElem.appendChild(g),this.lastMessage={},(a==2||a==3)&&(this.joinLeaveMessages[n]&&this.messagesElem.removeChild(this.joinLeaveMessages[n]),this.joinLeaveMessages[n]=g)}this.messagesElem.scrollHeight-o.height-this.messagesElem.scrollTop<75&&this.messagesElem.scroll({top:this.messagesElem.scrollHeight,behavior:"smooth"}),i&&this.messagesElem.firstElementChild&&this.messagesElem.removeChild(this.messagesElem.firstElementChild)}addNickToInput(t){let i=document.activeElement==this.input;if(this.input.value.includes(`[${t}]`)){let n=this.input.value.indexOf(`[${t}]`);this.input.value.lastIndexOf(`[${t}]`)==0?this.input.value=this.input.value.replace(`[${t}] `,""):this.input.value.substring(0,n).endsWith(" ")?this.input.value=this.input.value.replace(` [${t}] `,""):this.input.value=this.input.value.replace(`[${t}]`,"")}else[""," "].includes(this.input.value.substring((this.input.selectionStart??1)-1))?re(this.input,`[${t}] `):re(this.input,` [${t}] `);q()&&!i&&this.input.blur()}sendMessage(t,i={}){if(t.startsWith("!")){let n="?!&@#%^~<>*";t=Array.from({length:[...t].length-1},()=>n[Math.random()*n.length|0]).join("")}o.server.send(s.ROOM_MESSAGE_CREATE,{[s.MESSAGE]:{[s.MESSAGE_STYLE]:i.messageStyle??0,[s.MESSAGE_STICKER]:i.messageSticker??!1,[s.TEXT]:t},[s.ROOM_OBJECT_ID]:this.roomObjectId,[s.ROOM_MODEL_TYPE]:this.modelType})}updatePlayersWaiting(t){this.usersWaiting=t.map(i=>i[s.USER][s.OBJECT_ID]),this.titleElem.textContent=`${this.title} (${t.length}/${this.maxPlayers})`,this.gamePlayersListElem.innerHTML="";for(let i=0;i<t.length;i++){let a=t[i][s.USER],l=document.createElement("div"),c=document.createElement("img"),g=document.createElement("span");X(a).then(h=>c.src=h),c.style.borderRadius="100%",c.width=c.height=25,c.style.margin="5px",c.onmousedown=h=>h.preventDefault(),c.onclick=()=>W(a[s.OBJECT_ID]),g.textContent=w(a[s.USERNAME]),g.style.color="black",g.onclick=()=>this.addNickToInput(a[s.USERNAME]),l.style.display="flex",l.style.textAlign="left",l.style.alignItems="center",l.appendChild(c),l.appendChild(g),this.gamePlayersListElem.appendChild(l)}}destroy(){o.server.send(s.REMOVE_PLAYER,{[s.ROOM_OBJECT_ID]:this.roomObjectId}),super.destroy()}};function ot(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=crypto.getRandomValues(new Uint8Array(1))[0]%16;return(e==="x"?t:t&3|8).toString(16)})}var de=class extends J{constructor(t=ot()){super();this.uuid=t;this.id=o.components.length,o.components.push(this),this.elem=document.createElement("div"),o.element.appendChild(this.elem),$(50).then(()=>{o.on("resize",i=>this.emit("resize",i)).key(`component_${t}`),o.on("keydown",i=>this.emit("keydown",i)).key(`component_${t}`),o.on("keyup",i=>this.emit("keyup",i)).key(`component_${t}`),o.on("click",i=>this.emit("click",i)).key(`component_${t}`),o.on("contextmenu",i=>this.emit("contextmenu",i)).key(`component_${t}`),o.server.on("message",i=>this.emit("message",i)).key(`component_${t}`)})}id;elem;destroy(){this.emit("destroy"),this.removeAllEvents(),o.removeByKey(`component_${this.uuid}`),o.server.removeByKey(`component_${this.uuid}`),o.components.splice(this.id,1),o.element.removeChild(this.elem),this.elem.remove()}};var Ee=class extends de{constructor(t=[],i){super();this.menu=t;this.event=i;let n=Q(),a=o.zoom,l=document.createElement("div");l.style.position="fixed",l.style.display="flex",l.style.flexDirection="column",l.style.left=i.pageX/a/n+"px",l.style.top=i.pageY/a/n+"px";for(let c=0;c<t.length;c++){let g=t[c],h=document.createElement("button");h.style.borderRadius=c==0?"7px 7px 0 0":c==t.length-1?"0 0 7px 7px":"0",h.textContent=g,h.onclick=()=>this.result=g,l.appendChild(h)}this.elem.appendChild(l),this.on("click",async()=>{await $(0),this.destroy()}),this.on("contextmenu",async()=>{await $(0),this.destroy()})}result;waitForResult(){return new Promise(async(t,i)=>{await this.wait("destroy"),t(this.result)})}};function $e(E={}){let e=new Y({title:E.title??"\u0417\u0410\u0413\u0420\u0423\u0417\u041A\u0410",canCloseAnywhere:E.canCloseAnywhere||!1,height:"175px"}),t=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.padding="15px 0 0 0",t.style.position="absolute",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.left="0",e.content.appendChild(t);let i=document.createElement("img");M.loadImageAsDataURL(`${o.config.path}/assets/textures/loading/Tx.png`).then(l=>i.src=l),t.appendChild(i);let n=document.createElement("p");n.style.color="black",n.textContent=E.text??"",t.appendChild(n);let a=0;return e.on("tick",l=>{l%2<1||(i.style.transform=`rotateZ(${a%360}deg)`,a+=30)}),{box:e,changeText(l){n.textContent=l},done(){e.close()}}}var Ye=it(Ke());function he(E,e="azxsw",t=5){let i=E;for(let n=0;n<t;n++)i=(0,Ye.default)(i+e);return i}var ue=class extends F{data;constructor(){super("RoomCreation"),o.title="\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u043A\u043E\u043C\u043D\u0430\u0442\u044B",(async()=>this.element.style.background=`url(${await H("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("button");t.className="back",t.textContent="<",t.onclick=()=>this.emit("back"),e.appendChild(t);let i=document.createElement("label");i.textContent="\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u043A\u043E\u043C\u043D\u0430\u0442\u044B",e.appendChild(i),this.on("back",()=>{o.screen=new G}),this.data=o.settings.data.roomCreate,this.init()}createRoom(e){o.server.send(s.ROOM_CREATE,{[s.TOKEN]:o.user.token,[s.USER_OBJECT_ID]:o.user.objectId,[s.ROOM]:{[s.TITLE]:e.title,[s.DAYTIME]:0,[s.MIN_PLAYERS]:e.minPlayers,[s.MAX_PLAYERS]:e.maxPlayers,[s.MIN_LEVEL]:e.minLevel,[s.SELECTED_ROLES]:e.selectedRoles,[s.PASSWORD]:e.password?he(e.password):"",[s.VIP_ENABLED]:e.vip}}),o.screen=new te("",{sendRoomEnter:!1})}init(){let e=this,t=document.createElement("div");t.style.display="flex",t.style.padding="10px",t.style.justifyContent="center",t.style.flexDirection="column",this.element.appendChild(t);function i(h,{fontSize:p=16,margin:y="10px"}={}){let f=document.createElement("p");f.style.textAlign="center",f.style.fontSize=p+"px",f.style.margin=y,f.innerHTML=h,t.appendChild(f)}function n(h,p,y){let f=document.createElement("div");f.style.display="flex",f.style.alignItems="center",f.style.padding="3px",t.appendChild(f);let R=document.createElement("img");R.width=25,y.then(A=>R.src=A),f.appendChild(R);let I=document.createElement("input");I.style.zoom="1.5",I.type="checkbox",I.checked=typeof p=="string"?!!e.data[p]:e.data.selectedRoles.includes(p),I.onchange=()=>{typeof p=="string"?e.data[p]=I.checked:e.data.selectedRoles=e.data.selectedRoles.includes(p)?e.data.selectedRoles.filter(A=>A!==p):[...e.data.selectedRoles,p],console.log(e.data)},f.appendChild(I);let T=document.createElement("span");T.textContent=h,f.appendChild(T)}function a(h){function p(D,b,P){let k=document.createElement("div");k.className="range-tooltip",D.appendChild(k);function B(){let L=Number(b.min),x=Number(b.max),U=Number(b.value),z=D.clientWidth,r=(U-L)/(x-L)*z/o.zoom/Q();k.style.left=r+"px",k.textContent=P()}b.addEventListener("pointerdown",()=>{B(),k.style.opacity="1"}),b.addEventListener("input",B);function v(){k.style.opacity="0"}b.addEventListener("pointerup",v),b.addEventListener("pointercancel",v),b.addEventListener("pointerleave",v)}if(h=="lvl"){let D=document.createElement("div");D.style.position="relative",t.appendChild(D);let b=document.createElement("input");b.style.width="100%",b.type="range",b.min="1",b.max="13",b.value=String(e.data.minLevel),D.appendChild(b),p(D,b,()=>`${b.value}`),b.oninput=()=>{e.data.minLevel=Number(b.value)};return}let y=document.createElement("div");y.className="range-wrapper",t.appendChild(y);let f=document.createElement("div");f.className="range-track",y.appendChild(f);let R=document.createElement("div");R.className="range-active",y.appendChild(R);let I=document.createElement("input"),T=document.createElement("input");p(y,I,()=>String(e.data.minPlayers)),p(y,T,()=>String(e.data.maxPlayers)),I.type=T.type="range",I.min=T.min="1",I.max=T.max="21",I.value=String(e.data.minPlayers),T.value=String(e.data.maxPlayers);function A(D){let b=Number(I.value),P=Number(T.value);b>P&&(D==I?P=b:b=P),I.value=String(b),T.value=String(P),e.data.minPlayers=b,e.data.maxPlayers=P;let k=y.clientWidth,B=(b-1)/20*k/o.zoom/Q(),v=(P-1)/20*k/o.zoom/Q();R.style.left=B+"px",R.style.width=v-B+"px"}I.oninput=()=>A(I),T.oninput=()=>A(T),y.appendChild(I),y.appendChild(T),A()}let l=document.createElement("input");l.placeholder="\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u043E\u043C\u043D\u0430\u0442\u044B",l.style.width="100%",l.value=o.settings.data.roomCreate.title,l.oninput=()=>this.data.title=l.value,t.appendChild(l),i("\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0438\u0433\u0440\u043E\u043A\u043E\u0432"),a("players"),i("\u0423\u0440\u043E\u0432\u0435\u043D\u044C \u043A\u043E\u043C\u043D\u0430\u0442\u044B"),a("lvl"),i("\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438"),n("VIP \u043A\u043E\u043C\u043D\u0430\u0442\u0430","vip",ee("vip/_u.png")),i("\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0440\u043E\u043B\u0438",{margin:"10px 0 5px 0"}),i("\u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043C\u0430\u0444\u0438\u0438",{fontSize:13,margin:"5px"}),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0422\u0435\u0440\u0440\u043E\u0440\u0438\u0441\u0442",6,K(6)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0411\u0430\u0440\u043C\u0435\u043D",9,K(9)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0442\u043E\u0440",11,K(11)),i("\u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043C\u0438\u0440\u043D\u044B\u0445 \u0436\u0438\u0442\u0435\u043B\u0435\u0439",{fontSize:13,margin:"5px"}),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0414\u043E\u043A\u0442\u043E\u0440",2,K(2)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u041B\u044E\u0431\u043E\u0432\u043D\u0438\u0446\u0430",5,K(5)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0416\u0443\u0440\u043D\u0430\u043B\u0438\u0441\u0442",7,K(7)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0422\u0435\u043B\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435\u043B\u044C",8,K(8)),n("\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C - \u0428\u043F\u0438\u043E\u043D",10,K(10));let c=document.createElement("input");c.placeholder="\u041F\u0430\u0440\u043E\u043B\u044C (\u041E\u0441\u0442\u0430\u0432\u044C\u0442\u0435 \u043F\u0443\u0441\u0442\u044B\u043C \u0434\u043B\u044F \u0432\u044B\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F)",c.style.width="100%",c.value=o.settings.data.roomCreate.password,c.oninput=()=>this.data.password=c.value,t.appendChild(c);let g=document.createElement("button");g.textContent="\u0421\u043E\u0437\u0434\u0430\u0442\u044C",g.onclick=()=>this.createRoom(this.data),t.appendChild(g)}destroy(){super.destroy(),o.settings.data.roomCreate=this.data}};var G=class E extends F{div;titleElem;search="";constructor(){super("Rooms"),o.title="\u041A\u043E\u043C\u043D\u0430\u0442\u044B",this.element.style.overflow="hidden",(async()=>this.element.style.background=`url(${await H("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("button");t.className="back",t.textContent="<",t.onclick=()=>this.emit("back"),e.appendChild(t),this.titleElem=document.createElement("label"),this.titleElem.textContent="\u041A\u043E\u043C\u043D\u0430\u0442\u044B",e.appendChild(this.titleElem),this.on("back",()=>{o.screen=new V}),this.init()}async init(){o.server.send(s.ADD_CLIENT_TO_ROOMS_LIST,{[s.USER_OBJECT_ID]:o.user.objectId,[s.TOKEN]:o.user.token});let e=await o.server.awaitPacket(s.ROOMS),t=document.createElement("div");t.className="rooms-filter",this.element.appendChild(t);{let l=document.createElement("input");l.placeholder="\u041F\u043E\u0438\u0441\u043A",l.size=30,l.onchange=l.onkeyup=()=>{this.search=l.value,this.updateRooms()},t.appendChild(l);let c=document.createElement("button");c.textContent="\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C",c.onclick=async()=>{this.rooms=[],this.updateRooms(),o.server.send(s.ADD_CLIENT_TO_ROOMS_LIST,{[s.USER_OBJECT_ID]:o.user.objectId,[s.TOKEN]:o.user.token});let p=await o.server.awaitPacket(s.ROOMS),y=this.getRooms(p[s.ROOMS]);for(let f of y)this.addRoom(f)},t.appendChild(c);let g=document.createElement("button");g.textContent="\u0424\u0438\u043B\u044C\u0442\u0440",g.onclick=()=>{let p=new Y({title:"\u0424\u0418\u041B\u042C\u0422\u0420",width:"70%",height:"70%",canCloseAnywhere:!0})},t.appendChild(g);let h=document.createElement("button");h.textContent="\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430",h.onclick=()=>{let p=new Y({title:"\u0421\u041E\u0420\u0422\u0418\u0420\u041E\u0412\u041A\u0410",width:"70%",height:"70%",canCloseAnywhere:!0})},t.appendChild(h),this.on("keydown",p=>{p.ctrlKey&&p.key=="f"&&(l.focus(),p.preventDefault())})}this.div=document.createElement("div"),this.div.style.textAlign="center",this.div.style.overflowY="overlay",this.div.style.height=o.height-(95+t.clientHeight)+"px",this.element.appendChild(this.div);let i=this.getRooms(e[s.ROOMS]);for(let l of i)this.addRoom(l);let n=document.createElement("div");n.style.textAlign="center",n.style.margin="3px",this.element.appendChild(n);let a=document.createElement("button");a.textContent="\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043A\u043E\u043C\u043D\u0430\u0442\u0443",a.style.width="99%",a.onclick=()=>o.screen=new ue,n.appendChild(a),this.on("message",l=>{l[s.TYPE]==s.ROOM_IN_LOBBY_STATE?(this.getRoomByObjectId(l[s.ROOM_IN_LOBBY_STATE][s.ROOM_OBJECT_ID])?.rils(l[s.ROOM_IN_LOBBY_STATE]),this.updateRooms()):l[s.TYPE]==s.GAME_STATUS_IN_ROOMS_LIST?(this.getRoomByObjectId(l[s.ROOM_OBJECT_ID]).room.status=l[s.STATUS],this.updateRooms()):l[s.TYPE]==s.ADD?(this.addRoom(l[s.ROOM]),this.updateRooms()):l[s.TYPE]==s.REMOVE&&(this.getRoomByObjectId(l[s.ROOM_OBJECT_ID])?.remove(),this.rooms.splice(this.getRoomIdByObjectId(l[s.ROOM_OBJECT_ID]),1),this.updateRooms())}),this.on("resize",l=>{this.div.style.height=o.height-(85+t.clientHeight+5)+"px"})}rooms=[];roomsId=0;getRoomByObjectId(e){return this.rooms.find(t=>t.room[s.OBJECT_ID]==e)}getRoomIdByObjectId(e){return this.rooms.findIndex(t=>t.room[s.OBJECT_ID]==e)}getRooms(e){let t=e.sort((n,a)=>{let l=n[s.ROOM_STATUS]-a[s.ROOM_STATUS];if(l!==0)return l;let c=n[s.STATUS]-a[s.STATUS];return c!==0?c:n[s.MIN_LEVEL]-a[s.MIN_LEVEL]}),i=`\u041A\u043E\u043C\u043D\u0430\u0442\u044B: (${e.length}/${t.length})`;return this.titleElem.textContent=w(i),o.title=i,t}updateRooms(){this.div.innerHTML="";let e=[];for(let i of this.rooms)e.push(i.room);let t=this.getRooms(e);this.rooms=[];for(let i of t)this.addRoom(Object.assign({},i))}filter(e){return e?this.search==""?!0:e[s.TITLE].toLowerCase().includes(this.search.toLowerCase()):!1}static orderRoles=[2,7,10,11,9,5,6,8];static getRoomElement(e){let t=typeof e[s.SAME_ROOM]=="boolean",i=e[s.OBJECT_ID],n=e[s.MIN_LEVEL],a=t?2:e[s.ROOM_STATUS],l=n==3?2:n==5?3:n==7?4:n==9?5:n==11?6:1,c=e[s.SELECTED_ROLES]??[],g=e[s.PASSWORD];async function h(){if(g){let A=await He(`\u042D\u0442\u0430 \u043A\u043E\u043C\u043D\u0430\u0442\u0430 \u043F\u043E\u0434 \u0437\u0430\u043C\u043A\u043E\u043C

\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C`,{btnText:"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C",placeholder:"\u041F\u0430\u0440\u043E\u043B\u044C",title:"\u0412\u0412\u0415\u0421\u0422\u0418 \u041F\u0410\u0420\u041E\u041B\u042C",height:"200px"});if(A=="")return;if(o.server.send(s.ROOM_ENTER,{[s.ROOM_PASS]:A,[s.ROOM_OBJECT_ID]:i}),(await o.server.awaitPacket([s.ROOM_ENTER,s.ROOM_PASSWORD_IS_WRONG_ERROR,s.GAME_STARTED,s.USER_IN_ANOTHER_ROOM,s.USER_USING_DOUBLE_ACCOUNT,s.USER_LEVEL_NOT_ENOUGH,s.USER_KICKED]))[s.TYPE]==s.ROOM_PASSWORD_IS_WRONG_ERROR){await N("\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043F\u0430\u0440\u043E\u043B\u044C!"),h();return}o.screen=new te(i,{password:A,sendRoomEnter:!1});return}o.screen=new te(i)}let p=document.createElement("div");p.className="room";let y=document.createElement("img");y.className="room-lvl";let f=document.createElement("div");f.className="room-title";let R=document.createElement("div");R.className="room-status";let I=document.createElement("div");if(I.className="room-btn-players",a==0){let A=document.createElement("div");A.style.textAlign="center",A.style.color="black",A.style.padding="5px",A.textContent="\u0412\u044B \u0438\u0433\u0440\u0430\u0435\u0442\u0435 \u0432 \u044D\u0442\u043E\u0439 \u043A\u043E\u043C\u043D\u0430\u0442\u0435",p.appendChild(A)}else if(a==1){let A=document.createElement("div");A.style.textAlign="center",A.style.color="black",A.style.padding="5px",A.textContent="\u0412\u0430\u0441 \u0443\u0431\u0438\u043B\u0438 \u0432 \u044D\u0442\u043E\u0439 \u043A\u043E\u043C\u043D\u0430\u0442\u0435",p.appendChild(A)}p.style.background=a==0?"rgb(137 242 165 / 40%)":a==1?"rgb(255 138 146 / 40%)":"rgba(200,200,200,.4)",c.length==0&&(p.style.height=a<2?"110px":"80px"),p.onmouseenter=()=>a==0?"rgb(114 202 137 / 40%)":a==1?"rgb(219 103 111 / 40%)":p.style.background="rgba(200,200,200,.3)",p.onmouseleave=()=>a==0?"rgb(137 242 165 / 40%)":a==1?"rgb(255 138 146 / 40%)":p.style.background="rgba(200,200,200,.4)",p.onclick=()=>h(),t||(p.oncontextmenu=async A=>{A.preventDefault();let D=`\u0417\u0430\u0439\u0442\u0438 \u043A\u043E\u0433\u0434\u0430 ${e[s.MAX_PLAYERS]-1} \u0438\u0433\u0440\u043E\u043A\u043E\u0432 \u0431\u0443\u0434\u0435\u0442`,P=await new Ee(["\u0417\u0430\u0439\u0442\u0438",D,"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C object id"],A).waitForResult();Ie(P).case(D,async()=>{let k=$e({title:"\u0416\u0414\u0401\u041C",text:`\u041A\u043E\u043B-\u0432\u043E \u0438\u0433\u0440\u043E\u043A\u043E\u0432 \u0432 \u043A\u043E\u043C\u043D\u0430\u0442\u0435: ${e[s.PLAYERS_NUM]}`,canCloseAnywhere:!0}),B=e[s.MAX_PLAYERS];o.server.on("message",async v=>{if(v[s.TYPE]==s.ROOM_IN_LOBBY_STATE){let L=v[s.ROOM_IN_LOBBY_STATE][s.ROOM_OBJECT_ID],x=v[s.ROOM_IN_LOBBY_STATE][s.PLAYERS_IN_ROOM];i==L&&(k.changeText(`\u041A\u043E\u043B-\u0432\u043E \u0438\u0433\u0440\u043E\u043A\u043E\u0432 \u0432 \u043A\u043E\u043C\u043D\u0430\u0442\u0435: ${x}`),B-x==1&&(await $(50),k.done(),h()))}else if(v[s.TYPE]==s.GAME_STATUS_IN_ROOMS_LIST){let L=v[s.ROOM_IN_LOBBY_STATE][s.ROOM_OBJECT_ID];i==L&&v[s.STATUS]==2&&(k.done(),N("\u0418\u0433\u0440\u0430 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C"))}}).key("waitingRils"),k.box.on("destroy",()=>o.server.removeByKey("waitingRils"))}).case("\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C object id",()=>{})}),ee(`rank/rank${l}_36.png`).then(A=>y.src=A),f.textContent=`${e[s.PASSWORD]?"\u{1F512} ":""}`+e[s.TITLE],R.textContent=e[s.STATUS]==0?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F":"\u0418\u0433\u0440\u0430 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C",R.style.color=e[s.STATUS]==0?"green":"red",f.prepend(y),f.appendChild(R),p.appendChild(f);let T=c.slice().sort((A,D)=>this.orderRoles.indexOf(A)-this.orderRoles.indexOf(D));for(let A of T){let D=document.createElement("img");K(A).then(b=>D.src=b),D.width=25,D.height=35,D.style.margin="1px",D.onmousedown=b=>b.preventDefault(),p.appendChild(D)}return I.textContent=typeof e[s.MIN_PLAYERS]=="number"?`\u0418\u0433\u0440\u043E\u043A\u0438: ${e[s.PLAYERS_NUM]} [${e[s.MIN_PLAYERS]}/${e[s.MAX_PLAYERS]}] \u2B63`:`\u0418\u0433\u0440\u043E\u043A\u0438: [${e[s.PLAYERS_NUM]}]`,p.appendChild(I),p}addRoom(e){let t=this,i=e[s.OBJECT_ID];if(!this.filter(e)){this.getRoomByObjectId(i)&&this.rooms.splice(this.getRoomIdByObjectId(i),1),this.rooms.push(Object.assign({},{room:e,id:this.roomsId,rils(){},remove(){}}));return}let n=E.getRoomElement(e);this.div.appendChild(n),this.getRoomByObjectId(i)&&this.rooms.splice(this.getRoomIdByObjectId(i),1),this.rooms.push(Object.assign({},{room:e,id:this.roomsId,rils(a){let l=a[s.PLAYERS_IN_ROOM],c=e[s.MIN_PLAYERS],g=e[s.MAX_PLAYERS]},remove(){t.div.removeChild(n)}})),this.roomsId++}};function at(E){let e=Math.floor(E/86400),t=Math.floor(E%86400/3600),i=Math.floor(E%3600/60),n=E%60;return{days:e,hours:t,minutes:i,seconds:n}}function be(E,e,t,i="nominative"){let n=i==="genitive"?t:e;return E%10===1&&E%100!==11?n[0]:E%10>=2&&E%10<=4&&(E%100<10||E%100>=20)?n[1]:n[2]}function lt(E,e="nominative"){if(E==0)return"0 \u0441\u0435\u043A\u0443\u043D\u0434";let t=at(E),i=[],n=["\u0434\u0435\u043D\u044C","\u0434\u043D\u044F","\u0434\u043D\u0435\u0439"],a=["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043E\u0432"],l=["\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u044B","\u043C\u0438\u043D\u0443\u0442"],c=["\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u044B","\u0441\u0435\u043A\u0443\u043D\u0434"],g=["\u0434\u043D\u044F","\u0434\u043D\u0435\u0439","\u0434\u043D\u0435\u0439"],h=["\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043E\u0432","\u0447\u0430\u0441\u043E\u0432"],p=["\u043C\u0438\u043D\u0443\u0442\u044B","\u043C\u0438\u043D\u0443\u0442","\u043C\u0438\u043D\u0443\u0442"],y=["\u0441\u0435\u043A\u0443\u043D\u0434\u0443","\u0441\u0435\u043A\u0443\u043D\u0434\u044B","\u0441\u0435\u043A\u0443\u043D\u0434"];return t.days>0&&i.push(`${t.days} ${be(t.days,n,g,e)}`),t.hours>0&&i.push(`${t.hours} ${be(t.hours,a,h,e)}`),t.minutes>0&&i.push(`${t.minutes} ${be(t.minutes,l,p,e)}`),(t.seconds>0||i.length===0)&&i.push(`${t.seconds} ${be(t.seconds,c,y,e)}`),i.join(" ")}function De(E,e="nominative"){if(!Number.isInteger(E)||E<0)throw new Error("\u0412\u0445\u043E\u0434\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u043D\u0435\u043E\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u043C \u0446\u0435\u043B\u044B\u043C \u0447\u0438\u0441\u043B\u043E\u043C");return lt(E,e)}function Ce(E){let e=new Date(E),t=g=>g.toString().padStart(2,"0"),i=t(e.getDate()),n=t(e.getMonth()+1),a=e.getFullYear(),l=t(e.getHours()),c=t(e.getMinutes());return`${i}.${n}.${a} ${l}:${c}`}async function ne(E,e={}){let t=null,i=new Y({title:e.title??"\u041F\u041E\u0414\u0422\u0412\u0415\u0420\u0416\u0414\u0415\u041D\u0418\u0415",height:e.height,canCloseAnywhere:!1}),n=document.createElement("div");n.innerHTML=E.replaceAll(`
`,"<br/>"),n.style.color="black",n.style.textAlign="center",n.style.padding="15px 5px",i.content.appendChild(n);let a=document.createElement("div");a.style.width="100%",a.style.position="absolute",a.style.bottom="15px",a.style.display="flex",a.style.justifyContent="center",a.style.left="0",i.content.appendChild(a);let l=document.createElement("button");l.textContent=e.btnYes??"\u0414\u0410",l.style.width="45%",l.style.marginRight="2px",l.addEventListener("click",()=>{t=!0,i.close()}),a.appendChild(l);let c=document.createElement("button");return c.textContent=e.btnNo??"\u041D\u0415\u0422",c.style.width="45%",l.style.marginLeft="2px",c.addEventListener("click",()=>{t=!1,i.close()}),a.appendChild(c),await i.wait("destroy"),t}function ct(E){let e=[4,6,9,11],t=[1,2,3,5,7,8,10],i=0,n=0;e.forEach(f=>{i+=E.roleStats[f]||0}),t.forEach(f=>{n+=E.roleStats[f]||0});let a=i+n,l=E.winsAsPeaceful+E.winsAsMafia,c=(l*100/E.playedGames).toFixed(2),g=(E.winsAsMafia*100/l).toFixed(1),h=(E.winsAsPeaceful*100/l).toFixed(1),p=i>0?Math.round(E.winsAsMafia*100/i):0,y=n>0?Math.round(E.winsAsPeaceful*100/n):0;return{totalWins:`(${c}%) ${l}`,winsAsMafia:`(${g}%) ${E.winsAsMafia}`,winsAsPeaceful:`(${h}%) ${E.winsAsPeaceful}`,gamesAsMafia:i,gamesAsPeaceful:n,mafiaWinRatePercentOfGamesAsMafia:p,peacefulWinRatePercentOfGamesAsPeaceful:y}}async function W(E){let e=Q(),t=new Y({title:"\u041F\u0420\u041E\u0424\u0418\u041B\u042C",width:`${o.width/e/.75}px`,height:`${o.height/e/.75}px`,canCloseAnywhere:!0});t.element.style.zoom=e/1.75+"",t.content.style.overflowY="overlay",o.server.send(s.GET_USER_PROFILE,{[s.USER_RECEIVER]:E,[s.USER_OBJECT_ID]:o.user.objectId,[s.TOKEN]:o.user.token});let n=(await o.server.awaitPacket(s.USER_PROFILE))[s.USER_PROFILE],a=n[s.ROOM],l=n[s.PROFILE_USER_DATA],c={isOnline:l[s.IS_ONLINE],experience:l[s.EXPERIENCE],level:l[s.LEVEL],matchMakingScore:l[s.MATCH_MAKING_SCORE],nextLevelExperience:l[s.NEXT_LEVEL_EXPERIENCE],prevLevelExperience:l[s.PREVIOUS_LEVEL_EXPERIENCE],objectId:l[s.OBJECT_ID],photo:l[s.PHOTO],roleStats:l[s.PLAYER_ROLE_STATISTICS],sex:l[s.SEX],playedGames:l[s.PLAYED_GAMES],serverLanguage:l[s.SERVER_LANGUAGE],status:l[s.STATUS],updated:l[s.UPDATED],username:l[s.USERNAME],vip:l[s.VIP],winsAsMafia:l[s.WINS_AS_MAFIA],winsAsPeaceful:l[s.WINS_AS_PEACEFUL],sliver:n[s.USER_ACCOUNT_COINS][s.SILVER_COINS],gold:n[s.USER_ACCOUNT_COINS][s.GOLD_COINS],friend:n[s.FRIENDSHIP],friendFlag:n[s.FRIENDSHIP_FLAG]},g=typeof c.gold=="number",h=!1,p=document.createElement("div");p.style.width="100%",p.style.display="flex",p.style.flexDirection="column",p.style.alignItems="center",p.style.overflowY="overlay";let y=document.createElement("div");y.style.width=y.style.height="20px",y.style.minWidth=y.style.minHeight="20px",y.style.maxWidth=y.style.maxHeight="20px",y.style.boxSizing="border-box",y.style.background=c.isOnline?"#3fe33f":"#636363",y.style.border="2px solid white",y.style.borderRadius="100%",y.style.position="relative",y.style.left="-40px",y.style.top="-80px";let f=document.createElement("img");f.src=await X(l),f.style.borderRadius="100%",f.width=f.height=100,f.style.margin="5px",f.style.transition=".5s",f.style.marginBottom="-10px",f.onmousedown=v=>v.preventDefault(),f.onclick=()=>{let v=Q();h?(f.style.position="static",f.style.width="",f.style.height="",f.style.borderRadius="100%",$(500).then(()=>y.style.display="block")):(f.style.position="relative",f.style.width=o.width/v/1.75+"px",f.style.height=o.width/v/1.75+"px",f.style.borderRadius="0",y.style.display="none"),h=!h},p.appendChild(f),p.appendChild(y);function R(v,L=!1){let x=document.createElement("h4");L&&(x.style.userSelect="text"),x.style.color="black",x.style.margin="5px",x.textContent=v,p.appendChild(x)}R(c.username,!0);let I=document.createElement("div");I.style.width="80%",I.style.textAlign="center",p.appendChild(I);function T(v,L){let x=document.createElement("button");x.style.margin="1px",x.textContent=v,x.onclick=L,I.appendChild(x)}if(E!=o.user.objectId&&(c.friend?c.friendFlag==2?T("\u041F\u0440\u0438\u043D\u044F\u0442\u044C \u0434\u0440\u0443\u0436\u0431\u0443",async()=>{if(await ne("\u041F\u0440\u0438\u043D\u044F\u0442\u044C \u0437\u0430\u044F\u0432\u043A\u0443 \u0432 \u0434\u0440\u0443\u0437\u044C\u044F \u043E\u0442 \u0434\u0430\u043D\u043D\u043E\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",{title:"\u041F\u0420\u0418\u041D\u042F\u0422\u042C \u0414\u0420\u0423\u0416\u0411\u0423"})){o.server.send(s.ADD_FRIEND,{[s.FRIEND_USER_OBJECT_ID]:E});let L=await o.server.awaitPacket([s.ADD_FRIEND,s.YOUR_FRIENDSHIP_LIST_FULL]);if(L[s.TYPE]==s.YOUR_FRIENDSHIP_LIST_FULL){N(`\u0421\u043F\u0438\u0441\u043E\u043A \u0432\u0430\u0448\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439 \u043F\u043E\u043B\u043E\u043D. \u0412\u044B \u0443\u0436\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u043B\u0438 ${L[s.FRIENDSHIP_LIST_LIMIT]} \u0434\u0440\u0443\u0437\u0435\u0439 \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0434\u0440\u0443\u0437\u0435\u0439

\u0412\u044B \u0441\u043C\u043E\u0436\u0435\u0442\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C 200 \u0434\u0440\u0443\u0437\u0435\u0439, \u0435\u0441\u043B\u0438 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0438\u0442\u0435 VIP

\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043E\u0441\u0432\u043E\u0431\u043E\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0432\u0430\u0448\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439`);return}L[s.TYPE]==s.ADD_FRIEND&&(t.destroy(),W(E))}}):T("\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C \u0434\u0440\u0443\u0436\u0431\u0443",async()=>{await ne("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u043E\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0438\u0437 \u0434\u0440\u0443\u0437\u0435\u0439? \u0412\u0441\u0435 \u043B\u0438\u0447\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u0442\u0430\u043A-\u0436\u0435 \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B.",{title:"\u0423\u0414\u0410\u041B\u0418\u0422\u042C \u0418\u0417 \u0414\u0420\u0423\u0417\u0415\u0419"})&&(o.server.send(s.REMOVE_FRIEND,{[s.FRIEND_USER_OBJECT_ID]:E}),(await o.server.awaitPacket([s.REMOVE_FRIEND]))[s.TYPE]==s.REMOVE_FRIEND&&(t.destroy(),W(E)))}):T("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0434\u0440\u0443\u0437\u044C\u044F",async()=>{o.server.send(s.ADD_FRIEND,{[s.FRIEND_USER_OBJECT_ID]:E});let v=await o.server.awaitPacket([s.ADD_FRIEND,s.YOUR_FRIENDSHIP_LIST_FULL]);if(v[s.TYPE]==s.YOUR_FRIENDSHIP_LIST_FULL){N(`\u0421\u043F\u0438\u0441\u043E\u043A \u0432\u0430\u0448\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439 \u043F\u043E\u043B\u043E\u043D. \u0412\u044B \u0443\u0436\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u043B\u0438 ${v[s.FRIENDSHIP_LIST_LIMIT]} \u0434\u0440\u0443\u0437\u0435\u0439 \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0434\u0440\u0443\u0437\u0435\u0439

\u0412\u044B \u0441\u043C\u043E\u0436\u0435\u0442\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C 200 \u0434\u0440\u0443\u0437\u0435\u0439, \u0435\u0441\u043B\u0438 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0438\u0442\u0435 VIP

\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043E\u0441\u0432\u043E\u0431\u043E\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0432\u0430\u0448\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439`);return}v[s.TYPE]==s.ADD_FRIEND&&(t.destroy(),W(E))})),a){a[s.SAME_ROOM]&&!g&&T("\u0412\u044B\u0433\u043D\u0430\u0442\u044C \u0438\u0433\u0440\u043E\u043A\u0430",()=>{}),R("\u0421\u0435\u0439\u0447\u0430\u0441 \u0438\u0433\u0440\u0430\u0435\u0442 \u0432 \u043A\u043E\u043C\u043D\u0430\u0442\u0435");let v=G.getRoomElement(a);v.addEventListener("click",()=>t.close()),v.style.width="90%",p.appendChild(v)}g||T("\u041F\u043E\u0434\u0430\u0442\u044C \u0436\u0430\u043B\u043E\u0431\u0443",()=>{}),R("\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0430");let A=document.createElement("div");A.style.display="flex",A.style.flexDirection="column",A.style.alignItems="stretch",A.style.width="95%",p.appendChild(A);function D(v,L,x){let U=document.createElement("div");U.style.color="black",U.style.background="rgb(189 184 184)",U.style.padding="5px",U.style.margin="1px",U.style.borderRadius="5px";let z=document.createElement("span");z.textContent=`${L}:`;let r=document.createElement("span");r.textContent=x,r.style.float="right",r.style.userSelect="text",U.appendChild(z),U.appendChild(r),v.appendChild(U)}let b=ct(c);D(A,"\u0421\u044B\u0433\u0440\u0430\u043D\u043E \u0438\u0433\u0440",c.playedGames),D(A,"\u0421\u044B\u0433\u0440\u0430\u043D\u043E \u0438\u0433\u0440 \u0437\u0430 \u041C\u0430\u0444\u0438\u044E",b.gamesAsMafia),D(A,"\u0421\u044B\u0433\u0440\u0430\u043D\u043E \u0438\u0433\u0440 \u0437\u0430 \u041C\u0438\u0440\u043D\u044B\u0445",b.gamesAsPeaceful),D(A,"\u0412\u0441\u0435\u0433\u043E \u043F\u043E\u0431\u0435\u0434",b.totalWins),D(A,"\u041F\u043E\u0431\u0435\u0434 \u0437\u0430 \u041C\u0430\u0444\u0438\u044E",b.winsAsMafia),D(A,"\u041F\u043E\u0431\u0435\u0434 \u0437\u0430 \u041C\u0438\u0440\u043D\u044B\u0445",b.winsAsPeaceful),D(A,"M/M",(Number(c.winsAsPeaceful)/Number(c.winsAsMafia)).toFixed(2)),R("\u0421\u044B\u0433\u0440\u0430\u043D\u043D\u044B\u0435 \u0440\u043E\u043B\u0438");let P=document.createElement("div");P.style.display="flex",P.style.flexDirection="row",P.style.flexWrap="wrap",P.style.alignItems="stretch",P.style.justifyContent="center",P.style.width="95%";async function k(v){let L=document.createElement("div");L.style.color="black",L.style.background="rgb(189 184 184)",L.style.padding="5px",L.style.margin="1px",L.style.borderRadius="5px";let x=document.createElement("img");x.src=await M.loadImageAsDataURL(`${o.config.path}/assets/textures/roles/${v}.png`),x.width=50,x.height=70,x.onmousedown=z=>z.preventDefault();let U=document.createElement("div");U.textContent=c.roleStats[v],U.style.textAlign="center",L.appendChild(x),L.appendChild(U),P.appendChild(L)}p.appendChild(P);for(let v=1;v<11;v++)await k(v);R("\u041F\u043E\u0434\u0440\u043E\u0431\u043D\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F");let B=document.createElement("div");return B.style.display="flex",B.style.flexDirection="column",B.style.alignItems="stretch",B.style.width="95%",D(B,"ID \u041E\u0431\u044A\u0435\u043A\u0442\u0430",E),D(B,"\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0439 \u0432\u0445\u043E\u0434",Ce(c.updated)),D(B,"\u0421\u0435\u0440\u0432\u0435\u0440",c.serverLanguage),p.appendChild(B),t.content.appendChild(p),await t.wait("destroy")}var pe=class extends F{playersListElem;messagesElem;input;constructor(){super("GlobalChat"),o.title="\u041E\u0431\u0449\u0438\u0439 \u0447\u0430\u0442",(async()=>this.element.style.background=`url(${await H("day3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("button");t.className="back",t.textContent="<",t.onclick=()=>this.emit("back"),e.appendChild(t);let i=document.createElement("label");i.textContent="\u041E\u0431\u0449\u0438\u0439 \u0447\u0430\u0442",e.appendChild(i),this.init()}async init(){o.server.send(s.ADD_CLIENT_TO_CHAT,{[s.USER_OBJECT_ID]:o.user.objectId,[s.TOKEN]:o.user.token}),this.playersListElem=document.createElement("div"),this.playersListElem.style.height="155px",this.playersListElem.style.overflow="overlay",this.playersListElem.style.margin="10px",this.playersListElem.style.outline="2px solid #c0c0c0",this.playersListElem.style.borderRadius="3px",this.playersListElem.style.background="rgba(255,255,255,.5)",this.playersListElem.style.display="flex",this.playersListElem.style.flexWrap="wrap",this.playersListElem.style.flexDirection="column",this.element.appendChild(this.playersListElem),this.messagesElem=document.createElement("div"),this.messagesElem.style.height=o.height-250+"px",this.messagesElem.style.textAlign="center",this.messagesElem.style.overflowX="hidden",this.messagesElem.style.overflowY="overlay",this.messagesElem.style.margin="10px",this.messagesElem.style.outline="2px solid #c0c0c0",this.messagesElem.style.borderRadius="3px",this.messagesElem.style.background="rgba(255,255,255,.5)",this.messagesElem.style.display="flex",this.messagesElem.style.flexDirection="column",this.messagesElem.style.justifyContent="flexEnd",this.element.appendChild(this.messagesElem);let e=await o.server.awaitPacket(s.MESSAGES);for(let i of e[s.MESSAGES])this.addMessage(i,!1);this.messagesElem.scrollTop=this.messagesElem.scrollHeight;let t=document.createElement("div");t.style.position="absolute",t.style.width="100%",t.style.bottom="2px",this.element.appendChild(t),this.input=document.createElement("input"),this.input.className="input-chat",this.input.type="text",this.input.placeholder="\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435",this.input.addEventListener("keydown",i=>{if(i.key=="Enter"&&this.input.value!=""){let n=this.input.value;this.input.value="",this.sendMessage(n)}}),this.on("keydown",i=>i.key=="Enter"&&this.input.focus()),t.appendChild(this.input),this.on("message",i=>{i[s.TYPE]==s.MESSAGE?this.addMessage(i[s.MESSAGE]):i[s.TYPE]==s.USERS&&this.updateUsers(i[s.USERS])}),this.on("back",()=>{o.screen=new V})}joinLeaveMessages={};lastMessage;addMessage(e,t=!0){let i=e[s.TEXT],n=e[s.MESSAGE_TYPE],a=e[s.MESSAGE_STICKER],l=e[s.USER];if(l)if(this.lastMessage&&this.lastMessage.divM&&this.lastMessage.user[s.USERNAME]==l[s.USERNAME]){let c=document.createElement("span");c.textContent=w(i),c.style.color="black",c.style.userSelect="text",this.lastMessage.divM.appendChild(c)}else{let c=document.createElement("div"),g=document.createElement("img"),h=document.createElement("div"),p=document.createElement("span"),y=document.createElement("span");X(l).then(f=>g.src=f),g.style.borderRadius="100%",g.width=35,g.height=35,g.style.margin="5px",g.onmousedown=f=>f.preventDefault(),g.onclick=()=>W(l[s.OBJECT_ID]),p.textContent=w(l[s.USERNAME]),p.style.color="black",p.onclick=()=>this.addNickToInput(l[s.USERNAME]),y.textContent=w(i),y.style.color=n==9?"#22640A":n==11?"gray":n==17?"#1D3E67":n==27?"#7D080E":"black",y.style.userSelect="text",h.style.display="flex",h.style.flexDirection="column",h.style.justifyContent="center",h.style.wordBreak="auto-phrase",c.style.display="flex",c.style.textAlign="left",c.appendChild(g),c.appendChild(h),h.appendChild(p),h.appendChild(y),this.messagesElem.appendChild(c),this.lastMessage={user:l,divM:h}}else{let c=document.createElement("div");c.textContent=w(n==2?`\u0418\u0433\u0440\u043E\u043A ${i} \u0432\u043E\u0448\u0451\u043B`:n==3?`\u0418\u0433\u0440\u043E\u043A ${i} \u0432\u044B\u0448\u0435\u043B`:i),c.style.color=n==2?"#22640A":n==3?"#7D080E":"black",c.style.userSelect="text",c.style.margin="3px",this.messagesElem.appendChild(c),this.lastMessage={user:void 0,divM:void 0},(n==2||n==3)&&(this.joinLeaveMessages[i]&&this.messagesElem.removeChild(this.joinLeaveMessages[i]),this.joinLeaveMessages[i]=c)}this.messagesElem.scrollHeight-o.height-this.messagesElem.scrollTop<75&&this.messagesElem.scroll({top:this.messagesElem.scrollHeight,behavior:"smooth"}),t&&this.messagesElem.firstElementChild&&this.messagesElem.removeChild(this.messagesElem.firstElementChild)}addNickToInput(e){if(this.input.value.includes(`[${e}]`)){let t=this.input.value.indexOf(`[${e}]`);this.input.value.lastIndexOf(`[${e}]`)==0?this.input.value=this.input.value.replace(`[${e}] `,""):this.input.value.substring(0,t).endsWith(" ")?this.input.value=this.input.value.replace(` [${e}] `,""):this.input.value=this.input.value.replace(`[${e}]`,"")}else[""," "].includes(this.input.value.substring((this.input.selectionStart??1)-1))?re(this.input,`[${e}] `):re(this.input,` [${e}] `)}sendMessage(e,t={}){if(e.startsWith("!")){let i="?!&@#%^~<>*";e=Array.from({length:[...e].length-1},()=>i[Math.random()*i.length|0]).join("")}o.server.send(s.CHAT_MESSAGE_CREATE,{[s.MESSAGE]:{[s.MESSAGE_STYLE]:t.messageStyle??0,[s.MESSAGE_STICKER]:t.messageSticker??!1,[s.TEXT]:e}})}updateUsers(e){this.playersListElem.innerHTML="";for(let t=0;t<e.length;t++){let i=e[t],n=document.createElement("div"),a=document.createElement("img"),l=document.createElement("span");X(i).then(c=>a.src=c),a.style.borderRadius="100%",a.width=a.height=25,a.style.margin="5px",a.onmousedown=c=>c.preventDefault(),a.onclick=()=>W(i[s.OBJECT_ID]),l.textContent=w(i[s.USERNAME]),l.style.color="black",l.onclick=()=>this.addNickToInput(i[s.USERNAME]),n.style.display="flex",n.style.textAlign="left",n.style.alignItems="center",n.appendChild(a),n.appendChild(l),this.playersListElem.appendChild(n)}}};var ye=class extends F{div;list;constructor(){super("Friends"),this.element.style.overflow="hidden",o.title="\u0414\u0440\u0443\u0437\u044C\u044F",(async()=>this.element.style.background=`url(${await H("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("button");t.className="back",t.textContent="<",t.onclick=()=>this.emit("back"),e.appendChild(t);let i=document.createElement("label");i.textContent="\u0414\u0440\u0443\u0437\u044C\u044F",e.appendChild(i),this.on("back",()=>{o.screen=new V}),this.init()}async init(){o.server.send(s.ADD_CLIENT_TO_FRIENDSHIP_LIST,{[s.USER_OBJECT_ID]:o.user.objectId,[s.TOKEN]:o.user.token}),this.div=document.createElement("div"),this.div.style.display="flex",this.div.style.padding="10px",this.div.style.flexDirection="column",this.element.appendChild(this.div);let e=document.createElement("div");e.style.display="flex",e.style.width="100%",this.div.appendChild(e);let t=document.createElement("button");t.className="gray",t.style.width="100%",t.style.margin="2px",t.textContent="\u0414\u0440\u0443\u0437\u044C\u044F",t.onclick=async()=>{o.server.send(s.ADD_CLIENT_TO_FRIENDSHIP_LIST,{[s.USER_OBJECT_ID]:o.user.objectId,[s.TOKEN]:o.user.token});let a=await o.server.awaitPacket([s.FRIENDSHIP_LIST]);t.className="gray",i.className="dark-gray",this.updateFriends(a[s.FRIENDSHIP_LIST][s.FRIENDSHIP_LIST])},e.appendChild(t);let i=document.createElement("button");i.className="dark-gray",i.style.width="100%",i.style.margin="2px",i.textContent="\u0417\u0430\u043F\u0440\u043E\u0441\u044B",i.onclick=async()=>{o.server.send(s.GET_SENT_FRIEND_REQUESTS_LIST,{[s.USER_OBJECT_ID]:o.user.objectId,[s.TOKEN]:o.user.token});let a=await o.server.awaitPacket([s.FRIENDSHIP_LIST]);t.className="dark-gray",i.className="gray",this.updateFriends(a[s.FRIENDSHIP_LIST][s.FRIENDSHIP_LIST])},e.appendChild(i),this.list=document.createElement("div"),this.list.style.overflowY="overlay",this.list.style.height=o.height-125+"px",this.div.appendChild(this.list),this.on("resize",()=>{this.list.style.height=o.height-125+"px"});let n=await o.server.awaitPacket([s.FRIENDSHIP_LIST]);this.updateFriends(n[s.FRIENDSHIP_LIST][s.FRIENDSHIP_LIST])}updateFriends(e){this.list.innerHTML="";for(let t of e){let n=!!t[s.FRIEND]?t[s.FRIEND]:t[s.USER],a=n[s.OBJECT_ID],l=n[s.USERNAME],c=document.createElement("div");c.style.background="rgba(200,200,200,.4)",c.style.padding="7px",c.style.margin="5px",c.style.borderRadius="10px",c.style.display="flex";let g=document.createElement("img");g.width=g.height=40,g.style.borderRadius="100%",g.onmousedown=T=>T.preventDefault(),g.onclick=()=>W(a),X(n).then(T=>g.src=T),c.appendChild(g);let h=document.createElement("div");h.style.width=h.style.height="15px",h.style.minWidth=h.style.minHeight="15px",h.style.maxWidth=h.style.maxHeight="15px",h.style.boxSizing="border-box",h.style.background=n[s.IS_ONLINE]?"#3fe33f":"#636363",h.style.border="2px solid white",h.style.borderRadius="100%",h.style.position="relative",h.style.left="-45px",c.appendChild(h);let p=document.createElement("div");p.style.display="flex",p.style.flexDirection="column",p.style.width="300px",c.appendChild(p);let y=document.createElement("span");y.textContent=l,y.style.padding="0 5px 7px 10px",y.style.color="black",p.appendChild(y);let f=document.createElement("span");f.textContent=Ce(t[s.UPDATED]),f.style.padding="0 5px 0 5px",f.style.fontSize="11px",f.style.color="black",p.appendChild(f);let R=document.createElement("div");if(R.style.display="flex",R.style.width="100%",R.style.justifyContent="flex-end",c.appendChild(R),t[s.ROOM]){let T=document.createElement("button");T.textContent="\u0412 \u043A\u043E\u043C\u043D\u0430\u0442\u0435",T.onclick=()=>{o.screen=new te(t[s.ROOM][s.OBJECT_ID])},R.appendChild(T)}let I=document.createElement("button");I.className="gray",I.textContent="X",I.onclick=async()=>{await ne("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u043E\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0438\u0437 \u0434\u0440\u0443\u0437\u0435\u0439? \u0412\u0441\u0435 \u043B\u0438\u0447\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u0442\u0430\u043A-\u0436\u0435 \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B.",{title:"\u0423\u0414\u0410\u041B\u0418\u0422\u042C \u0418\u0417 \u0414\u0420\u0423\u0417\u0415\u0419"})&&(o.server.send(s.REMOVE_FRIEND,{[s.FRIEND_USER_OBJECT_ID]:a}),(await o.server.awaitPacket([s.REMOVE_FRIEND]))[s.TYPE]==s.REMOVE_FRIEND&&c.remove())},R.appendChild(I),this.list.appendChild(c)}}};var V=class extends F{constructor(){super("Dashboard"),o.title="\u041C\u0435\u043D\u044E",(async()=>this.element.style.background=`url(${await H("menu3")}) 0% 0% / cover`)();let e=document.createElement("div");e.className="header",this.element.appendChild(e);let t=document.createElement("label");t.textContent="\u0411\u0430\u0444\u0438\u044F \u043E\u043D\u043B\u0430\u0439\u043D",e.appendChild(t),this.init()}async init(){let e=document.createElement("div");e.style.textAlign="center",this.element.appendChild(e);let t=document.createElement("img"),i=document.createElement("span");t.style.borderRadius="100%",t.width=t.height=100,t.style.margin="5px",t.onmousedown=R=>R.preventDefault(),X({[s.OBJECT_ID]:o.user.objectId,[s.PHOTO]:o.user.photo}).then(R=>t.src=R),i.textContent=o.user.username,e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(i);let n=document.createElement("div");n.innerHTML="\u0414\u043E\u0431\u0440\u043E \u043F\u043E\u0436\u0430\u043B\u043E\u0432\u0430\u0442\u044C \u0432 \u0411\u0430\u0444\u0438\u044E \u043E\u043D\u043B\u0430\u0439\u043D".replaceAll(`
`,"<br/>"),n.style.padding="10px",e.appendChild(n);let a=document.createElement("button");a.textContent="\u041A\u043E\u043C\u043D\u0430\u0442\u044B",a.style.width="60%",a.style.margin="3px",a.onclick=()=>o.screen=new G,e.appendChild(a),e.appendChild(document.createElement("br"));let l=document.createElement("button");l.textContent="\u0421\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0439",l.style.width="60%",l.style.margin="3px",l.disabled=!0,e.appendChild(l),e.appendChild(document.createElement("br"));let c=document.createElement("button");c.textContent="\u0427\u0430\u0442",c.style.width="60%",c.style.margin="3px",c.onclick=()=>o.screen=new pe,e.appendChild(c),e.appendChild(document.createElement("br"));let g=document.createElement("button");g.textContent="\u0414\u0440\u0443\u0437\u044C\u044F",g.style.width="60%",g.style.margin="3px",g.onclick=()=>o.screen=new ye,e.appendChild(g),e.appendChild(document.createElement("br"));let h=document.createElement("button");h.textContent="\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",h.style.width="60%",h.style.margin="3px",h.disabled=!0,e.appendChild(h),e.appendChild(document.createElement("br"));let p=document.createElement("button");if(p.textContent="\u041F\u0440\u043E\u0444\u0438\u043B\u044C",p.style.width="60%",p.style.margin="3px",p.onclick=()=>W(o.user.objectId),e.appendChild(p),e.appendChild(document.createElement("br")),q()){let R=document.createElement("button");R.textContent="\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C",R.style.width="60%",R.style.margin="3px",R.onclick=async()=>{let T=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;T?await document.exitFullscreen():await o.screen.element.requestFullscreen(),T?R.textContent="\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C":R.textContent="\u0412\u044B\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C"},e.appendChild(R);let I=document.createElement("button");I.textContent="\u0417\u0430\u043A\u0440\u044B\u0442\u044C \u0438\u0433\u0440\u0443",I.style.width="60%",I.style.margin="3px",I.onclick=()=>o.win.close(),e.appendChild(I)}o.server.send(s.ADD_CLIENT_TO_DASHBOARD,{[s.USER_OBJECT_ID]:o.user.objectId,[s.TOKEN]:o.user.token});let y=await o.server.awaitPacket(s.DASHBOARD),f=y[s.DASHBOARD][s.DASHBOARD_USER];o.user.update(f),o.user.goldCoins=y[s.DASHBOARD][s.USER_ACCOUNT_COINS][s.GOLD_COINS],o.user.sliverCoins=y[s.DASHBOARD][s.USER_ACCOUNT_COINS][s.SILVER_COINS],i.textContent=f[s.USERNAME]}};function mt(E=32){let e="0123456789abcdef",t="";for(let i=0;i<E;i++)t+=e[Math.floor(Math.random()*e.length)];return t}function Ve(E){let e=new Uint8Array(E);return crypto.getRandomValues(e),[...e].map(t=>t.toString(16).padStart(2,"0")).join("")}var ge=class{constructor(e){this.server=e}async auth(e){if(e||(e=o.config.auth),o.screen.name=="Loading"&&(o.screen.title="\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F.."),e){let t=await this.signIn(e.email,e.password,e.token,e.userId);if(t[s.TYPE]==s.SIGN_IN_ERROR){let i=t[s.ERROR];i==-7?await N(`\u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435
\u041A\u043E\u0434 \u043E\u0448\u0438\u0431\u043A\u0438: -7`,{title:"\u041E\u0428\u0418\u0411\u041A\u0410"}):i==-4?await N(`\u0421\u0435\u0441\u0441\u0438\u044F \u043D\u0435\u0430\u043A\u0442\u0438\u0432\u043D\u0430
\u041A\u043E\u0434 \u043E\u0448\u0438\u0431\u043A\u0438: -4`,{title:"\u041E\u0428\u0418\u0411\u041A\u0410"}):i==-3?await N(`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u043F\u0430\u0440\u043E\u043B\u044C
\u041A\u043E\u0434 \u043E\u0448\u0438\u0431\u043A\u0438: -3`,{title:"\u041E\u0428\u0418\u0411\u041A\u0410"}):i==-1&&await N(`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u043F\u043E\u0447\u0442\u0430
\u041A\u043E\u0434 \u043E\u0448\u0438\u0431\u043A\u0438: -1`,{title:"\u041E\u0428\u0418\u0411\u041A\u0410"}),o.screen=new se}else if(t[s.TYPE]==s.USER_SIGN_IN)return o.user.update(t[s.USER]),o.user.bToken=mt(),o.screen=new V,!0}else await N("\u0423 \u0442\u0435\u0431\u044F \u043D\u0435\u0442 \u043F\u0440\u043E\u0444\u0438\u043B\u0438");return!1}async signIn(e,t,i,n){return e&&t?this.server.send(s.SIGN_IN,{[s.EMAIL]:e,[s.PASSWORD]:he(t),[s.DEVICE_ID]:Ve(8)}):n&&i&&this.server.send(s.SIGN_IN,{[s.OBJECT_ID]:n,[s.TOKEN]:i,[s.DEVICE_ID]:Ve(8)}),await this.server.awaitPacket([s.USER_SIGN_IN,s.SIGN_IN_ERROR])}};var fe=class extends J{webSocket;auth=new ge(this);config={CONNECTION_CHECKER_PERIOD:2e3,CONNECTION_INACTIVE_TIMEOUT:6e3,KICK_USER_PRICE:200,PRICE_USERNAME_SET:5e3,SERVER_LANGUAGE_CHANGE_TIME:216e5,SERVER_ROOM_PASSWORD_MINIMAL_LEVEL:0,SERVER_ROOM_TITLE_MINIMAL_LEVEL:3,SET_PROFILE_PHOTO_MINIMAL_LEVEL:3,SHOW_PASSWORD_ROOM_INFO_BUTTON:!0,mmguiqik:-1};constructor(){super(),this.on("close",async()=>{console.log("Connection is closed.. Reconnecting in 1 second.."),await $(50),this.#e()}),this.#e()}#e(){console.log(`Connecting to server.. ${o.config.uriServer}`),this.webSocket=new WebSocket(o.config.uriServer),this.webSocket.addEventListener("open",this.#t.bind(this)),this.webSocket.addEventListener("error",i=>console.error(i)),this.webSocket.addEventListener("close",()=>this.emit("close"));let e=Object.fromEntries(Object.entries(s).map(([i,n])=>[n,i]));function t(i){if(i===null||typeof i!="object")return i;if(Array.isArray(i))return i.map(t);let n={};for(let a in i){let l=e[a]??a;n[l]=t(i[a])}return n}this.webSocket.addEventListener("message",i=>{let n=JSON.parse(i.data);this.call("message",n),console.log(n,t(n))})}async#t(){this.call("connect"),console.log("Connected to server"),o.config.auth?await this.auth.auth():o.screen=new se,this.on("message",async e=>{if(e[s.TYPE]==s.USER_BLOCKED){let t=e[s.REASON],i=e[s.TIME_SEC_REMAINING];o.screen=new V,N(`\u0412\u044B \u0431\u044B\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u043F\u043E \u043F\u0440\u0438\u0447\u0438\u043D\u0435 [${t}]

\u041E\u0441\u0442\u0430\u0432\u0448\u0435\u0435\u0441\u044F \u0432\u0440\u0435\u043C\u044F \u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u043A\u0438:
${De(i,"genitive")}`,{height:"200px"})}else if(e[s.TYPE]==s.USER_INACTIVE_BLOCKED){o.screen=new V;let t=e[s.TIME_SEC_REMAINING];N(`\u0412\u044B \u0431\u044B\u043B\u0438 \u043D\u0435\u0430\u043A\u0442\u0438\u0432\u043D\u044B

\u041E\u0441\u0442\u0430\u0432\u0448\u0435\u0435\u0441\u044F \u0432\u0440\u0435\u043C\u044F \u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u043A\u0438:
${De(t,"genitive")}`,{height:"200px"})}else if(e[s.TYPE]==s.SIGN_IN_ERROR)e[s.ERROR]==-4&&(o.screen=new se,N("\u0421\u0435\u0441\u0441\u0438\u044F \u043D\u0435 \u0432\u0430\u043B\u0438\u0434\u043D\u0430. \u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0443\u0439\u0442\u0435\u0441\u044C \u0441\u043D\u043E\u0432\u0430"));else if(e[s.TYPE]==s.EMAIL_NOT_VERIFIED){o.screen=new V;let t=await ne(`\u0412\u044B \u043D\u0435 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u043B\u0438 \u0432\u0430\u0448 email.
\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0432\u0430\u0448\u0443 \u044D\u043B\u043E\u043A\u0442\u0440\u043E\u043D\u043D\u0443\u044E \u043F\u043E\u0447\u0442\u0443 \u0438 \u0441\u043B\u0435\u0434\u0443\u0439\u0442\u0435 \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u0438 \u0432 \u043F\u0438\u0441\u044C\u043C\u0435.

\u0422\u0430\u043A \u0436\u0435 \u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043F\u0430\u043F\u043A\u0443 \u0421\u041F\u0410\u041C. \u0412\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043F\u0438\u0441\u044C\u043C\u043E \u043F\u043E\u043F\u0430\u043B\u043E \u0442\u0443\u0434\u0430

\u0415\u0441\u043B\u0438 \u0432\u0430\u043C \u043D\u0430 email \u043D\u0435 \u043F\u0440\u0438\u0448\u043B\u043E \u043F\u0438\u0441\u044C\u043C\u043E \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F \u0432\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0435\u0433\u043E \u0441\u043D\u043E\u0432\u0430

\u0415\u0441\u043B\u0438 \u0432\u044B \u043D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E \u0443\u043A\u0430\u0437\u0430\u043B\u0438 email \u043F\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0432\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u043D\u043E\u0432\u044B\u0439`,{title:"\u041F\u041E\u0414\u0422\u0412\u0415\u0420\u0416\u0414\u0415\u041D\u0418\u0415",btnYes:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C",btnNo:"\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C email",height:"410px"});if(t==!0)try{let i=await(await fetch("https://api.mafia.dottap.com/user/email/verify",{method:"POST",headers:{Authorization:btoa(`${o.user.objectId}=:=${o.user.bToken}`)},body:new URLSearchParams({lang:"RUS"})})).json();i.error=="TOO_MANY_REQUESTS"&&N(`\u0412\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0437\u0430\u043F\u0440\u043E\u0441\u0438\u0442\u044C \u043F\u0438\u0441\u044C\u043C\u043E \u0434\u043B\u044F \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F email \u0447\u0435\u0440\u0435\u0437 ${i.data} \u0441\u0435\u043A\u0443\u043D\u0434`)}catch(i){N(`\u041E\u0448\u0438\u0431\u043A\u0430.. ${i}`)}else if(t==!1){let i=prompt("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u043E\u0432\u044B\u0439 email")}}})}send(e,t){typeof e=="object"?this.webSocket.send(JSON.stringify(e)):this.webSocket.send(JSON.stringify({[s.TYPE]:e,...t}))}async awaitPacket(e,t=1e7){return new Promise((i,n)=>{let a=setTimeout(()=>{this.off("message",l),n(new Error(`awaitPacket timeout: ${e}`))},t),l=c=>{(typeof e=="string"?c[s.TYPE]==e:e.includes(c[s.TYPE]))&&(clearTimeout(a),this.off("message",l),i(c))};this.on("message",l)})}destroy(){this.removeAllEvents(),this.webSocket.close()}};async function dt(E){let e=JSON.parse(await M.readFile(E));return e[`#${o.element.id}`]=e["&"],delete e["&"],e}async function Le(E){let e=await dt(E),t=document.createElement("style");return t.innerHTML=Fe(e),t}var _e=class{data={version:2,window:{zoom:1},game:{widthPL:130,zoomPL:1},roomCreate:{title:"",dayTime:0,minPlayers:5,maxPlayers:8,minLevel:1,selectedRoles:[6,9,11,2,5,7,8,10],password:"",vip:!1}};#e=!1;constructor(){this.#t(this.data)}#t(e){for(let t in e)e.hasOwnProperty(t)&&(typeof e[t]=="object"&&e[t]!==null&&!Array.isArray(e[t])&&this.#t(e[t]),ie(e,t,()=>this.#e&&this.write()))}async init(){this.#e||(this.#e=!0,await this.read())}async write(){await M.writeFile(`${o.config.path}/settings.json`,JSON.stringify(this.data))}async read(){if(!await M.existsFile(`${o.config.path}/settings.json`)){await this.write();return}let e=JSON.parse(await M.readFile(`${o.config.path}/settings.json`)),t=this.#s(e);Object.assign(this.data,t),console.log("Settings:",this.data),this.#t(this.data)}#s(e){let t=e.version||1,i=this.data.version;if(t>=i)return e;let n={...e};return t==1&&i>=2&&(typeof n.settings>"u"&&(n.settings={title:"",dayTime:0,minPlayers:5,maxPlayers:8,minLevel:1,selectedRoles:[6,9,11,2,5,7,8,10],password:"",vip:!1}),n.version=2),n}};var je={launcher:"Alpha 1.1.1",vanilla:"Alpha 1.1.1"};var we=class extends J{version=je.vanilla;element;config;win;screen;server;settings=new _e;user=new ce;title="";width=0;height=0;resources={};boxs=[];components=[];#e=!1;constructor(){super(),ie(this,"title",t=>this.win.title=`${t} - \u0411\u0430\u0444\u0438\u044F \u043E\u043D\u043B\u0430\u0439\u043D (vanilla ${this.version})`),ie(this,"screen",t=>{this.call("screenChange",t),this.screen?.destroy(),this.element.appendChild(t.element)});let e=0;setInterval(()=>{this.tick(e),e++},50)}async init(){this.#e||(this.#e=!0,await this.settings.init(),q()&&(this.settings.data.window.zoom=.6),this.element.tabIndex=0,this.element.style.zoom=this.settings.data.window.zoom+"",this.element.appendChild(await Le(`${this.config.path}/assets/styles/main.json`)),q()&&this.element.appendChild(await Le(`${this.config.path}/assets/styles/mobile.json`)),this.width=this.element.clientWidth,this.height=this.element.clientHeight,this.server=new fe,this.screen=new le("\u041F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u043A \u0441\u0435\u0440\u0432\u0435\u0440\u0443.."),this.#t(),this.#s())}async#t(){for(let e=1;e<11;e++)this.resources[`role_${e}`]=await M.loadImageAsDataURL(`${this.config.path}/assets/textures/roles/${e}.png`);this.resources.unknownChat=await M.loadImageAsDataURL(`${this.config.path}/assets/textures/roles/unknown_chat.png`)}#s(){this.element.addEventListener("focus",e=>this.emit("focus",e),!0),this.element.addEventListener("blur",e=>this.emit("unfocus",e),!0),this.element.addEventListener("click",e=>this.emit("click",e),!0),this.element.addEventListener("contextmenu",e=>this.emit("contextmenu",e),!0),this.element.addEventListener("keydown",e=>this.emit("keydown",e),!0),this.element.addEventListener("keyup",e=>this.emit("keyup",e),!0),this.element.addEventListener("wheel",e=>this.emit("wheel",e),!0),this.on("wheel",e=>{if(e.ctrlKey){let t=parseFloat(this.element.style.zoom),i=t;if(e.deltaY<0){if(t>2.5)return;t+=.1}else{if(t<.2)return;t-=.1}t!=i&&(this.settings.data.window.zoom=t,this.element.style.zoom=t+""),e.preventDefault()}}),this.on("keydown",e=>{if(e.ctrlKey){let t=parseFloat(this.element.style.zoom),i=t;if(e.key=="="||e.key=="+"){if(e.preventDefault(),t>2.5)return;t+=.1}else if(e.key=="-"){if(e.preventDefault(),t<.2)return;t-=.1}t!=i&&(this.settings.data.window.zoom=t,this.element.style.zoom=t+"")}}),this.win.on("close",()=>this.destroy())}tick(e){if(this.emit("tick",e),this.width!=this.element.clientWidth||this.height!=this.element.clientHeight){let t=this.width,i=this.height;this.width=this.element.clientWidth,this.height=this.element.clientHeight,this.emit("resize",{oldWidth:t,oldHeight:i})}this.screen?.tick(e)}get zoom(){return this.settings.data.window.zoom}destroy(){this.resources={},this.components.forEach(e=>e.destroy()),this.boxs.forEach(e=>e.destroy()),this.element.remove(),this.removeAllEvents(),this.server.destroy()}},o=new we;var We="wss://dottap.com:7091";var ze={path:"",version:1,auth:null,debug:!1,uriServer:We,userAgent:null},Me=ze;function oe(E){return Me[E]==null?ze[E]:Me[E]}function Je(E){return E&&(Me=E),{path:oe("path"),version:oe("version"),auth:oe("auth"),debug:oe("debug"),uriServer:oe("uriServer"),userAgent:oe("userAgent")}}async function ht(){}window.main=async function(E,e,t){delete window.main,o.config=Je(E),o.win=e,o.element=t,await M.init("Indexeddb"),await o.init()};window.App=o;(async function(){await ht()})();})();
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.8.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2023
 * @license MIT
 */
//!root.JS_MD5_NO_NODE_JS && typeof process === 'object' && process.versions && process.versions.node;
